<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Instances Management Tasks Using the Scripts – Automated Management of AWS Instances</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../docs/lesson02-managing-aws-instances/03-ami-management.html" rel="next">
<link href="../../docs/lesson02-managing-aws-instances/01-configure-instances-internet.html" rel="prev">
<link href="../../images/cloud-span-icon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/cloud-span-icon.png" alt="Cloud-SPAN logo." class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/miscellanea/precourse-instructions.html"> 
<span class="menu-text">Precourse Instructions</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/miscellanea/about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../docs/lesson02-managing-aws-instances/index.html">Managing AWS Instances</a></li><li class="breadcrumb-item"><a href="../../docs/lesson02-managing-aws-instances/02-instances-management.html">Instances Management Tasks Using the Scripts</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../docs/lesson01-setting-work-envs/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Setting Up Cloud/Terminal Environments</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson01-setting-work-envs/01-create-aws-account.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Create Your AWS Account</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson01-setting-work-envs/02-configure-account.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Configure Your AWS Account</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson01-setting-work-envs/03-configure-terminal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Configure Your Terminal Environment</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson01-setting-work-envs/04-configure-cloudshell.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Configure Your AWS CloudShell Environment</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../docs/lesson02-managing-aws-instances/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Managing AWS Instances</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson02-managing-aws-instances/01-configure-instances-internet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Configure Instances Internet Access</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson02-managing-aws-instances/02-instances-management.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Instances Management Tasks Using the Scripts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson02-managing-aws-instances/03-ami-management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AMIs Management</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson02-managing-aws-instances/04-scripts-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Scripts Design</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#the-scripts-running-environment" id="toc-the-scripts-running-environment" class="nav-link" data-scroll-target="#the-scripts-running-environment">1. The Scripts Running Environment</a>
  <ul class="collapse">
  <li><a href="#file-directory-structure-to-manage-instances-for-workshops" id="toc-file-directory-structure-to-manage-instances-for-workshops" class="nav-link" data-scroll-target="#file-directory-structure-to-manage-instances-for-workshops">File-directory structure to manage instances for workshops</a></li>
  <li><a href="#how-to-run-the-scripts-overview-and-constraints" id="toc-how-to-run-the-scripts-overview-and-constraints" class="nav-link" data-scroll-target="#how-to-run-the-scripts-overview-and-constraints">How to run the Scripts — overview and constraints</a></li>
  </ul></li>
  <li><a href="#configure-the-scripts-running-environment" id="toc-configure-the-scripts-running-environment" class="nav-link" data-scroll-target="#configure-the-scripts-running-environment">2. Configure the Scripts Running Environment</a>
  <ul class="collapse">
  <li><a href="#create-the-we-directory-structure" id="toc-create-the-we-directory-structure" class="nav-link" data-scroll-target="#create-the-we-directory-structure">Create the WE directory structure</a></li>
  <li><a href="#create-the-files-instancesnames.txt-resourcesids.txt-and-tags.txt" id="toc-create-the-files-instancesnames.txt-resourcesids.txt-and-tags.txt" class="nav-link" data-scroll-target="#create-the-files-instancesnames.txt-resourcesids.txt-and-tags.txt">Create the files: <em>instancesNames.txt</em>, <code>resourcesIDs.txt</code> and <code>tags.txt</code></a></li>
  <li><a href="#check-the-contents-of-each-file" id="toc-check-the-contents-of-each-file" class="nav-link" data-scroll-target="#check-the-contents-of-each-file">Check the contents of each file</a></li>
  <li><a href="#edit-the-file-resourcesids.txt-or-configure-the-aws-cli" id="toc-edit-the-file-resourcesids.txt-or-configure-the-aws-cli" class="nav-link" data-scroll-target="#edit-the-file-resourcesids.txt-or-configure-the-aws-cli">Edit the file <code>resourcesIDs.txt</code> or configure the AWS CLI</a></li>
  </ul></li>
  <li><a href="#create-the-instances" id="toc-create-the-instances" class="nav-link" data-scroll-target="#create-the-instances">3. Create the Instances</a></li>
  <li><a href="#check-the-instances-are-accessible" id="toc-check-the-instances-are-accessible" class="nav-link" data-scroll-target="#check-the-instances-are-accessible">4. Check the Instances Are Accessible</a>
  <ul class="collapse">
  <li><a href="#use-lginstance.sh-to-login-to-instances" id="toc-use-lginstance.sh-to-login-to-instances" class="nav-link" data-scroll-target="#use-lginstance.sh-to-login-to-instances">Use <code>lginstance.sh</code> to login to instances</a></li>
  <li><a href="#lginstance.sh-works-the-same-using-or-not-using-domain-names" id="toc-lginstance.sh-works-the-same-using-or-not-using-domain-names" class="nav-link" data-scroll-target="#lginstance.sh-works-the-same-using-or-not-using-domain-names"><code>lginstance.sh</code> works the same using or not using domain names</a></li>
  <li><a href="#not-using-domain-names-workshop-participants-use-ip-addresses" id="toc-not-using-domain-names-workshop-participants-use-ip-addresses" class="nav-link" data-scroll-target="#not-using-domain-names-workshop-participants-use-ip-addresses">Not using domain names = workshop participants use IP addresses</a></li>
  </ul></li>
  <li><a href="#understand-the-results-of-creating-instances" id="toc-understand-the-results-of-creating-instances" class="nav-link" data-scroll-target="#understand-the-results-of-creating-instances">5. Understand the Results of Creating Instances</a>
  <ul class="collapse">
  <li><a href="#results-files-in-the-outputs-directory-managing-domain-names" id="toc-results-files-in-the-outputs-directory-managing-domain-names" class="nav-link" data-scroll-target="#results-files-in-the-outputs-directory-managing-domain-names">Results files in the <code>outputs</code> directory — managing domain names</a></li>
  <li><a href="#each-instance-name-is-the-key-to-access-each-instance-results-files-in-the-outputs-directory" id="toc-each-instance-name-is-the-key-to-access-each-instance-results-files-in-the-outputs-directory" class="nav-link" data-scroll-target="#each-instance-name-is-the-key-to-access-each-instance-results-files-in-the-outputs-directory">Each instance name is the key to access each instance results files in the <code>outputs</code> directory</a></li>
  <li><a href="#results-files-in-the-outputs-directory-not-managing-domain-names" id="toc-results-files-in-the-outputs-directory-not-managing-domain-names" class="nav-link" data-scroll-target="#results-files-in-the-outputs-directory-not-managing-domain-names">Results files in the <code>outputs</code> directory — NOT managing domain names</a></li>
  <li><a href="#ip-addressess-for-workshop-participants" id="toc-ip-addressess-for-workshop-participants" class="nav-link" data-scroll-target="#ip-addressess-for-workshop-participants">IP addressess for workshop participants</a></li>
  </ul></li>
  <li><a href="#typical-instances-life-cycle-create-stop-start-and-delete-instances" id="toc-typical-instances-life-cycle-create-stop-start-and-delete-instances" class="nav-link" data-scroll-target="#typical-instances-life-cycle-create-stop-start-and-delete-instances">6. Typical Instances Life Cycle: create, stop, start and delete instances</a>
  <ul class="collapse">
  <li><a href="#creating-instances-one-or-more-days-before-a-workshop-starts" id="toc-creating-instances-one-or-more-days-before-a-workshop-starts" class="nav-link" data-scroll-target="#creating-instances-one-or-more-days-before-a-workshop-starts">Creating instances one or more days before a workshop starts</a></li>
  <li><a href="#stopping-the-instances-shortly-after-within-minutes-they-are-created" id="toc-stopping-the-instances-shortly-after-within-minutes-they-are-created" class="nav-link" data-scroll-target="#stopping-the-instances-shortly-after-within-minutes-they-are-created">Stopping the instances shortly after (within minutes) they are created</a></li>
  <li><a href="#re-starting-the-instances-just-before-the-workshop" id="toc-re-starting-the-instances-just-before-the-workshop" class="nav-link" data-scroll-target="#re-starting-the-instances-just-before-the-workshop">Re-starting the instances just before the workshop</a></li>
  <li><a href="#deleting-instances-and-related-resources-once-a-workshop-is-over" id="toc-deleting-instances-and-related-resources-once-a-workshop-is-over" class="nav-link" data-scroll-target="#deleting-instances-and-related-resources-once-a-workshop-is-over">Deleting instances and related resources once a workshop is over</a>
  <ul class="collapse">
  <li><a href="#the-results-of-stopping-starting-and-deleting-instances-are-also-saved-to-files" id="toc-the-results-of-stopping-starting-and-deleting-instances-are-also-saved-to-files" class="nav-link" data-scroll-target="#the-results-of-stopping-starting-and-deleting-instances-are-also-saved-to-files">The results of stopping, starting and deleting instances are also saved to files</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#unforseen-instance-management" id="toc-unforseen-instance-management" class="nav-link" data-scroll-target="#unforseen-instance-management">7. Unforseen Instance Management</a>
  <ul class="collapse">
  <li><a href="#avoid-modifying-an-instancesnamesfile-that-you-have-already-used-to-create-intances" id="toc-avoid-modifying-an-instancesnamesfile-that-you-have-already-used-to-create-intances" class="nav-link" data-scroll-target="#avoid-modifying-an-instancesnamesfile-that-you-have-already-used-to-create-intances">Avoid modifying an “instancesNamesFile” that you have already used to create intances</a></li>
  <li><a href="#the-scripts-check-instance-operations-are-valid-given-the-state-of-the-running-environment" id="toc-the-scripts-check-instance-operations-are-valid-given-the-state-of-the-running-environment" class="nav-link" data-scroll-target="#the-scripts-check-instance-operations-are-valid-given-the-state-of-the-running-environment">The Scripts <em>check</em> &nbsp;instance operations are <em>valid</em> &nbsp;given the state of the running environment</a></li>
  <li><a href="#using-multiple-instancenamesfiles-to-manage-unforseen-instances-management-requests" id="toc-using-multiple-instancenamesfiles-to-manage-unforseen-instances-management-requests" class="nav-link" data-scroll-target="#using-multiple-instancenamesfiles-to-manage-unforseen-instances-management-requests">Using multiple “<em>instanceNamesFile</em>”s to manage unforseen instances management requests</a></li>
  </ul></li>
  <li><a href="#troubleshooting" id="toc-troubleshooting" class="nav-link" data-scroll-target="#troubleshooting">8. Troubleshooting</a>
  <ul class="collapse">
  <li><a href="#connection-timed-out-or-connection-refused-messages-persist" id="toc-connection-timed-out-or-connection-refused-messages-persist" class="nav-link" data-scroll-target="#connection-timed-out-or-connection-refused-messages-persist">“<strong>Connection timed out</strong>” or “<strong>Connection refused</strong>” messages persist</a></li>
  <li><a href="#warning-remote-host-identification-has-changed" id="toc-warning-remote-host-identification-has-changed" class="nav-link" data-scroll-target="#warning-remote-host-identification-has-changed"><strong>WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED</strong></a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/Cloud-SPAN/nerc-metagenomics-v2q/edit/main/docs/lesson02-managing-aws-instances/02-instances-management.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/Cloud-SPAN/nerc-metagenomics-v2q/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../docs/lesson02-managing-aws-instances/index.html">Managing AWS Instances</a></li><li class="breadcrumb-item"><a href="../../docs/lesson02-managing-aws-instances/02-instances-management.html">Instances Management Tasks Using the Scripts</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Instances Management Tasks Using the Scripts</h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prerequisites
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Please read <a href="../../index.html#workshops-organisation">Workshops Organisation</a></strong> if you haven’t done so.</p>
<p>If you are attending a workshop using a <strong>Cloud-SPAN AWS account</strong>, you <strong>will be given</strong> the necessary information at the workshop.</p>
<p>If you are self-studying the course <strong>or</strong> attending a workshop using <strong>your AWS account</strong>, you will need:</p>
<ul>
<li>to have created your AWS account as described in episode <a href="../../docs/lesson01-setting-work-envs/01-create-aws-account.html">Create Your AWS Account</a>.</li>
<li>to have configured your AWS account as described in episode <a href="../../docs/lesson01-setting-work-envs/02-configure-account.html">Configure Your AWS Account</a>.</li>
<li>to have configured your terminal environment as described in either of these episodes:
<ul>
<li><a href="../../docs/lesson01-setting-work-envs/03-configure-terminal.html">Configure Your Terminal Environment</a> — <strong>or</strong></li>
<li><a href="../../docs/lesson01-setting-work-envs/04-configure-cloudshell.html">Configure Your AWS CloudShell Environment</a></li>
</ul></li>
<li>to have configured instances internet access as described in episode <a href="../../docs/lesson02-managing-aws-instances/01-configure-instances-internet.html">Configure Instances Internet Access</a> to get your:
<ul>
<li><strong>host zone</strong> (base domain name) and <strong>host-zone-id</strong> —— <strong><em>OPTIONAL</em></strong> (read the Overview of that episode).</li>
<li><strong>security-group-id</strong></li>
<li><strong>subnet-id</strong> —— <strong><em>OPTIONAL</em></strong> (idem.)</li>
</ul></li>
<li>the AWS Console login details of your IAM user account: <strong>login page</strong>, <strong>username</strong> and <strong>password</strong>.</li>
</ul>
</div>
</div>
<section id="overview" class="level1">
<h1>Overview</h1>
<p>This episode will guide you through the main tasks involved in creating and managing AWS instances for a course/workshop, including: configuring the Scripts, running the Scripts, and auxiliary tasks such as managing worshop cancellations and troubleshooting.</p>
<section id="sections" class="level4">
<h4 class="anchored" data-anchor-id="sections"><strong>Sections</strong></h4>
<ol type="1">
<li><p><strong><a href="#the-scripts-running-environment">The Scripts Running Environment</a></strong><br>
This section introduces the Scripts, the directory-file structure the Scripts require to run successfully, and the <strong>constraints you need to observe in configuring and running the Scripts</strong>.</p></li>
<li><p><strong><a href="#configure-the-scripts-running-environment">Configure the Scripts Running Environment</a></strong><br>
You will create a running environment for the Scripts within your terminal environment: a Git Bash terminal, a Linux terminal, a Mac terminal or the AWS CloudShell terminal. You will create the directory-file structure that will enable the Scripts to manage a few AWS instances.</p></li>
<li><p><strong><a href="#create-the-instances">Create the Instances</a></strong><br>
You will create the instances specified in Section 2 and this will generate some results. The results generated and displayed to the terminal by the Scripts that create AWS resources (instances, login key files, etc.) will be explained to help you understand how the Scripts work.</p></li>
<li><p><strong><a href="#check-the-instances-are-accessible">Check the Instances Are Accessible</a></strong><br>
Once instances are created, it is convenient to check that they are accessible through <code>ssh</code> by logging in to a few of them. This section will show you how to login to instances in a way easier than using <code>ssh</code> directly.</p></li>
<li><p><strong><a href="#understand-the-results-of-creating-instances">Understand the Results of Creating Instances</a></strong><br>
Creating AWS resources involves making AWS requests that return back results that are saved to files within the Scripts running environment. These files are crucial for the successful operation of the Scripts in stopping, starting and eventually deleting the created resources. These files are explained in this section to round up your understanding of how the Scripts work.</p></li>
<li><p><strong><a href="#typical-instances-life-cycle-create-stop-start-and-delete-instances">Typical Instances Life Cycle: create, stop, start and delete instances</a></strong><br>
This section describes the typical use-case scenario of instances management for a workshop /course. It describes our approach to instances management using both the <strong>terminal</strong> and the AWS Console. This section also describes <strong>how to create instances in two steps</strong> in order to reduce costs when deploying relatively large instances in terms of storage.</p></li>
<li><p><strong><a href="#unforseen-instance-management">Unforeseen Instance Management</a></strong><br>
This section describes our approach to handle unforeseen instance management requests such as creating additional instances for a workshop due to late registrations, or deleting some (not all) instances before the end of a workshop due to cancellations.</p></li>
<li><p><strong><a href="#troubleshooting">Troubleshooting</a></strong><br>
This section presents some problems we have come across in managing instances and how to solve them.</p></li>
</ol>
</section>
</section>
<section id="the-scripts-running-environment" class="level1">
<h1>1. The Scripts Running Environment</h1>
<p>These are Scripts that create and manage AWS instances</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Listing</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="Listing"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>aws_domainNames_create.sh       aws_instances_terminate.sh      csinstances_create.sh</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>aws_domainNames_delete.sh       aws_loginKeyPair_create.sh      csinstances_delete.sh</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>aws_instances_configure.sh      aws_loginKeyPair_delete.sh      csinstances_start.sh</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>aws_instances_launch.sh         colour_utils_functions.sh       csinstances_stop.sh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The four scripts <code>csinstances_*.sh</code> (on the right) are to be run by the <strong>admin user</strong> of the Scripts, the person in charge of creating, configuring, stopping, starting and deleting AWS instances for a workshop /course. The scripts <code>aws_*.sh</code> are invoked by the scripts <code>csinstances_create.sh</code> or <code>csinstances_delete.sh</code> to either create or delete instances and related resources, that is: domain names, IP addresses, and login keys.</p>
<p>The file <code>colours_utils_functions.sh</code> provides (is “sourced” by) the other scripts with text colouring functions (for the results of the other scripts to be easier to read) and utility functions that validate the invocation and results of the other scripts.</p>
<section id="file-directory-structure-to-manage-instances-for-workshops" class="level3">
<h3 class="anchored" data-anchor-id="file-directory-structure-to-manage-instances-for-workshops">File-directory structure to manage instances for workshops</h3>
<p>You have configured your AWS account and terminal environment as described in the previous episodes. Now, prior to creating instances for a workshop, you must create and organise <strong>three ﬁles</strong> as follows:</p>
<ul>
<li><p><em>instancesNamesFile.txt</em> — contains the names of the instances to be created and managed. <strong>Only the name of this ﬁle can be changed if preferred</strong>. This ﬁle must contain only one instance name per line, and each instance name must start with an alphabetic character followed by alpha-numeric characters, hyphens (-) or underscores (_) only.</p></li>
<li><p><code>resourcesIDs.txt</code>— contains a set of space-separated “key value” pairs that specify the AWS resources to use in creating each instance and related resources. This is the contents of the <code>resourcesIDs.txt</code> ﬁle we use to create instances for the <a href="https://cloud-span.github.io/00genomics/">Cloud-SPAN Genomics course</a>:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>resourcesIDs.txt for Cloud-SPAN Genomics course</strong></pre>
</div>
<div class="sourceCode" id="cb2" data-filename="resourcesIDs.txt for Cloud-SPAN Genomics course"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>KEYWORD           VALUE examples (Cloud-SPAN's for Genomics course using domain names)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                                    ## NB: "key value" pairs can be specified in any order</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>imageId           ami-07172f26233528178       ## NOT optional: instance template (AMI) ..</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>instanceType      t3.small                    ## NOT optional: processor count, memory ..</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>securityGroupId   sg-0771b67fde13b3899        ## NOT optional: should allow ssh (port 22)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>subnetId          subnet-00ff8cd3b7407dc83    ## optional: search vpc in AWS console &amp; ..</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>hostZone          cloud-span.aws.york.ac.uk   ## optional: specify to use domain names</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>hostZoneId        Z012538133YPRCJ0WP3UZ       ## optional: specify to use domain names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><!-- #:::{.column-body-outset} it breaks the bullets list --> <!-- #::: --></p>
<p>As shown in this example, a <code>resourcesIDs.txt</code> ﬁle can have comments in addition to the “key value” pairs to specify. The “key value” pairs can be speciﬁed in any order, but each key word must be the ﬁrst item in a line and its corresponding value the second item in the same line. The key words in the example must be used, but they are NON-case sensitive. The three not optional “key value” pairs must be speciﬁed.</p>
<p>The values are all validated. The value of <code>imageId</code> is validated to correspond to an AMI in the user’s AWS account or to a public AMI available in the AWS region on which the scripts are running. The value of <code>instanceType</code> is validated to be a valid AWS instance type. The values of <code>securityGroupId</code>, <code>subnetId</code>, <code>hostZone</code> and <code>hostZoneId</code> are validated to exist in the user’s AWS account.</p>
<p>The key word <code>subnetId</code> and its value are optional. If not speciﬁed, the scripts will try to obtain a subnetID from the user’s AWS account. We have successfully tested the scripts to obtain and use a subnetID running the scripts with a personal AWS account and with an institutional AWS account. If the scripts cannot obtain a subnet-id, they will display a message describing how to obtain a subnet-id (see section <a href="../../docs/lesson02-managing-aws-instances/01-configure-instances-internet.html#select-an-aws-subnet-to-access-the-instances">Select an AWS Subnet to Access the Instances</a>). If you are using an AWS institutional account, you may need to contact your IT department — AWS allocates default subnets to each account but these may have been changed by your IT department.</p>
<p>The keywords <code>hostZone</code> and <code>hostZoneId</code> and their values are optional. If speciﬁed and valid, each instance will be accessed using a domain name such as the following: <code>instance01.cloud-span.aws.york.ac.uk</code>, where <code>instance01</code> is an example of a speciﬁed instance name and <code>cloud-span.aws.york.ac.uk</code> is the base domain name (<code>hostZone</code>) in this example. If <code>hostZone</code> and <code>hostZoneId</code> and their values <strong>are not speciﬁed</strong>, each instance will be accessed using the public IP address or the generic domain name allocated by AWS, which will look like the following: <code>34.245.22.106</code> or <code>ec2-34-245-22-106.eu-west-1.compute.amazonaws.com</code>.</p></li>
<li><p><code>tags.txt</code> — contains a set of space-separated “key value” pairs to tag instances and related resources upon creation. <strong>This ﬁle is optional</strong>. If speciﬁed, it must contain only one “key value” pair per line. Up to 10 “key value” pairs are processed. Examples:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>tags.txt - Cloud-SPAN</strong></pre>
</div>
<div class="sourceCode" id="cb3" data-filename="tags.txt - Cloud-SPAN"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>group        BIOL</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>project      cloud-span</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>status       prod</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>pushed_by    manual</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
<p>The three files (<em>instancesNamesFile.txt</em>, <code>resourcesIDs.txt</code> and <code>tags.txt</code>) must be placed (or created) <strong>inside</strong> a directory called <code>inputs</code>, and the <code>inputs</code> directory must be placed <strong>inside</strong> within at least one other directory whose name you can choose, and to which we refer to as <strong>Workshop Environment</strong> (WE). We use this directory structure to manage instances for our workshops:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Listing</strong></pre>
</div>
<div class="sourceCode" id="cb4" data-filename="Listing"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>courses                         ### you can omit this directory or use other name</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>   genomics01                   ### workshop/course WE name; you can use other name</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>      inputs                    ### you CANNOT use other name</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>         instancesNames.txt     ### you can use other name </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>         resourcesIDs.txt       ### you CANNOT use other name</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>         tags.txt               ### you CANNOT use other name</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      outputs                   ### created automatically by the Scripts - do not modify</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>   genomics02                   ### another WE: inputs and outputs directories inside</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>   metagenomics01               ### another WE: inputs and outputs directories inside</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We handle a <em>courses</em> directory that contains a WE directory for each course /workshop that we run, for example: <em>genomics01</em>, <em>genomics02</em>, <em>metagenomics01</em>, etc. Each course directory has its <code>inputs</code> directory and inside the three three files mentioned above: <em>instancesNames.txt</em>, <code>resourcesIDs.txt</code>, and <code>tags.txt</code> (note that we are using <em>this style</em> for file/directory names you can choose and <code>this style</code> for file/directory names you cannot change).</p>
<p>You must create the directory structure above, or a similar one, and those three files before running the Scripts to create the instances for a course.</p>
<p>The <code>outputs</code> directory inside each WE directory is created automatically by the Scripts to save the <strong>results</strong> of running the Scripts.</p>
</section>
<section id="how-to-run-the-scripts-overview-and-constraints" class="level3">
<h3 class="anchored" data-anchor-id="how-to-run-the-scripts-overview-and-constraints">How to run the Scripts — overview and constraints</h3>
<p>To run any of the Scripts you only need to pass the name of your file <em>instancesNames.txt</em> as a parameter to the script you want to run.</p>
<p>The Scripts can access the files <code>resourcesIDs.txt</code> and <code>tags.txt</code> based on the location of <em>instancesNames.txt</em>.</p>
<p>Assuming the directory structure and file names above, the script <code>csinstances_create.sh</code> should be run as shown in these two code boxes (see notes below):</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb5" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> csinstances_create.sh  courses/genomics01/inputs/instancesNames.txt </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span>                                                       <span class="co">### RESULTS  </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb6" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd courses/</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~/courses</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> csinstances_create.sh  genomics01/inputs/instancesNames.txt </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span>                                                       <span class="co">### RESULTS </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the code boxes:</p>
<ul>
<li>we are showing our <strong>terminal prompt</strong> to highlight the current working directory from which <code>csinstances_create.sh</code> is being run.</li>
<li>our shell prompt is configured to use two lines, displaying <code>csuser@csadmin-instance: working-dir</code> in the first line, and the dollar sign <code>$</code> on its own on the second line.</li>
<li>the <strong><em>courses</em></strong> directory was created at the home (<code>~</code>) directory</li>
<li>in the first code box, you are running <code>csinstances_create.sh</code> while being in the home directory; hence the file name (relative path) that you must pass to <code>csinstances_create.sh</code> is <code>courses/genomics01/inputs/instancesNames.txt</code></li>
<li>in the second code box, you are first moving to the <em>courses</em> directory with the command <code>cd</code>; hence the file name (relative path) that you must pass to <code>csinstances_create.sh</code> is <code>genomics01/inputs/instancesNames.txt</code></li>
</ul>
<section id="dont-run-the-scripts-with-a-relative-path-that-does-not-include-the-name-of-the-courseworkshop-we-directory-they-will-fail" class="level4">
<h4 class="anchored" data-anchor-id="dont-run-the-scripts-with-a-relative-path-that-does-not-include-the-name-of-the-courseworkshop-we-directory-they-will-fail"><strong>DON’T RUN</strong> the Scripts <strong>with a relative path that does not include the name of the “<em>course/workshop</em>” WE</strong> directory — <strong>they will fail</strong></h4>
<p>Following the code examples above, you should not move into the <em>genomics01</em> directory and run the scripts as shown below:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb7" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~/courses</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd genomics01/</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~/courses/genomics01</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> csinstances_create.sh  inputs/instancesNames.txt </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span>                                          <span class="co">### FAILURE RESULTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, the following will work:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb8" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~/courses/genomics01</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> csinstances_create.sh  ../genomics01/inputs/instancesNames.txt </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> csinstances_create.sh  ~/courses/genomics01/inputs/instancesNames.txt </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The reason to force the specification of the “course/workshop” WE directory name in running the Scripts is to prevent (reduce the likelihood of) running the Scripts in the wrong place, which can happen when you are managing instances for different courses or test runs at the same time.</p>
</section>
<section id="running-the-other-scripts" class="level4">
<h4 class="anchored" data-anchor-id="running-the-other-scripts"><em>Running the other Scripts</em>:</h4>
<p>All the Scripts are run in the same way, passing as parameter the name of your file <em>instancesNames.txt</em> as shown below:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb9" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> csinstances_stop.sh         genomics01/inputs/instancesNames.txt </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> csinstances_start.sh        genomics01/inputs/instancesNames.txt </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> csinstances_delete          genomics01/inputs/instancesNames.txt </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws_domainNames_create.sh   genomics01/inputs/instancesNames.txt </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="ex">..</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws_loginKeyPair_delete.sh  genomics01/inputs/instancesNames.txt </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>While the scripts <code>aws_*.sh</code> are meant to be run (invoked) only by the scripts <code>csinstances_*.sh</code>, <strong>running the scripts <code>aws_*.sh</code> directly by the user</strong> may be useful for improving them or fixing a failed step in creating multiple instances, as will be discussed later in the section <a href="#troubleshooting">Troubleshooting</a> below.</p>
</section>
</section>
</section>
<section id="configure-the-scripts-running-environment" class="level1">
<h1>2. Configure the Scripts Running Environment</h1>
<p>This and the subsequent sections are hands-on. In this section you are going to configure the Scripts running environment for a sample course. You will use this environment in subsequent sections to create and manage instances. In this section you are going to:</p>
<ul>
<li>create the workshop environment (WE) directory structure <code>courses/instances-management/inputs</code> at the home directory</li>
<li>create the three configuration files: <em>instancesNames.txt</em>, <code>resourcesIDs.txt</code> and <code>tags.txt</code></li>
<li>configure the AWS CLI (command line interface) — <em>if you are attending a workshop <strong>using a Cloud-SPAN AWS account</strong></em></li>
</ul>
<p>While you can choose a different name for the file <em>instancesNames.txt</em> and for the parent directories of the <code>inputs</code> directory, for this course we recommend that you use the names suggested as otherwise you will have to adapt the intructions below.</p>
<section id="create-the-we-directory-structure" class="level3">
<h3 class="anchored" data-anchor-id="create-the-we-directory-structure">Create the WE directory structure</h3>
<p>Open your (Git Bash, Linux, Mac, or AWS CloudShell) terminal where you installed the Scripts.</p>
<p>Being at the home directory (<code>~</code>), type the <code>mkdir</code> command below and press Enter to create the directory structure:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb10" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mkdir <span class="at">-p</span> courses/instances-management/inputs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The option <code>-p</code> (or <code>--parents</code>) tells <code>mkdir</code> to create parent directories as needed, and not to complain if any of those directories exist.</p>
</section>
<section id="create-the-files-instancesnames.txt-resourcesids.txt-and-tags.txt" class="level3">
<h3 class="anchored" data-anchor-id="create-the-files-instancesnames.txt-resourcesids.txt-and-tags.txt">Create the files: <em>instancesNames.txt</em>, <code>resourcesIDs.txt</code> and <code>tags.txt</code></h3>
<p>You will normally use your preferred editor to create those files. However, to simplify things somewhat you are going to use (copy) the files that we have prepared beforehand.</p>
<p>The commands to copy those files to your WE are inside in one of the bars below. Click on the bar that corresponds to “<em>how you are taking this course</em>” to display the commands you will type:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
You are attending a workshop <strong>using a Cloud-SPAN AWS</strong> account
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You must be in your home directory. Copy those files to your WE <code>inputs</code> directory as follows:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb11" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cp .local/bincsaws/instances-management-course-data/inputs/<span class="pp">*</span> courses/instances-management/inputs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
You are self-studying the course or attending a workshop using your AWS account
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You must be in your home directory. The files we have prepared are in the directory <code>~/_tmp_cloudspan_aws/</code> where you downloaded the Scripts with <code>git clone ..</code> in the previous lesson. Check you have that directory with the <code>ls</code> command.</p>
<p>If you don’t have the directory <code>~/_tmp_cloudspan_aws/</code> in your terminal environment, download the Scripts again with the <code>git clone</code> command:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb12" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> git clone https://github.com/Cloud-SPAN/aws-instances.git   ~/_tmp_cloudspan_aws</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Copy the files to your WE <code>inputs</code> directory as follows:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb13" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cp _tmp_cloudspan_aws/instances-management-course-data/inputs/<span class="pp">*</span> courses/instances-management/inputs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="check-the-contents-of-each-file" class="level3">
<h3 class="anchored" data-anchor-id="check-the-contents-of-each-file">Check the contents of each file</h3>
<p>Let’s list the files you copied:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb14" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls courses/instances-management/inputs/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb15" data-filename="Output"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>instancesNames.txt  resourcesIDs.txt  tags.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remember that the <code>tags.txt</code> file is optional but we use one throughout the examples in the course.</p>
<p>Let’s look now at the contents of each file so you can later relate the inputs to the outputs of the Scripts.</p>
<section id="instancesnames.txt" class="level4">
<h4 class="anchored" data-anchor-id="instancesnames.txt"><strong><em>instancesNames.txt</em></strong></h4>
<p>The contents of the file <em>instancesNames.txt</em> you copied is shown below. We are going to create three instances with the names: instance01, instance02, instance03. We don’t need to create more instances to learn how to use the Scripts. We have used the Scripts to create up to 37 instances in one go in about 15 minutes.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb16" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cat courses/instances-management/inputs/instancesNames.txt </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb17" data-filename="Output"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>instance01</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>instance02</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>instance03</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tags.txt" class="level4">
<h4 class="anchored" data-anchor-id="tags.txt"><strong><code>tags.txt</code></strong></h4>
<p>The contents of the file <code>tags.txt</code> you copied is shown below. The instances and related resources to be created will be labelled with the tags (<em>key-value</em>) in this file (you can use other key-value’s).</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb18" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cat courses/instances-management/inputs/tags.txt </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb19" data-filename="Output"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>name        instance</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>group       BIOL</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>project     cloud-span</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>status      prod</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>pushed_by   manual</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>defined_in  manual</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="resourcesids.txt" class="level4">
<h4 class="anchored" data-anchor-id="resourcesids.txt"><strong><code>resourcesIDs.txt</code></strong></h4>
<p>The contents of the file <code>resourcesIDs.txt</code> you copied is shown below. It contains the AWS resources to use in creating instances and related resources, which means that each instance will be:</p>
<ul>
<li>a copy of the Amazon Machine Image (AMI) whose <code>imageID</code> is <code>ami-00c0ea23e53f48472</code></li>
<li>running on an <code>instanceType</code> (virtual machine hardware) <code>t3.small</code></li>
<li>using the security configuration whose securityGroupId is <code>sg-07fde18971b673b39</code></li>
<li>etc.</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb20" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cat courses/instances-management/inputs/resourcesIDs.txt </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb21" data-filename="Output"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>imageId           ami-00c0ea23e53f48472</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>instanceType      t3.small</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>securityGroupId   sg-07fde18971b673b39</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>subnetId          subnet-00f3dc83b7407df8c</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>hostZone          cloud-span.aws.york.ac.uk  </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>hostZoneId        Z012538133CJ0WPYPR3UZ    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Recall that the AWS resources specified in a <code>resourcesIDs.txt</code> file are all validated. The value of <code>imageId</code> is validated to correspond either to an AMI in your AWS account or to a public AMI available in the AWS region on which the scripts are running — the <code>imageID</code> value in the listing above corresponds to a <strong>public</strong> Cloud-SPAN AMI of size 30 GB available in the eu-west-1 (Ireland) region. The value of <code>instanceType</code> is validated to be a valid AWS instance type: <code>t3.small</code> in the listing above corresponds to an instance with 2 processors (vCPUs) and 2 Giga Bytes of main memory.</p>
<p>The values of <code>securityGroupId</code>, <code>subnetId</code>, <code>hostZone</code>, and <code>hostZoneId</code> are validated to exist in the AWS account you are using to invoke the Scripts.</p>
</section>
</section>
<section id="edit-the-file-resourcesids.txt-or-configure-the-aws-cli" class="level3">
<h3 class="anchored" data-anchor-id="edit-the-file-resourcesids.txt-or-configure-the-aws-cli">Edit the file <code>resourcesIDs.txt</code> or configure the AWS CLI</h3>
<p>Because the values of <code>securityGroupId</code>, <code>subnetId</code>, <code>hostZone</code>, and <code>hostZoneId</code> <strong>must exist in the AWS account you are using</strong> to invoke the Scripts, if you are self-studying the course or attending a workshop <strong>using your AWS account</strong>, you must edit the <strong>last four lines</strong> in that <code>resourcesIDs.txt</code> file as described within the bar “Edit <code>resourcesIDs.txt</code> — if you are using <em>your</em> AWS account” below.</p>
<p>If you are attending a workshop <strong>using a Cloud-SPAN AWS account</strong>, the values of <code>securityGroupId</code>, etc. are valid for the Cloud-SPAN account you are using. However you need to configure the AWS CLI installed in your AWS instance as described in the within the bar “Configure the AWS CLI — if you are .. using a <em>Cloud-SPAN</em> AWS account” below.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Edit <code>resourcesIDs.txt</code> if you are using <em>your</em> AWS account
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<section id="what-you-need-to-edit" class="level4">
<h4 class="anchored" data-anchor-id="what-you-need-to-edit"><em>What you need to edit</em>:</h4>
<p>You need to edit the lines that correspond to <code>securityGroupId</code>, <code>subnetId</code>, <code>hostZone</code> and <code>hostZoneId</code> as follows:</p>
<ul>
<li><code>securityGroupId</code> — change the value (<strong><em>second field in the line</em></strong>) with the value of your security group id.</li>
<li><code>subnetId</code> — change the value with the value of your subnet id — or, <strong>delete</strong> this line and let the Scripts obtain a subnet id automatically.</li>
<li><code>hostZone</code> — change the value with the value of your host zone (domain name) — or, <strong>delete</strong> this line and let the scripts create instances without domain names.</li>
<li><code>hostZoneId</code> — change the value with the value of your host zone id — or, <strong>delete</strong> this line and let the scripts create instances without domain names.</li>
</ul>
<p>You need to change the values of both <code>hostZone</code> and <code>hostZoneId</code>, or <strong>delete</strong> the two containing lines.</p>
</section>
<section id="editing-the-file-resourcesids.txt" class="level4">
<h4 class="anchored" data-anchor-id="editing-the-file-resourcesids.txt"><em>Editing the file</em> <code>resourcesIDs.txt</code></h4>
<p>You need to use a <strong>plain-text editor</strong> such as <code>nano</code>, <code>vim</code>, <code>emacs</code>, etc., to update the file <code>resourcesIDs.txt</code> so that no special characters get into the file which may cause the Scripts to fail.</p>
<p>The editors <code>nano</code> and <code>vim</code> are available both in the Git Bash terminal and the AWS CloudShell terminal.</p>
<p>If you are using the AWS CloudShell terminal, you can download the file to your machine and edit it there with your preferred <strong>plain text editor</strong>, and upload it back to your <em>AWS CloudShell enviroment</em>. The screenshot below shows the menu to download and upload files:</p>
<p><img src="../../images/02-instances-management/01-aws-cloudshell-actions-menu.png" class="img-fluid" alt="Screenshot of AWS Console page in a browser showing the AWS CloudShell terminal with the options Actions, Download File and Upload File circled." width="900"></p>
</section>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Configure the AWS CLI if you are .. using a <em>Cloud-SPAN</em> AWS account
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The AWS CLI (command line interface) is a software tool that enables you to interact with AWS through commands that can be run either on a terminal or within shell scripts.</p>
<p>The Scripts invoke /run the AWS CLI to make requests to manage (create, allocate, …, and delete) AWS services such as instances, storage, etc. For such requests to be successful, the AWS CLI must be configured to use an AWS account.</p>
<p>The AWS instance provided to you by the Cloud-SPAN team has already installed the Scripts and the AWS CLI, <strong>but</strong> the <strong>AWS CLI is not configured</strong> yet for security reasons.</p>
<p>To configure the AWS CLI in your instance, run the command <code>aws configure</code> as shown below:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb22" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws configure</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The following four prompts will be displayed, one at a time:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>aws configure prompts</strong></pre>
</div>
<div class="sourceCode" id="cb23" data-filename="aws configure prompts"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>AWS Access Key ID []:</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>AWS Secret Access Key []:</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>Default region name []:</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>Default output format []:</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Please <strong>wait for</strong> the workshop instructor to give you the <strong>data values</strong> to enter to each prompt.</p>
<p>Once you have entered the fourth value, the AWS CLI in your instance will be ready to use. Then, check the configuration by running the following command:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb24" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">aws</span> ec2 get-vpn-connection-device-types</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If your configuration is correct, you should see an output like this:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb25" data-filename="Output"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    "VpnConnectionDeviceTypes": [</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>            "VpnConnectionDeviceTypeId": "36ef5d04",</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>            "Vendor": "Barracuda",</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>            "Platform": "NextGen Firewall F-Series",</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>            "Software": "6.2+"</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If instead you see an authorisation failure message like the one below, your configuration is not right. Run <code>aws configure</code> again and check that you properly copy-paste the values you were given.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb26" data-filename="Output"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>An error occurred (AuthFailure) when calling the GetVpnConnectionDeviceTypes operation: AWS was not able to validate the provided access credentials</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="create-the-instances" class="level1">
<h1>3. Create the Instances</h1>
<p>To create the instances specified in the previous section, you only need to run <code>csinstances_create.sh</code> as shown below while being at the home directory (use the <code>Tab</code> key to complete the names of the script, the directories and the file):</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb27" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> csinstances_create.sh courses/instances-management/inputs/instancesNames.txt </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once you press <code>Enter</code> the output you will see in your terminal will be like the one in the screenshot below:</p>
<p>Creating instances involves <strong>ﬁve</strong> or <strong>four</strong> steps depending on whether domain names to access instances are to be managed or not:</p>
<ol type="1">
<li><p><strong>Validating the contents of the Scripts conﬁguration ﬁles</strong>: <em>instancesNames.txt</em>, <code>tags.txt</code> (if found), and <code>resourcesIDs.txt</code>. The validation is as described above and outlined in the screenshot below. The files <code>tags.txt</code> and <code>resourcesIDs.txt</code> are accessed by the Scripts based on the path of the file <em>instancesName.txt</em> passed as a parameter. If <strong>no problem</strong> is found in these ﬁles, the option to continue with the conﬁguration detected, regarding managing or not managing domain names to access instances, is displayed for the user to conﬁrm or cancel the run.</p>
<p><img src="../../images/02-instances-management/fig01-scripts-run-validating-config-files.png" class="img-fluid" alt="Screenshot of Linux terminal showing the terminal prompt, the run of the command csinstances_create.sh courses/instances-management/inputs/instancesNames.txt, and part of the output results of that command." width="900"></p>
<p>If <strong>there is a problem</strong> a problem in any of the files, messages (not shown in the screenshot) are displayed to specify the speciﬁc problem/s in each ﬁle and the run is aborted.<br>
</p>
<p>In the screenshot above, the conﬁguration detected corresponds to <strong>managing domain names</strong> to access instances; that is, <code>hostZone</code> and <code>hostZoneId</code> and valid values were speciﬁed in the <code>resourcesIDs.txt</code> ﬁle and found to be valid.<br>
If <code>hostZone</code> and <code>hostZoneId</code> <strong>are not</strong> speciﬁed, the option to continue looks like this:<br>
</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Option message to continue with no domain names</strong></pre>
</div>
<div class="sourceCode" id="cb28" data-filename="Option message to continue with no domain names"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>--&gt; NO base domain name was FOUND.</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>Each instance to be created will be accessed with the IP address or the generic domain name provided by AWS, which look like this: 34.245.22.106 or ec2-34-245-22-106.eu-west-1.compute.amazonaws.com.</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>Would you like to continue (y/n)?:</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now <strong>Type</strong> <code>y</code> and <strong>press</strong> <code>Enter</code> to continue with steps 2, 3 and 4, which are shown in the screenshot below.</p></li>
<li><p><strong>Creating the login keys</strong>. Login keys are created first because their resource ID’s must be passed as parameters to create the corresponding instances.</p></li>
<li><p><strong>Creating the instances</strong>, each conﬁgured to use one of the login keys created in the previous step. When an instance is created (launched for the ﬁrst time), or started after having been stopped, AWS randomly allocates an IP address to the instance. The IP address of each instance is used in step 4 below if domain names are to be managed.</p></li>
<li><p><strong>Creating the instance domain names</strong> as mapped to the respective instance IP addresses — this step <strong>is only run</strong> if <code>hostZone</code>, <code>hostZoneId</code> and valid values are speciﬁed in the <code>resourcesIDs.txt</code> ﬁle.</p>
<p><img src="../../images/02-instances-management/fig02-scripts-run-creating-instances.png" class="img-fluid" alt="Screenshot of Linux terminal showing the terminal prompt, the run of the command csinstances_create.sh courses/instances-management/inputs/instancesNames.txt, and part of the output results of that command." width="900"></p></li>
<li><p><strong>Conﬁguring each instance</strong>, both to enable the <code>csuser</code> account (used by workshop participants) to be logged in and to change the instance host name to the instance name used to create the instance (the default host name is the instance IP address), see notes below.</p>
<p><img src="../../images/02-instances-management/fig03-scripts-run-configuring-instances.png" class="img-fluid" alt="Screenshot of Linux terminal showing the terminal prompt, the run of the command csinstances_create.sh courses/instances-management/inputs/instancesNames.txt, the instances configuration step." width="900"></p>
<ul>
<li>a newly created instance can only be accessed through the <code>ubuntu</code> user account. It is the only account that is enabled to be logged in by the AWS service that launches instances. When an instance runs (boots) for the ﬁrst time, that service adds the public key part of the login key created to access the instance to the ﬁle <code>/home/ubuntu/.ssh/authorized_keys</code>. Thereafter, the private key part of the login key can be used with <code>ssh</code> to access the <code>ubuntu</code> account. To enable the <code>csuser</code> account to be logged in in each instance, this configuring step runs a Bash script in the <code>ubuntu</code> account (in each instance) that copies that file (<code>../authorized_keys</code>) to the <code>csuser</code> account in <code>/home/csuser/.ssh/authorized_keys</code>.</li>
<li>the default “<strong><em>host name</em></strong>” of a newly created instance is its IP address. As such, the terminal prompt when accessing an instance with <code>ssh</code> looks like this: <code>csuser@52.212.13.253:~ $</code> and <code>ubuntu@52.212.13.253:~ $</code>. This configuring step changes the default host name to the instance domain name (or the instance name if domain names are not being managed) through remotely invoking on each instance the command <code>sudo hostnamectl set-hostname "instance-domain-name"</code> (or “<code>instance-name</code>” if domain names are not being managed). Thereafter, the terminal prompt when accessing an instance with <code>ssh</code> looks like this: <code>csuser@instance01:~ $</code> and <code>ubuntu@instance01.cloud-span.aws.york.ac.uk:~ $</code>.</li>
</ul></li>
</ol>
<p>Steps 2, 3, 4, and 5 are respectively performed by the scripts <code>aws_loginKeyPair_create.sh</code>, <code>aws_instances_launch.sh</code>, <code>aws_domainNames_create.sh</code>, and <code>aws_instances_configure.sh</code>. The script <code>csinstances_create.sh</code> invokes those scripts after validating the Scripts configuration files (step 1).</p>
<p>Those scripts display to the terminal only <strong>part of</strong> the results of creating or configuring the relevant resources, and save all of those results to files in the <code>outputs</code> directory, as described below.</p>
</section>
<section id="check-the-instances-are-accessible" class="level1 page-columns page-full">
<h1>4. Check the Instances Are Accessible</h1>
<p>You should now be able to login to the instances you just created. It is convenient to login to a few of the instances that you create for a course to verify that they are reachable, and hence everything went as expected.</p>
<p>You can login to an instance as shown in the introduction to this lesson, running <code>ssh</code> specifying the login key with the <code>-i</code> (identity file) option, the <code>csuser</code>, and the instance domain name or instance IP address, that is:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb29" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ssh <span class="at">-i</span> login-key-instance01.pem  csuser@instance01.cloud-span.aws.york.ac.uk</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">### or</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ssh <span class="at">-i</span> login-key-instance01.pem  csuser@52.212.13.253</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, using <code>ssh</code> as shown above is adequate for the end user of each instance who will be using the same <code>ssh</code> command to access the same instance throughout a course, while being at the directory where the login key file has been stored.</p>
<p>As the <strong>admin user</strong> of the Scripts that manage multiple instances, at times managing two or more courses or tests simultaneously, you need to be able to login to different instances more easily.</p>
<section id="use-lginstance.sh-to-login-to-instances" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="use-lginstance.sh-to-login-to-instances">Use <code>lginstance.sh</code> to login to instances</h3>
<p>The script <code>lginstance.sh</code> will help you login to instances more easiyly — it was downloaded into your environment along with the Scripts. It is used specifying only the <strong>instance login key file</strong> and the <strong>user account</strong> to login to, either <code>csuser</code> or <code>ubuntu</code> — both users use the same login key files. Assuming the configuration files used above, and being at the home directory, logging into <em>instance01</em> would be thus:</p>
<!-- ::: {.column-screen} FULL WIDTH -->
<!-- ::: {.column-screen-inset} same as .column-page -->
<div class="column-page">
<!-- ::: {.column-body-outset} -->
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb30" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> lginstance.sh  courses/instances-management/outputs/login-keys/login-key-instance01.pem  csuser</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">lginstance.sh:</span> logging you thus:     <span class="co">### this and the next line are displayed by lginstance.sh</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ssh</span> <span class="at">-i</span> courses/instances-management/outputs/login-keys/login-key-instance01.pem  csuser@instance01.cloud-span.aws.york.ac.uk</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">### Welcome message from instance01</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@instance01:∼</span>                    <span class="co">### instance01 prompt</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p><code>lginstance.sh</code> builds the <code>ssh</code> command you need to login to an instance and runs it. The login keys are in the directory <code>~/courses/instances-management/outputs/login-keys/</code>, so you need to specify the relative path (from your current working directory) to the corresponding login key file.</p>
<p>That long command is rather easy to enter using the <code>Tab</code> key for the shell to complete the name of the script <code>lginstance.sh</code>, the names of the intermediate directories and the name of the login key .pem file. <strong>Try it</strong>.</p>
<p>What we found would get on the way (before developing <code>lginstance.sh</code>) was specifying the pair user@instance-domain-name (<code>csuser@instance01.cloud-span.aws.york.ac.uk</code>) because <strong>the shell cannot help you complete it</strong> using the <code>Tab</code> key (because it only complets command names and file names).</p>
</section>
<section id="lginstance.sh-works-the-same-using-or-not-using-domain-names" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="lginstance.sh-works-the-same-using-or-not-using-domain-names"><code>lginstance.sh</code> works the same using or not using domain names</h3>
<p>If you are not using domain names, as admin user you can still use <code>lginstance</code> the same way, specifying the instance <strong>login key file</strong> and the <strong>user account</strong> to login, but <code>lginstance</code> will use the instance IP address (as opposed to the instance domain name) to log you in, as shown below:</p>
<div class="column-body-outset">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb31" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> lginstance.sh  courses/instances-management/outputs/login-keys/login-key-instance01.pem  csuser</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">lginstance.sh:</span> logging you thus:     <span class="co">### this and the next line are displayed by lginstance.sh</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ssh</span> <span class="at">-i</span> courses/instances-management/outputs/login-keys/login-key-instance01.pem  csuser@3.253.59.74</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co">### Welcome message from instance01  </span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@instance01:∼</span>                    <span class="co">### instance01 prompt</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>If domain names are being managed, <code>lginstance.sh</code> extracts the base domain name from the file <code>../inputs/resourcesIDs.txt</code> and prepends the instance name to create the domain name of the instance to login. Otherwise, <code>lginstance.sh</code> gets the instance IP address by querying AWS using the <code>instanceId</code> stored in the instance creation results file described in the next section.</p>
</section>
<section id="not-using-domain-names-workshop-participants-use-ip-addresses" class="level3">
<h3 class="anchored" data-anchor-id="not-using-domain-names-workshop-participants-use-ip-addresses">Not using domain names = workshop participants use IP addresses</h3>
<p>If domain names are not being used, workshop participants will need to use the IP address of their instances to login. Hence, <strong>admin users</strong> need to know where the IP address of each instance is stored, which is covered in the next section, under <a href="#ip-addressess-for-workshop-participants">IP addressess for workshop participants</a>.</p>
<p>Note that whether domain names are managed or not, the shell prompt of each instance is the instance name specified to create the instance. Thus, if an instance needs some <strong>troubleshooting</strong>, the workshop participant can specify the instance name, and the admin user can use <code>lginstance.sh</code> to login to the instance based on the instance name (and not the instance IP address).</p>
</section>
</section>
<section id="understand-the-results-of-creating-instances" class="level1">
<h1>5. Understand the Results of Creating Instances</h1>
<p>The various results of creating instances shown in the screenshots above, and <strong>other results</strong>, are saved to files in the <code>outputs</code> directory. The <code>outputs</code> directory and its content are created by the Scripts as needed, within the workshop environment (WE) directory being used, in our running example <code>~/courses/instances-management/</code>.</p>
<p>Run the <code>ls</code> command below to list the contents of the <code>outputs</code> directory:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb32" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls courses/instances-management/outputs/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output of the <code>ls</code> command should be the list of sub-directories (in brown) in the screenshot below — only the date and time at the end of the directory name <code>instances-configuration-output20240930.140046</code> will be different in your output:</p>
<p><img src="../../images/02-instances-management/05-results-of-running-csinstance_create.sh-outputs-dir.png" class="img-fluid" alt="Screenshot of Linux terminal showing the run of the command ls courses/instances-management/outputs/; the results show the names of the directories created by the scripts invoked by the scripts csinstances_create.sh." width="900"></p>
<section id="results-files-in-the-outputs-directory-managing-domain-names" class="level3">
<h3 class="anchored" data-anchor-id="results-files-in-the-outputs-directory-managing-domain-names">Results files in the <code>outputs</code> directory — managing domain names</h3>
<p>Each of the Scripts that creates or configures AWS resources <strong>sends</strong> requests to <strong>AWS</strong>. AWS validates and performs each request if it is valid, and <strong>sends back</strong> the result of the request wich states whether the request was successful or not, and if <strong>successful</strong>, the <strong>resource ID</strong> of the created resource or configuration requested along with other pieces of information.</p>
<p>Each of the Scripts that makes such requests creates a <strong>sub-directory</strong> within the <code>outputs</code> directory <strong>to save</strong> the results of each request, to a file whose name has, as a sub-string, the name of the relevant instance as specified in the input file <em>instancesNames.txt</em> that you use to create the instances.</p>
<p>The files that were created for the above run of <code>csinstances_create.sh</code> are shown in the screenshot below — use the same <code>ls</code> commands in the screenshot to list the files in each sub-directory within your <code>outputs</code> directory. If you used the instances names we suggested to create the instances, the files created by your run of <code>csinstances_create.sh</code> should have the same names as in the screenshot:</p>
<p><img src="../../images/02-instances-management/06-results-of-running-csinstance_create.sh-outputs-dir-files.png" class="img-fluid" alt="Screenshot of Linux terminal showing the run of the command ls for each of the subdirectories shown in the previous screenshot; the results of each ls command shows the names of the files created by the scripts invoked by the scripts csinstances_create.sh." width="900"></p>
</section>
<section id="each-instance-name-is-the-key-to-access-each-instance-results-files-in-the-outputs-directory" class="level3">
<h3 class="anchored" data-anchor-id="each-instance-name-is-the-key-to-access-each-instance-results-files-in-the-outputs-directory">Each instance name is the key to access each instance results files in the <code>outputs</code> directory</h3>
<p>Once an AWS resource is created, <strong>any further request on the resource</strong> to, for example, configure it, stop it, .., or delete it, <strong>must include the resource ID</strong> received when the resource was created.</p>
<p>The naming convention of the results files mentioned above, that is, to include the name of the corresponding instance in each results file name, enables the Scripts to identify the files related to each instance to <strong>extract the resource IDs</strong> in order to further manage an instance and its related resources (login key, domain name), through making the corresponding requests to AWS.</p>
<p>The Scripts get the instances names to build the corresponding results files names from the <em>instancesNames.txt</em> received as a parameter (recall that all the Scripts are run in the same way).</p>
<p>The screenshot below shows the resource ID of instance01 that is extracted by the Scritps to further manage the instance. Login keys IDs look like this: <code>"KeyPairId": "key-04b589569b2952ed2"</code>.</p>
<p><img src="../../images/02-instances-management/07-results-of-running-csinstance_create.sh-instance01-id.png" class="img-fluid" alt="Screenshot of Linux terminal showing the run of the command more courses/instances-management/outputs/instances-creation-output/instance01.txt which displays the contents of that file, with the InstanceID field and its value circled." width="900"></p>
</section>
<section id="results-files-in-the-outputs-directory-not-managing-domain-names" class="level3">
<h3 class="anchored" data-anchor-id="results-files-in-the-outputs-directory-not-managing-domain-names">Results files in the <code>outputs</code> directory — NOT managing domain names</h3>
</section>
<section id="ip-addressess-for-workshop-participants" class="level3">
<h3 class="anchored" data-anchor-id="ip-addressess-for-workshop-participants">IP addressess for workshop participants</h3>
<p>When domain names are <strong>not</strong> managed:</p>
<ul>
<li>the sub-directory <code>domain-names-creation-output</code> is <strong>not</strong> created.</li>
<li>the sub-directory <code>instances-creation-output</code> is used to store a file for each created instance that contains the IP address allocated by AWS to the instance. The name of each file is “<em>instance-name</em><code>-ip-address.txt</code>”, where “<em>instance-name</em>” is the name of the instance as specified in the <em>instancesNames.txt</em> file used to run the Scripts.</li>
</ul>
<p>If the three instances created in our running example had been created with <strong>no</strong> domain names, the files in the subdirectory <code>instances-creation-output</code> would be the ones shown in the screenshot below:</p>
<p><img src="../../images/02-instances-management/08-no-domain-names-IP-addresses-results-files.png" class="img-fluid" alt="Screenshot of Linux terminal showing the run of the command ls for the subdirectory-instances-creation-output-no-domain-names." width="900"></p>
<p>In the screenshot, the ﬁles “instance??.txt” are created by the script <code>aws_instances_launch.sh</code>; the ﬁles “instance??<code>-ip-address.txt</code>” are created by the script <code>aws_instances_configure.sh</code>. This is because an instance public IP address is not available in the results from invoking <code>aws_instances_launch.sh</code> (that is, in the ﬁles “<em>instance??</em>.txt”), but is available until each instance is actually running, a condition that the script <code>aws_instances_configure.sh</code> waits for and detects in order to recover each instance IP address to start conﬁguring the instance, and ﬁnally save the IP address into the ﬁle “<em>instanceName</em><code>-ip-address.txt</code>”.</p>
<p>Note that, if instances are <strong>stopped</strong> and eventually <strong>started</strong>, through running <code>csinstances_stop.sh</code> and <code>csinstances_start.sh</code>, the IP address of each instance will change because AWS randomly allocates IP addresses when instances are launched for the ﬁrst time or when they are started after having been stopped. Therefore, <code>csinstances_start.sh</code> overwrites the contents of the ﬁles “<em>instanceName*</em><code>-ip-address.txt</code>” with the newly allocated IP addresses.</p>
</section>
</section>
<section id="typical-instances-life-cycle-create-stop-start-and-delete-instances" class="level1">
<h1>6. Typical Instances Life Cycle: create, stop, start and delete instances</h1>
<p>When you create instances through running <code>csinstances_create.sh</code>, the instances and their related resources (login key files, etc.) are created and configured first; then the instances are run (launched/started) and are left running until you either stop them or delete them.</p>
<p>Our typical scenario in managing instances is as follows. When a workshop is scheduled for delivery, say on day D, we usually send the workshop participants the instructions to login to their instances, along with their login key file, one or a few days before D. We usually follow these steps:</p>
<ul>
<li><strong>create</strong> the instances before D for the login key files to be created.</li>
<li><strong>stop</strong> the instances shortly after (within minutes) to reduce costs.</li>
<li>re-<strong>start</strong> the instances again some time before the workshop starts.</li>
<li><strong>delete</strong> all the instances once the workshop is over.</li>
</ul>
<p>We perform those four tasks running the Scripts <code>csinstances_*.sh</code> in our terminal:</p>
<ul>
<li><code>csinstances_create.sh</code></li>
<li><code>csinstances_stop.sh</code></li>
<li><code>csinstances_start.sh</code></li>
<li><code>csinstances_delete.sh</code></li>
</ul>
<p>But <strong>we are usually logged in</strong> to the <strong>AWS Console</strong> too, at the <strong>EC2 — Instances</strong> page, to check that the <strong>instances state</strong> changes according to the state intended by each script, as described below.</p>
<p>Follow along:</p>
<ul>
<li>login to the AWS Console (with your IAM user account), type EC2 (for Elastic Compute Cloud) in the AWS search box at the top and press Enter, and then click on <strong>Instances</strong> on the left menu pane, see the page below.</li>
<li>run the scripts below in your terminal</li>
</ul>
<section id="creating-instances-one-or-more-days-before-a-workshop-starts" class="level2">
<h2 class="anchored" data-anchor-id="creating-instances-one-or-more-days-before-a-workshop-starts">Creating instances one or more days before a workshop starts</h2>
<p><strong>Only run</strong> <code>csinstances_create.sh</code> <strong>if you did not run it in the previous section</strong>!!!</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb33" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> csinstances_create.sh courses/instances-management/inputs/instancesNames.txt </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once you have run <code>csinstances_create.sh</code>, the instances state in the AWS Console will be <strong>Running</strong> as shown below (you may need to refresh the page):</p>
<p><img src="../../images/02-instances-management/09-ec2-instances-screen-showing-created-instances-running.png" class="img-fluid" alt="Screenshot of AWS Console EC2 Instances page in a browser showing the state, Running, of three instances previously created, circled." width="900"></p>
<p>Once the instances are created, you will be able to send the instances login details to workshop participants, that is: the login key files and either the instance domain names or the instance IP addresses (if domain names are not being managed).</p>
<p>The login key files are in the directory <code>../outputs/login-keys/</code> (within your courses/workshop-name directory — in our running example the <em>instances-management</em> directory). We usually upload the <code>login-keys</code> directory to a shared GDrive directory and inform someone we have done so. Someone then emails each login key file and the corresponding instance domain name to each workshop participant. Instance domain names are all saved to a GDrive file which is generated as described below.</p>
<section id="if-domain-names-are-being-managed" class="level4">
<h4 class="anchored" data-anchor-id="if-domain-names-are-being-managed"><strong>If domain names are being managed</strong>:</h4>
<p>Cloud-SPAN courses are run using instance domain names. The files <code>../outputs/domain-names-creation-output/domain-name-create-</code><em>instancename?..?</em><code>.txt</code> contain each the domain name of an instance in the last line. However, we create a file containing all the domain names through (1) making a copy of the <em>instancesNames.txt</em> file used to create the instances, and (2) editing the file to <strong>append</strong> each line (instance name) with the base domain name in the <code>resourcesIDs.txt</code> file (<code>cloud-span.aws.york.ac.uk</code> in our running example). We then upload this file to a shared GDrive directory and inform someone we have done so, etc.</p>
</section>
<section id="if-domain-names-are-not-being-managed" class="level4">
<h4 class="anchored" data-anchor-id="if-domain-names-are-not-being-managed"><strong>If domain names are NOT being managed</strong>:</h4>
<p>The files <code>../outupts/instances-creation-output/</code><em>instancename?..?</em><code>-ip-address.txt</code> contain each the IP address of an instance only. Cloud-SPAN does not follow not using domain names, but we would copy all these files to another directory and upload this directory, along with login keys files directory, to a GDrive directory and inform someone we have done so. Someone could then email each workshop participant the corresponding login key file and instanceName<code>-ip-address.txt</code> file as attachments. It should be easy to identify each pair of these files as their names contain the corresponding instance name.</p>
<p><strong>Please note</strong>: if you are <strong>not</strong> managing domain names, you may <strong>NOT</strong> want to <strong>stop</strong> and <strong>start</strong> the instances as suggested above and shown below, but rather to delay creating instances as much as possible until just before the start of a workshop. If you stop and start the instances, their IP address will change and you will need to email the new IP addresses to workshop participants again. Creating 30 instances takes only 10 to 15 minutes. The issue is preparing the login details of each instance (login key and IP address files) to email them to each workshop participant.</p>
</section>
</section>
<section id="stopping-the-instances-shortly-after-within-minutes-they-are-created" class="level2">
<h2 class="anchored" data-anchor-id="stopping-the-instances-shortly-after-within-minutes-they-are-created">Stopping the instances shortly after (within minutes) they are created</h2>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb34" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> csinstances_stop.sh courses/instances-management/inputs/instancesNames.txt </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb35" data-filename="Output"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>csinstances_stop.sh is stopping instances specified in input file courses/instances-management/inputs/instancesNames.txt</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>Stopping instances:</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>Creating directory to hold the results of stopping instances:</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>courses/instances-management/outputs/instances-stop-output20241018.131032</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>Success stopping instance: instance01</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>Success deleting domain: instance01.cloud-span.aws.york.ac.uk ip: 52.49.100.76</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>Success stopping instance: instance02</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>Success deleting domain: instance02.cloud-span.aws.york.ac.uk ip: 54.217.178.245</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>Success stopping instance: instance03</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>Success deleting domain: instance03.cloud-span.aws.york.ac.uk ip: 34.252.179.148</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once you run <code>csinstances_stop.sh</code>, the instances state in the AWS Console will change from <strong>Running</strong> to <strong>Stopping</strong> as shown below, and after a short while the state will change to <strong>Stopped</strong>, and will remain so until you run another script that changes the state of the instances.</p>
<p><img src="../../images/02-instances-management/10-ec2-instances-screen-showing-created-instances-stopping.png" class="img-fluid" alt="Screenshot of AWS Console EC2 Instances page in a browser showing the state, Stopping, of three instances previously created and running, circled." width="900"></p>
<p>Note in the output of <code>csinstances_stop.sh</code> that each instance domain name is deleted after stopping each instance. This is done because as mentioned above the IP address of each instance will change on re-starting each instance. Hence there is no reason to keep instance domain names that are mapped to IP addresses that are invalid as a result of having stopped the corresponding instances.</p>
</section>
<section id="re-starting-the-instances-just-before-the-workshop" class="level2">
<h2 class="anchored" data-anchor-id="re-starting-the-instances-just-before-the-workshop">Re-starting the instances just before the workshop</h2>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb36" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> csinstances_start.sh courses/instances-management/inputs/instancesNames.txt </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb37" data-filename="Output"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>csinstances_start.sh is starting instances specified in input file courses/instances-management/inputs/instancesNames.txt</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>Starting instances:</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>Creating directory to hold the results of starting instances:</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>courses/instances-management/outputs/instances-start-output20241018.131906</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>Success starting instance: instance01</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>Success starting instance: instance02</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>Success starting instance: instance03</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>Checking each instance is running to get its IP address:</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>.- instance instance01 state 16 (running)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>Please note: the IP address (52.210.84.174) of instance instance01 was saved to the file:</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>courses/instances-management/outputs/instances-creation-output/instance01-ip-address.txt</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>..- instance instance02 state 16 (running)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>Please note: the IP address (34.241.237.54) of instance instance02 was saved to the file:</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>courses/instances-management/outputs/instances-creation-output/instance02-ip-address.txt</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>..- instance instance03 state 16 (running)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>Please note: the IP address (63.35.198.137) of instance instance03 was saved to the file:</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>courses/instances-management/outputs/instances-creation-output/instance03-ip-address.txt</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>Mapping each instance domain name to its IP address:</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>Success mapping domain: instance01.cloud-span.aws.york.ac.uk, ip: 52.210.84.174</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>ssh-keygen -f /home/csuser/.ssh/known_hosts -R instance01.cloud-span.aws.york.ac.uk</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a># Host instance01.cloud-span.aws.york.ac.uk found: line 26</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>/home/csuser/.ssh/known_hosts updated.</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>Original contents retained as /home/csuser/.ssh/known_hosts.old</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>Success mapping domain: instance02.cloud-span.aws.york.ac.uk, ip: 34.241.237.54</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>ssh-keygen -f /home/csuser/.ssh/known_hosts -R instance02.cloud-span.aws.york.ac.uk</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a># Host instance02.cloud-span.aws.york.ac.uk found: line 27</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>/home/csuser/.ssh/known_hosts updated.</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>Original contents retained as /home/csuser/.ssh/known_hosts.old</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>Success mapping domain: instance03.cloud-span.aws.york.ac.uk, ip: 63.35.198.137</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>ssh-keygen -f /home/csuser/.ssh/known_hosts -R instance03.cloud-span.aws.york.ac.uk</span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a># Host instance03.cloud-span.aws.york.ac.uk found: line 28</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>/home/csuser/.ssh/known_hosts updated.</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>Original contents retained as /home/csuser/.ssh/known_hosts.old</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>Checking each domain is reachable:</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>.......... : instance01.cloud-span.aws.york.ac.uk status INSYNC (reachable)</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>. : instance02.cloud-span.aws.york.ac.uk status INSYNC (reachable)</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>. : instance03.cloud-span.aws.york.ac.uk status INSYNC (reachable)</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>Please note: you may need to wait up to one hour to be able to access re-started</span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>instances with "ssh". This is because Domain Name servers ask every hour for changes</span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>to the configuration of instance domain names and IP addresses have just changed.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once you run <code>csinstances_start.sh</code>, the instances state in the AWS Console will change from <strong>Stopped</strong> to <strong>Pending</strong> (momentarily), and then to <strong>Running</strong> and will remain so until you run another script that changes the instances state.</p>
<p>Note in the output of <code>csinstances_start.sh</code> that all instances are started first. Instance IP addresses are then saved each to the file <code>../outputs/instances-creation-output/</code><em>instanceName</em><code>-ip-address.txt</code>. If domain names are <strong>not</strong> being managed, <code>csinstances_start.sh</code> will finish at this point. Otherwise, if domain names <strong>are being</strong> managed, <code>csinstances_start.sh</code> will create each instance domain name as mapped to the new IP address of each instance, and will wait (check) until each domain name status is INSYNC (reachable).</p>
<p>Please note the message in the <strong>last paragraph</strong> of the output of <code>csinstances_start.sh</code> which is self-explanatory. (If domain names are <strong>not</strong> being managed, instances can be accessed with <code>ssh</code> immediately after their IP addresses have been saved.)</p>
</section>
<section id="deleting-instances-and-related-resources-once-a-workshop-is-over" class="level2">
<h2 class="anchored" data-anchor-id="deleting-instances-and-related-resources-once-a-workshop-is-over">Deleting instances and related resources once a workshop is over</h2>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb38" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> csinstances_delete.sh courses/instances-management/inputs/instancesNames.txt </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb39" data-filename="Output"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>csinstances_delete.sh is terminating instances specified in input file courses/instances-management/inputs/instancesNames.txt</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>Terminating instances:</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>Creating directory to hold the results of deleting instances:</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>courses/instances-management/outputs/instances-delete-output20241018.154603</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>Success terminating instance: instance01</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>Success terminating instance: instance02</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>Success terminating instance: instance03</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>Deleting login key pairs:</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>Creating directory to hold the results of deleting the login keys:</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>courses/instances-management/outputs/login-keys-delete-output20241018.154607</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>Success deleting login-key: login-key-instance01; instance: instance01</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>Success deleting login-key: login-key-instance02; instance: instance02</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>Success deleting login-key: login-key-instance03; instance: instance03</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>Deleting domain names:</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>Creating directory to hold the results of deleting domain names:</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>courses/instances-management/outputs/domain-names-delete-output20241018.154610</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>Success deleting domain: instance01.cloud-span.aws.york.ac.uk ip: 52.210.84.174</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>Success deleting domain: instance02.cloud-span.aws.york.ac.uk ip: 34.241.237.54</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>Success deleting domain: instance03.cloud-span.aws.york.ac.uk ip: 63.35.198.137</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can delete instances in any state — you don’t need to stop instances to delete them.</p>
<p>Once you run <code>csinstances_delete.sh</code>, the instances state in the AWS Console will change from <strong>Stopped</strong>, or <strong>Running</strong>, to <strong>Shutting-down</strong>, and after some minutes to <strong>Terminated</strong>, and after some more minutes the terminated instances will no longer be shown in the AWS Console.</p>
<p>The output of <code>csinstances_delete.sh</code> shows these main steps:</p>
<ul>
<li>Terminating instances</li>
<li>Deleting login key pairs</li>
<li>Deleting domain names</li>
</ul>
<p>You should always see a <strong>Success …</strong> message for each resource that is terminated or deleted. If you don’t, you are probably running the Scripts in the wrong directory or with the wrong <em>instancesNames.txt</em> file. The Scripts have not failed since we got them right.</p>
<section id="the-results-of-stopping-starting-and-deleting-instances-are-also-saved-to-files" class="level3">
<h3 class="anchored" data-anchor-id="the-results-of-stopping-starting-and-deleting-instances-are-also-saved-to-files">The results of stopping, starting and deleting instances are also saved to files</h3>
<p>The results of running <code>csinstances_stop.sh</code>, <code>csinstances_start.sh</code> and <code>csinstances_delete.sh</code> are also saved within sub-directories in the <code>../outputs/</code> directory.</p>
<p>Run the <code>ls</code> command below to look at the sub-directories that were created after running those scripts.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb40" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@csadmin-instance:~</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls courses/instances-management/outputs/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output of <code>ls</code> should be similar to this one:</p>
<p><img src="../../images/02-instances-management/11-terminal-listing-of-outpus-dir-after-stopping-starting-deleting-instances.png" class="img-fluid" alt="Screenshot of Linux terminal showing the output of the command ls courses/instances-management/outputs/ after stopping, re-starting and deleting the three instances; the output shows the new directories created by the scripts that stopped, started and deleted the instances." width="900"></p>
<p>The newly created sub-directories are those in boxes; their names are suffixed with the date and time when the relevant script was run. Inside each sub-directory there is a file for each request made by the relevant script, one request for each instance or related resource.</p>
<p>We won’t look into these files. Their main use is to register the results of AWS requests in case of errors happening. They were essential while developing the Scripts to get them right.</p>
</section>
</section>
</section>
<section id="unforseen-instance-management" class="level1">
<h1>7. Unforseen Instance Management</h1>
<p>The Scripts use-case scenario outlined above is typical of short workshops that last 1-4 days in a row. Yet sometimes it doesn’t go that smoothly. Sometimes you will receive requests like those in the list below after you have both created an “instancesNamesFile” and run the script <code>csinstances_create.sh</code> with that file, that is: some instances have been created, and then, you receive requests like:</p>
<ul>
<li>can you create N more instances? — We received N last-minute registrations to the workshop.</li>
<li>can you delete instance A? — The participant is ill and cancelled.</li>
<li>can you leave the instances B and C running after the workshop until <em>date</em>? — The participants have not yet managed to cover the course but are very keen to do it.</li>
<li>can you stop instance D (don’t delete it) until further notice? — The participant has started the workshop but something urgent happened and will get back to it asap.</li>
</ul>
<p>If you are to fulfill such requests, you <strong>need to manage multiple</strong> “<em>instancesNamesFile</em>”s. You cannot use a single “<em>instancesNamesFile</em>” because the Scripts create (configure, stop, start or delete) <strong>all the instances</strong> whose names you specify in the “<em>instancesNamesFile</em>” you pass to the Scripts.</p>
<p>For <strong>example</strong>, suppose the following scenario: (<strong>1</strong>) you have created the three instances as instructed in Section 3 <a href="#create-the-instances">Create the Instances</a> — you used the file <em>instancesNames.txt</em> &nbsp;to create three instances with the names <em>instance01</em>, <em>instance02</em>, and <em>instance03</em>; (<strong>2</strong>) you are then asked to create another instance (for a latecomer to the workshop you are running); and (<strong>3</strong>) for the new instance you decide to use the name <em>instance04</em>.</p>
<p>Now you need to create another “instancesNamesFile”, say, <em>instancesNames-04.txt</em>, that contains only the instance name <em>instance04</em>, and then run <code>csinstances_create.sh instancesNames-04.txt</code>.</p>
<section id="avoid-modifying-an-instancesnamesfile-that-you-have-already-used-to-create-intances" class="level2">
<h2 class="anchored" data-anchor-id="avoid-modifying-an-instancesnamesfile-that-you-have-already-used-to-create-intances">Avoid modifying an “instancesNamesFile” that you have already used to create intances</h2>
<p>In the example above, you <strong>should not add</strong> the instance name <em>instance04</em> &nbsp;to the file <em>instancesNames.txt</em> &nbsp;(that you previously used to create <em>instances01</em>, <em>..02</em> and &nbsp;<em>..03</em>), and then <strong>run again</strong>:</p>
<p><code>csinstances_create.sh instancesNames.txt</code> — <strong>it will fail</strong> as shown in the screenshot below:</p>
<p><img src="../../images/02-instances-management/13-results-of-running-csinstance_create.sh-AGAIN-aborted.png" class="img-fluid" alt="Screenshot of Linux terminal showing the run of csinstance_create.sh and the abort message for having found that some instances or related resources have already been created." width="900"></p>
</section>
<section id="the-scripts-check-instance-operations-are-valid-given-the-state-of-the-running-environment" class="level2">
<h2 class="anchored" data-anchor-id="the-scripts-check-instance-operations-are-valid-given-the-state-of-the-running-environment">The Scripts <em>check</em> &nbsp;instance operations are <em>valid</em> &nbsp;given the state of the running environment</h2>
<p>Recall (from Section 3 <a href="#create-the-instances">Create the Instances</a>) that login keys are created first, then instances, etc. Login keys are created by the script <code>aws_loginKeyPair_create.sh</code> which, as you can see in the screenshot above, first checks whether the login key files for the instances to be created exist or not, <strong>aborting</strong> its execution if any such file exists. In the run shown in the screenshot, <code>aws_loginKeyPair_create.sh</code> found the login key files for <em>instances01</em>, <em>..02</em>, &nbsp;and <em>..03</em>, and hence displayed the message shown and aborted its execution which, in turn, caused <code>csinstances_create.sh</code> to abort its execution as well.</p>
<p>As stated in that message, the files that were found contain the <strong>AWS resource IDs</strong> of login keys <strong>already created</strong>. Those resource IDs are needed to delete the login keys from your AWS account. The Scripts <strong>do not overwrite</strong> files that contain such resources IDs. If those files are <strong>overwritten</strong>, or lost, <strong>before you delete</strong> the corresponding instances and related resources (running <code>csinstances_delete.sh</code>), <strong>you will need to use the AWS Console to delete manually</strong> the corresponding instances, login keys, IP addresses and domain names.</p>
<p>If you want to create instances <strong>with names</strong> you <strong>have already used</strong>, you <strong>must first delete</strong> the instances already created and their related resources (running <code>csinstances_delete.sh</code>), then delete or rename the <code>../outputs/</code> directory, and finally create the instances. We have done so only for some testing, see the <a href="#troubleshooting">Troubleshooting</a> section.</p>
<p>All the Scripts that <strong>create</strong> AWS resources carry out a similar <strong>check</strong> to that carried out by <code>aws_loginKeyPair_create.sh</code>. For each instance name in the “instancesNamesFile” passed to <strong><code>csinstances_create.sh</code></strong>, each script checks whether the instance, or the resource for that instance, has been created or not, which amounts to checking whether the file with the corresponding AWS resource ID exists or not. If any such file <strong>does</strong> exist, the script aborts its execution <strong>without</strong> issuing any AWS request to create resources.</p>
<p>All the Scripts that <strong>delete</strong> AWS resources carry out a similar check but <strong>act on the opposite</strong>. … If any such file <strong>does not</strong> exist, the script aborts its execution <strong>without</strong> issuing any AWS request to delete resources. The script <code>aws_instances_configure.sh</code> does this check.</p>
<p>Given a set of instances names as specified in an “<em>instancesNamesFile</em>”, the two checks above guarantee that all or none of the instances, and/or related resources, are created or deleted.</p>
<p>Finally, all the Scripts <code>aws_*.sh</code> check that the “<em>instancesNamesFile</em>” passed to them has only one value (one instance name) in each line. Thus, if you inadvertently passed to the Scripts the file name <code>resourcesIDs.txt</code> or <code>tags.txt</code>, which both have two values in each line, the Scripts will abort their execution.</p>
</section>
<section id="using-multiple-instancenamesfiles-to-manage-unforseen-instances-management-requests" class="level2">
<h2 class="anchored" data-anchor-id="using-multiple-instancenamesfiles-to-manage-unforseen-instances-management-requests">Using multiple “<em>instanceNamesFile</em>”s to manage unforseen instances management requests</h2>
<p>There is no problem with having multiple “<em>instancesNamesFile</em>”s in an <code>../inputs/</code> directory.</p>
<p>The main issue is how to name those multiple files so that you <strong>keep track</strong> of what happens, regarding instance management throughout a workshop.</p>
<p>The listing below illustrates the naming convention we follow to name multiple “<em>instancesNamesFile</em>”s to handle similar requests to the ones described in the introduction to this section.</p>
<p>The listing shows the files in the <code>inputs</code> directory of a workshop we ran through late October and November 2022:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb41" data-filename="Output"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>instancesNames20221028-create-301-25.txt</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>instancesNames20221031-create-326.txt</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>instancesNames20221031-create-327.txt</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>instancesNames20221031-create-328.txt</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>instancesNames20221101-create-329.txt</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>instancesNames20221109-delete-307.txt</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>instancesNames20221114-delete-303,315,321.txt</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>instancesNames20221115-create-again-321.txt</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>instancesNames20221121-delete-310,314,320,321,323,325.txt</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>instancesNames20221123-stop-306.txt</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>instancesNames20221128-delete-302,304-05,308-09,311-13,316-19,322,324,326-29.txt</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>instancesNames20221130-delete-301.txt</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>resourcesIDs.txt</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>tags.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The workshop used instances of type <em>t3.2xlarge</em>, each instance with 8 processors and 32 GigaBytes of main memory and 240 GB of secondary storage — not cheap. The instances were to run for 4 weeks unless the participants would not make progress which we checked weekly looking at the command history and whether relevant results files existed. We would delete instances that showed no progress was made.</p>
<p>From the file listing above we can recall the following:</p>
<ul>
<li>On 28 October we created the 1st file at the top and run <code>csinstances_create.sh courses/../inputs/instancesNames20221028-create-301-25.txt</code> in order to create 25 instances named: instance301, instance302, instance303, …, instance325.</li>
<li>On 31 October we received 3 requests, at different times, to create one more instance. Upon receiving each request, we created another “instanceNameFile” (2nd, 3rd and 4th files in listing above) with only one instance name inside (instance326, instance327, instance328 respectively), and run <code>csinstances_create.sh</code> with each file.</li>
<li>On 1 Novemeber we received another request to create one more instance and handled it as just described to create instance329.</li>
<li>On 9 November we deleted instance307 (for not showing progress):
<ol type="1">
<li>we made a copy of <em>instancesNames20221028-create-301-25.txt</em> onto <em>instancesNames20221109-delete-307.txt</em>.</li>
<li>opened the copy with our text editor and deleted all lines except the line with the instance name instance307.</li>
<li>we then run <code>csinstances_delete.sh courses/../inputs/instancesNames20221109-delete-307.txt</code>.</li>
</ol></li>
</ul>
<p>The other “<em>instancesNamesFile</em>”s in the list were handled similarly to the way the event on 9 November was handled, namely:</p>
<ul>
<li>creating a new file containing only the names of the target instances.</li>
<li>naming the file <em>instancesNames</em><strong>Date</strong>-<strong>operation</strong>-<strong>instancesNumbersList</strong>.txt — where <strong>operation</strong> is create, stop, start, or delete.</li>
<li>running the relevant <code>csinstances_*.sh</code> script to create, stop, start or delete the target instances.</li>
</ul>
<p>The tedious part of this file naming convention is specifying the <strong>intancesNumbersList</strong>. However, it is not required often and it gives you an accurate overview of the instance operations you have performed for a workshop.</p>
</section>
</section>
<section id="troubleshooting" class="level1">
<h1>8. Troubleshooting</h1>
<p>This last section presents the problems we have come across in creating instances with the Scripts and how we solved them. The problems are presented below under the error messages displayed when the problems occur, namely:</p>
<ul>
<li><strong>Connection timed out</strong> or <strong>Connection refused</strong> messages persist</li>
<li><strong>WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED</strong></li>
</ul>
<section id="connection-timed-out-or-connection-refused-messages-persist" class="level3">
<h3 class="anchored" data-anchor-id="connection-timed-out-or-connection-refused-messages-persist">“<strong>Connection timed out</strong>” or “<strong>Connection refused</strong>” messages persist</h3>
<p>Those messages are related to accessing an instance with <code>ssh</code>. We have come across those messages in two scenarios:</p>
<ul>
<li>when an instance is to be configured — recall that <em>instance configuration</em> is the last step in creating instances. We will refer to this scenario as <strong>During configuration scenario</strong>.</li>
<li>and when an instance is to be accessed by the end user (after the instance has been configured). We will refer to this scenario as <strong>After configuration scenario</strong>.</li>
</ul>
<section id="during-configuration-scenario" class="level5">
<h5 class="anchored" data-anchor-id="during-configuration-scenario"><strong>During configuration scenario</strong></h5>
<p>This scenario is shown below. It has to do with the SSH server in the instance not yet being ready to accept any login request, and hence the client (the script <code>aws_instances_configure.sh</code> which is invoked last by <code>csinstances_create.sh</code>) receives an unsuccessful response and displays either the message <strong>Connection timed out</strong> or <strong>Connections refused</strong>, or both. This situation is <strong>normal</strong> because we know the instance has just been launched. It’s only a matter of waiting for the SSH server to be ready.</p>
<p><img src="../../images/02-instances-management/12-results-of-running-csinstance_create.sh-configuring-instance2.png" class="img-fluid" alt="Screenshot of Linux terminal showing the last part of the output of running the command csinstances_create.sh; that part corresponds to the configuration step of each instance and the screenshot shows the Connection timed out and Connection refused messages circled that may arise during the configuration step." width="900"></p>
<p>Note in the screenshot the message in brown “<strong>Please wait for SSH server (you may see a few ‘Connection timed out/Connection refused’ messages)</strong>”, and the message in white just below “<strong>ssh -o ConnectTimeout=5 -o StrictHostKeyChecking=no -i courses/…</strong>”. The script <code>aws_instances_configure.sh</code> prints those two messages and then gets into a loop to repeatedly issue that <code>ssh</code> command until it is successful. In the screenshot, three issues of that <code>ssh</code> command were unsuccessful and the message “<strong>ssh: connect to host instance01… port 22: Connection refused</strong>” was displayed three times. Once that <code>ssh</code> command is successful, <code>aws_instances_configure.sh</code> proceedes to issue the <code>ssh</code> commands that configures the instance. That is, the sole purpose of the <code>ssh</code> command that is issued within the loop is to ensure the SSH server in the instance is ready.</p>
<p><strong>How many “Connection timed out/Connection refused” (unsuccessful <code>ssh</code>) messages would be “normal”?</strong></p>
<p>We have seen up to about 15 of those messages and then <code>ssh</code> succeeds.</p>
<p>Sometimes it is network congestion during peak hours that will cause those messages — sometimes you will not see any of those messages.</p>
<p>Usually those messages will be displayed for the first instances to be configured and not for subsequent instances because the SSH server in subsequent instances has some more time to get ready.</p>
<p>However, an instance configuration step may indeed get stuck displaying those messages no end. It has happened to us under two conditions that we will call test conditions and normal conditions.</p>
<section id="test-conditions" class="level6">
<h6 class="anchored" data-anchor-id="test-conditions"><strong>Test conditions</strong></h6>
<p>By test conditions we mean creating instances to test something (as opposed to creating instances for a workshop: normal conditions). In testing something, we have sometimes created a few instances and immediately after realised we forgot somethineg, corrected it, deleted the instances and created the instances again using the <strong>same</strong> instance names, and then got those messages no end.</p>
<p>We had to delete the instances, and create new ones with different names. We believe the problem is the too close subsequent requests to map the same domain names to different IP addresses. The AWS domain name system, Route 53, needs sometime to propagate the changes to its servers, etc. It has not been worth trying to solve this. They are only tests and we can use other instances names.</p>
</section>
<section id="normal-conditions" class="level6">
<h6 class="anchored" data-anchor-id="normal-conditions"><strong>Normal conditions</strong></h6>
<p>Creating instances for a workshop is normal conditions. We have got those messages under normal conditions and the following has always worked for us:</p>
<ul>
<li><p><strong>abort</strong> the run of the script <code>csinstances_create.sh</code> by pressing <code>Ctrl-c</code> (the keys Ctrl and c simultaneously) a few times until you get back the prompt of your terminal. You will be aborting the script <code>aws_instances_configure.sh</code> first, the one that displays those messages, and then the script <code>csinstances_create.sh</code> which invoked <code>aws_instances_configure.sh</code> as the <strong>last step</strong> of creating instances.<br>
Note that, when you abort the Scripts while seeing the messages “Connection timed out” or “Connection refused”, <strong>the AWS resources of all instances have already been created</strong>. It is only the <strong>instances configuration</strong> phase that has not been completed.</p></li>
<li><p><strong>reboot</strong> the instance that got stuck in the configuration phase — the instance should be <strong>Running</strong> if all the previous steps were succesful (they should; check the messages displayed to your terminal). We usually <strong>reboot</strong> an instance in the AWS Console. Go to the <strong>EC2 - Instances</strong> page - check the box to the left of the instance name - click on <strong>Instances state</strong> drop-down menu at the top - select <strong>Reboot Instance</strong>.</p></li>
<li><p><strong>wait a few minutes</strong> — even if the instance state changes to Running in the AWS Console: the SSH server needs to get ready.</p></li>
<li><p><strong>run</strong> <code>aws_instances_configure.sh</code> as you ran <code>csinstances_create.sh</code>, for example:</p></li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb42" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="ex">aws_instances_configure.sh</span> courses/instances-management/inputs/instancesNames.txt </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>this run will configure all the instances specified in the file <em>instancesNames.txt</em>. There is no problem if some instances were previously configured (before aborting the Scripts) and are configured again.</li>
<li>alternatively, you may want to deal only with the instance on which the configuration step got stuck. In this case you need to create another “instancesNamesFile” containing the name of that instance only and run <code>aws_instances_configure.sh</code> with that file (see the previous section <a href="#unforseen-instance-management">Unforseen instances management</a>), for example:</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb43" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="ex">aws_instances_configure.sh</span> courses/instances-management/inputs/instancesNames20241028-configure-10.txt </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Alternatively, you may try first all of the steps above except <strong>rebooting</strong> the instance. It has worked for us. We believe the benefit of rebooting the instance is the cleaning/deleting of any previous <code>ssh</code> requests enqueued somewhere waiting to be served.</li>
</ul>
</section>
</section>
<section id="after-configuration-scenario" class="level5">
<h5 class="anchored" data-anchor-id="after-configuration-scenario"><strong>After configuration scenario</strong></h5>
<p>The other scenario where <strong>Connection timed out</strong> or <strong>Connection refused</strong> messages may be displayed is when an instance is to be accessed by the end user (after the instance has been configured and is running).</p>
<p>In this case, it is the configuration of the server the end user is connected to gain access to the Internet. The server is blocking <code>ssh</code> communication, either from the end user <code>ssh</code> client to reach the instance or from the instance SSH server to reach the end user machine, or both. If you have a mobile phone handy, turn on the “Mobile Hotspot” WiFi, ask the end user to connect to it, and then to connect to the instance. If this works, the end user needs to ask the IT department responsible for the server to solve the issue.</p>
</section>
</section>
<section id="warning-remote-host-identification-has-changed" class="level3">
<h3 class="anchored" data-anchor-id="warning-remote-host-identification-has-changed"><strong>WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED</strong></h3>
<p>The error behind this message has also to do with accessing and instance with <code>ssh</code>. It used to happen to us and happened to a workshop participant whose instance was created, deleted and created again with the same name.</p>
<p>The participant was sent the login key file the first time the instance was created. We then deleted the instance (instance321 in the file listing in section <a href="#unforseen-instance-management">Unforseen instance management</a> due to not seeing any progress). The participant asked the instance to be created again. We created the instance again using the same name and send the participant the new login key file. When using <code>ssh</code> to login to the newly created instance, the participant got that message.</p>
<p>The solution was to tell the participant to run the command below before running <code>ssh</code> so that the instance host domain is removed from the participant’s <code>~/.ssh/known_hosts</code> file.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb44" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh-keygen</span> <span class="at">-f</span> <span class="st">"</span><span class="va">$HOME</span><span class="st">/.ssh/known_hosts"</span> <span class="at">-R</span> instance321.cloud-span.aws.york.ac.uk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The error used to happen to us when developing the Scripts out of carrying out multiple tests using the same instances names. So we decided to add that <code>ssh-keygen</code> command to the script <code>aws_instances_configure.sh</code> just before invoking <code>ssh</code> — see the screenshot above, eighth line from the top.</p>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/Cloud-SPAN\.github\.io\/cloud-admin-guide-v2q\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="../../docs/lesson02-managing-aws-instances/01-configure-instances-internet.html" class="pagination-link" aria-label="Configure Instances Internet Access">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Configure Instances Internet Access</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../docs/lesson02-managing-aws-instances/03-ami-management.html" class="pagination-link" aria-label="AMIs Management">
        <span class="nav-page-text">AMIs Management</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2021–24 by <a href="https://cloud-span.york.ac.uk/">Cloud-SPAN</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/Cloud-SPAN/nerc-metagenomics-v2q/edit/main/docs/lesson02-managing-aws-instances/02-instances-management.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/Cloud-SPAN/nerc-metagenomics-v2q/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/SpanCloud">
      <i class="bi bi-twitter" role="img" aria-label="Quarto Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Cloud-SPAN/cloud-admin-guide-v2q">
      <i class="bi bi-github" role="img" aria-label="Quarto GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>