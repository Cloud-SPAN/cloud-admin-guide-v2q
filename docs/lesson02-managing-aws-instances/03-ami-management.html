<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>AMIs Management – Automated Management of AWS Instances</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../docs/lesson02-managing-aws-instances/04-scripts-design.html" rel="next">
<link href="../../docs/lesson02-managing-aws-instances/02-instances-management.html" rel="prev">
<link href="../../images/cloud-span-icon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/cloud-span-icon.png" alt="Cloud-SPAN logo." class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/miscellanea/precourse-instructions.html"> 
<span class="menu-text">Precourse Instructions</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/miscellanea/about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../docs/lesson02-managing-aws-instances/index.html">Managing AWS Instances</a></li><li class="breadcrumb-item"><a href="../../docs/lesson02-managing-aws-instances/03-ami-management.html">AMIs Management</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../docs/lesson01-setting-work-envs/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Setting Up Cloud/Terminal Environments</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson01-setting-work-envs/01-create-aws-account.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Create Your AWS Account</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson01-setting-work-envs/02-configure-account.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Configure Your AWS Account</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson01-setting-work-envs/03-configure-terminal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Configure Your Terminal Environment</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson01-setting-work-envs/04-configure-cloudshell.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Configure Your AWS CloudShell Environment</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../docs/lesson02-managing-aws-instances/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Managing AWS Instances</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson02-managing-aws-instances/01-configure-instances-internet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Configure Instances Internet Access</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson02-managing-aws-instances/02-instances-management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Instances Management Tasks Using the Scripts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson02-managing-aws-instances/03-ami-management.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">AMIs Management</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/lesson02-managing-aws-instances/04-scripts-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Scripts Design</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#sections" id="toc-sections" class="nav-link" data-scroll-target="#sections">Sections</a></li>
  <li><a href="#create-an-instance-to-become-ami" id="toc-create-an-instance-to-become-ami" class="nav-link" data-scroll-target="#create-an-instance-to-become-ami">1. Create an ‘instance-to-become-AMI’</a></li>
  <li><a href="#create-an-ami-and-make-it-public-in-the-aws-console" id="toc-create-an-ami-and-make-it-public-in-the-aws-console" class="nav-link" data-scroll-target="#create-an-ami-and-make-it-public-in-the-aws-console">2. Create an AMI and make it public in the AWS Console</a>
  <ul class="collapse">
  <li><a href="#login-to-the-aws-console-with-your-iam-account-user" id="toc-login-to-the-aws-console-with-your-iam-account-user" class="nav-link" data-scroll-target="#login-to-the-aws-console-with-your-iam-account-user">Login to the AWS Console with your IAM account user</a></li>
  <li><a href="#stop-the-instance-if-it-is-running" id="toc-stop-the-instance-if-it-is-running" class="nav-link" data-scroll-target="#stop-the-instance-if-it-is-running">Stop the instance if it is running</a></li>
  <li><a href="#select-the-instance-and-the-options-to-create-an-image-ami-from-it" id="toc-select-the-instance-and-the-options-to-create-an-image-ami-from-it" class="nav-link" data-scroll-target="#select-the-instance-and-the-options-to-create-an-image-ami-from-it">Select the instance and the options to create an image (AMI) from it</a></li>
  <li><a href="#enter-a-name-and-other-info-for-the-ami-and-click-on-create-image" id="toc-enter-a-name-and-other-info-for-the-ami-and-click-on-create-image" class="nav-link" data-scroll-target="#enter-a-name-and-other-info-for-the-ami-and-click-on-create-image">Enter a name and other info for the AMI and click on <strong>Create image</strong></a></li>
  <li><a href="#check-your-ami-and-make-it-public-or-private" id="toc-check-your-ami-and-make-it-public-or-private" class="nav-link" data-scroll-target="#check-your-ami-and-make-it-public-or-private">Check your AMI and make it public or private</a></li>
  </ul></li>
  <li><a href="#delete-an-ami-in-the-aws-console" id="toc-delete-an-ami-in-the-aws-console" class="nav-link" data-scroll-target="#delete-an-ami-in-the-aws-console">3. Delete an AMI in the AWS Console</a>
  <ul class="collapse">
  <li><a href="#delete-the-ami-first" id="toc-delete-the-ami-first" class="nav-link" data-scroll-target="#delete-the-ami-first">Delete the AMI first</a></li>
  <li><a href="#delete-the-storagesnapshots-of-the-ami-option-we-use" id="toc-delete-the-storagesnapshots-of-the-ami-option-we-use" class="nav-link" data-scroll-target="#delete-the-storagesnapshots-of-the-ami-option-we-use">Delete the storage/snapshots of the AMI (option we use)</a></li>
  <li><a href="#delete-the-storagesnapshots-of-the-ami-other-option" id="toc-delete-the-storagesnapshots-of-the-ami-other-option" class="nav-link" data-scroll-target="#delete-the-storagesnapshots-of-the-ami-other-option">Delete the storage/snapshots of the AMI (other option)</a></li>
  </ul></li>
  <li><a href="#instances-management-for-courses-amis-and-tests" id="toc-instances-management-for-courses-amis-and-tests" class="nav-link" data-scroll-target="#instances-management-for-courses-amis-and-tests">4. Instances Management for Courses, AMIs and Tests</a>
  <ul class="collapse">
  <li><a href="#our-working-directory-to-run-the-scripts" id="toc-our-working-directory-to-run-the-scripts" class="nav-link" data-scroll-target="#our-working-directory-to-run-the-scripts">Our working directory to run the Scripts</a></li>
  <li><a href="#instances-names-we-use" id="toc-instances-names-we-use" class="nav-link" data-scroll-target="#instances-names-we-use">Instances names we use</a></li>
  </ul></li>
  <li><a href="#when-to-configure-an-instance-to-become-ami" id="toc-when-to-configure-an-instance-to-become-ami" class="nav-link" data-scroll-target="#when-to-configure-an-instance-to-become-ami">5. When to configure an ‘instance-to-become-AMI’</a>
  <ul class="collapse">
  <li><a href="#requirements-for-which-we-have-created-a-new-ami" id="toc-requirements-for-which-we-have-created-a-new-ami" class="nav-link" data-scroll-target="#requirements-for-which-we-have-created-a-new-ami">Requirements for which we have created a new AMI</a></li>
  <li><a href="#updating-software-or-data" id="toc-updating-software-or-data" class="nav-link" data-scroll-target="#updating-software-or-data">Updating software or data</a>
  <ul class="collapse">
  <li><a href="#updating-data" id="toc-updating-data" class="nav-link" data-scroll-target="#updating-data">Updating data</a></li>
  <li><a href="#updating-admin-scripts" id="toc-updating-admin-scripts" class="nav-link" data-scroll-target="#updating-admin-scripts">Updating admin scripts</a></li>
  </ul></li>
  <li><a href="#you-can-only-use-the-scripts-with-cloud-span-amis" id="toc-you-can-only-use-the-scripts-with-cloud-span-amis" class="nav-link" data-scroll-target="#you-can-only-use-the-scripts-with-cloud-span-amis">You can only use the Scripts with Cloud-SPAN AMIs:</a>
  <ul class="collapse">
  <li><a href="#updating-the-operating-system-and-end-user-software" id="toc-updating-the-operating-system-and-end-user-software" class="nav-link" data-scroll-target="#updating-the-operating-system-and-end-user-software">Updating the operating system and end-user software</a></li>
  </ul></li>
  <li><a href="#reducing-storage-size" id="toc-reducing-storage-size" class="nav-link" data-scroll-target="#reducing-storage-size">Reducing storage size</a></li>
  <li><a href="#increasing-storage-size" id="toc-increasing-storage-size" class="nav-link" data-scroll-target="#increasing-storage-size">Increasing storage size</a>
  <ul class="collapse">
  <li><a href="#you-will-hopefully-only-need-to-increase-storage-size-and-not-decrease-it" id="toc-you-will-hopefully-only-need-to-increase-storage-size-and-not-decrease-it" class="nav-link" data-scroll-target="#you-will-hopefully-only-need-to-increase-storage-size-and-not-decrease-it">You will hopefully only need to increase storage size (and not decrease it)</a></li>
  </ul></li>
  <li><a href="#changing-aws-configuration" id="toc-changing-aws-configuration" class="nav-link" data-scroll-target="#changing-aws-configuration">Changing AWS configuration</a></li>
  </ul></li>
  <li><a href="#configure-an-instance-to-become-ami" id="toc-configure-an-instance-to-become-ami" class="nav-link" data-scroll-target="#configure-an-instance-to-become-ami">6. Configure an instance to become AMI</a>
  <ul class="collapse">
  <li><a href="#create-and-login-to-your-instance-to-become-ami-that-you-will-configure" id="toc-create-and-login-to-your-instance-to-become-ami-that-you-will-configure" class="nav-link" data-scroll-target="#create-and-login-to-your-instance-to-become-ami-that-you-will-configure">Create and login to your ‘instance-to-become-AMI’ that you will configure</a></li>
  <li><a href="#updating-system-software" id="toc-updating-system-software" class="nav-link" data-scroll-target="#updating-system-software">6.1 Updating system software</a>
  <ul class="collapse">
  <li><a href="#updating-to-the-next-lts" id="toc-updating-to-the-next-lts" class="nav-link" data-scroll-target="#updating-to-the-next-lts">Updating to the next LTS</a></li>
  <li><a href="#updating-system-software-1" id="toc-updating-system-software-1" class="nav-link" data-scroll-target="#updating-system-software-1">Updating system software</a></li>
  <li><a href="#installing-other-applications-and-removing-applications-first-part" id="toc-installing-other-applications-and-removing-applications-first-part" class="nav-link" data-scroll-target="#installing-other-applications-and-removing-applications-first-part">Installing other applications and removing applications — first part</a></li>
  </ul></li>
  <li><a href="#changing-the-end-user-username" id="toc-changing-the-end-user-username" class="nav-link" data-scroll-target="#changing-the-end-user-username">6.2 Changing the end-user username</a>
  <ul class="collapse">
  <li><a href="#create-your-new-end-user-username" id="toc-create-your-new-end-user-username" class="nav-link" data-scroll-target="#create-your-new-end-user-username">Create your new end-user username</a></li>
  <li><a href="#change-csuser-for-your-new-username-everywhere-in-the-script-binusersauthorizedkeys-activate.sh" id="toc-change-csuser-for-your-new-username-everywhere-in-the-script-binusersauthorizedkeys-activate.sh" class="nav-link" data-scroll-target="#change-csuser-for-your-new-username-everywhere-in-the-script-binusersauthorizedkeys-activate.sh">Change <code>csuser</code> for your new username everywhere in the script ~/bin/usersAuthorizedKeys-activate.sh</a></li>
  </ul></li>
  <li><a href="#edit-or-delete-the-message-of-the-day-file" id="toc-edit-or-delete-the-message-of-the-day-file" class="nav-link" data-scroll-target="#edit-or-delete-the-message-of-the-day-file">Edit or delete the “message of the day” file</a>
  <ul class="collapse">
  <li><a href="#login-to-your-new-username" id="toc-login-to-your-new-username" class="nav-link" data-scroll-target="#login-to-your-new-username">Login to your new username</a></li>
  </ul></li>
  <li><a href="#updating-end-user-software-applications" id="toc-updating-end-user-software-applications" class="nav-link" data-scroll-target="#updating-end-user-software-applications">6.3 Updating end-user software applications</a>
  <ul class="collapse">
  <li><a href="#install-genomics-applications-or-print-versions-installed" id="toc-install-genomics-applications-or-print-versions-installed" class="nav-link" data-scroll-target="#install-genomics-applications-or-print-versions-installed">Install Genomics applications or print versions installed</a></li>
  <li><a href="#installing-the-genomics-applications" id="toc-installing-the-genomics-applications" class="nav-link" data-scroll-target="#installing-the-genomics-applications">Installing the Genomics applications</a></li>
  <li><a href="#installing-other-applications-and-removing-applications-second-part" id="toc-installing-other-applications-and-removing-applications-second-part" class="nav-link" data-scroll-target="#installing-other-applications-and-removing-applications-second-part">Installing other applications and removing applications — second part</a></li>
  </ul></li>
  <li><a href="#increasing-storage-size-1" id="toc-increasing-storage-size-1" class="nav-link" data-scroll-target="#increasing-storage-size-1">6.4 Increasing storage size</a>
  <ul class="collapse">
  <li><a href="#delete-the-current-aws-cli-installed-at-system-level" id="toc-delete-the-current-aws-cli-installed-at-system-level" class="nav-link" data-scroll-target="#delete-the-current-aws-cli-installed-at-system-level">Delete the current <code>aws</code> CLI installed at system level</a></li>
  <li><a href="#install-the-latest-aws-cli-locally-in-the-ubuntu-account" id="toc-install-the-latest-aws-cli-locally-in-the-ubuntu-account" class="nav-link" data-scroll-target="#install-the-latest-aws-cli-locally-in-the-ubuntu-account">Install the latest <code>aws</code> CLI locally in the <code>ubuntu</code> account</a></li>
  <li><a href="#configure-the-aws-cli-copy-the-aws-credentials-you-have-been-using-to-your-instance-to-become-ami" id="toc-configure-the-aws-cli-copy-the-aws-credentials-you-have-been-using-to-your-instance-to-become-ami" class="nav-link" data-scroll-target="#configure-the-aws-cli-copy-the-aws-credentials-you-have-been-using-to-your-instance-to-become-ami">Configure the <code>aws</code> CLI: copy the AWS credentials you have been using to your ‘instance-to-become-AMI’</a></li>
  <li><a href="#increase-the-storage-of-your-instance-to-become-ami" id="toc-increase-the-storage-of-your-instance-to-become-ami" class="nav-link" data-scroll-target="#increase-the-storage-of-your-instance-to-become-ami">Increase the storage of your ‘instance-to-become-AMI’</a></li>
  </ul></li>
  <li><a href="#before-creating-your-ami-last-trimmings-and-deleting-all-login-keys" id="toc-before-creating-your-ami-last-trimmings-and-deleting-all-login-keys" class="nav-link" data-scroll-target="#before-creating-your-ami-last-trimmings-and-deleting-all-login-keys">6.5 Before creating your AMI: last trimmings and deleting all login keys</a>
  <ul class="collapse">
  <li><a href="#minor-trimmings-you-may-want-in-each-instance-created-from-your-ami" id="toc-minor-trimmings-you-may-want-in-each-instance-created-from-your-ami" class="nav-link" data-scroll-target="#minor-trimmings-you-may-want-in-each-instance-created-from-your-ami">Minor trimmings you may want in each instance created from your AMI</a></li>
  <li><a href="#rebooting-your-instance-for-any-changes-to-take-effect" id="toc-rebooting-your-instance-for-any-changes-to-take-effect" class="nav-link" data-scroll-target="#rebooting-your-instance-for-any-changes-to-take-effect">Rebooting your instance for any changes to take effect</a></li>
  <li><a href="#deleting-all-login-keys" id="toc-deleting-all-login-keys" class="nav-link" data-scroll-target="#deleting-all-login-keys">Deleting all login keys</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/Cloud-SPAN/nerc-metagenomics-v2q/edit/main/docs/lesson02-managing-aws-instances/03-ami-management.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/Cloud-SPAN/nerc-metagenomics-v2q/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../docs/lesson02-managing-aws-instances/index.html">Managing AWS Instances</a></li><li class="breadcrumb-item"><a href="../../docs/lesson02-managing-aws-instances/03-ami-management.html">AMIs Management</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">AMIs Management</h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prerequisites
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Please read <a href="../../index.html#course-overview">Workshops Organisation</a></strong> if you haven’t done so. To complete this episode you will need:</p>
<ul>
<li><p>to have completed the previous episode: <a href="../../docs/lesson02-managing-aws-instances/02-instances-management.html">Instances Management Tasks Using the Scripts</a>.</p></li>
<li><p>if you are attending a workshop using a <strong>Cloud-SPAN AWS account</strong>, you <strong>will be given</strong> the necessary information at the workshop to complete this episode.</p></li>
<li><p>if you are self-studying the course <strong>or</strong> attending a workshop using <strong>your AWS account</strong>, you will need:</p>
<ul>
<li>to have created your AWS account as described in <a href="../../docs/lesson01-setting-work-envs/01-create-aws-account.html">Create Your AWS Account</a>.</li>
<li>to have configured your AWS account as described in <a href="../../docs/lesson01-setting-work-envs/02-configure-account.html">Configure Your AWS Account</a>.</li>
<li>to have configured your terminal environment as described in either of these episodes:
<ul>
<li><a href="../../docs/lesson01-setting-work-envs/03-configure-terminal.html">Configure Your Terminal Environment</a> — <strong>or</strong></li>
<li><a href="../../docs/lesson01-setting-work-envs/04-configure-cloudshell.html">Configure Your AWS CloudShell Environment</a>.</li>
</ul></li>
<li>to have configured instances internet access as described in <a href="../../docs/lesson02-managing-aws-instances/01-configure-instances-internet.html">Configure Instances Internet Access</a>.</li>
<li>your <strong>base domain name</strong>.</li>
<li>the AWS resource IDs of your: <strong>host zone</strong>, <strong>security group</strong>, and <strong>subnet</strong>.</li>
<li>the AWS Console login details of your IAM user account: <strong>login page</strong>, <strong>username</strong> and <strong>password</strong>.</li>
</ul></li>
</ul>
</div>
</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>An AWS instance is a virtual machine that runs on AWS <strong>physical computers</strong> (servers). An AWS instance is created by combining two main components: (1) a <strong>software environment</strong>, typically an operating system such as Windows, Linux or MacOS, that is configured with end-user software applications and data; and (2) a <strong>virtualised</strong> (software-emulated) <strong>hardware platform</strong> that is mainly defined by the number of processors and the amount of main memory to be made available to the operating system.</p>
<p>A software enviroment is called an <strong>Amazon Machine Image</strong> (AMI) in AWS terminology, and there is plenty of AMIs to choose from, offered by AWS itelf, by the AWS Marketplace, or by other AWS users in support of a <strong>community</strong> such as the Carpentries or the Cloud-SPAN teams. Some AMIs are configured to run as database servers, others as web servers, etc., either with Windows, Linux or MacOS. <strong>Virtualising</strong> hardware platforms enables AWS to run multiple instances on any physical server with enough capacity — this improves the use of physical resources and the prices that users are offered, and users can relatively easily change “hardware platform” on account of computing demand, among other benefits.</p>
<p>In the last episode we used the Scripts to create multiple AWS instances through <strong>specifying</strong> (in configuration files) the <strong>instances names</strong>, the id of the <strong>AMI</strong> from which to create the instances, etc. For each request to create an instance, AWS <strong>makes</strong> a copy of the specified AMI, <strong>attaches</strong> the copy to the specified “hardware platform” (we specified <em>t3.small</em>), and <strong>configures</strong> the copy which then becomes a proper runnable and accessible instance. The Cloud-SPAN project uses Linux Ubuntu AMIs, and hence the configuring <strong>by AWS</strong> of each AMI copy includes enabling the <strong>ubuntu</strong> user to login, through adding the <strong>public key</strong> part of the login key created to access the instance to the file <code>/home/ubuntu/.ssh/authorized_keys</code> in the <strong>ubuntu</strong> account. Finally, each instance is configured (by our script <code>aws_instances_configure.sh</code>) to enable the <strong>csuser</strong> to login, through copying that file in the ubuntu account to the file <code>/home/csuser/.ssh/authorized_keys</code> in the <strong>csuser</strong> account.</p>
<p><strong>AMIs are created from AWS instances</strong> in three main steps: (<strong>1</strong>) <strong>creating</strong> an instance, (<strong>2</strong>) <strong>configuring</strong> the instance as <em>required</em> regarding software and data, and (<strong>3</strong>) <strong>requesting</strong> AWS <em>to create</em> an AMI from the instance — AWS copies the instance <em>software environment</em> into an AMI <em>software enviroment</em> from which other instances can be created. Steps 1 and 3 are the same for any AMI and hence are <strong>mechanical</strong>. Step 2, <strong>configuring</strong> an instance (that is) to become AMI, may be simple or rather complex depending on what software/data needs updating, and may involve design.</p>
<p>This episode presents the management of AMIs that we do as part of managing AWS instances with the Scripts. The first 3 sections cover the <strong>mechanical part</strong>, steps 1 and 3 above, which are rather simple once you have gone through the tasks involved. The last 3 sections cover our approach to and experience in <strong>configuring</strong> instances to become AMIs. Knowing the configuring we have done and some scripts we have developed to facilitate common configuring tasks will help you not to start from scratch.</p>
</section>
<section id="sections" class="level1">
<h1>Sections</h1>
<ol type="1">
<li><p><strong><a href="#create-an-instance-to-become-ami">Create an instance to become AMI</a></strong><br>
In this section you are going to create an ‘instance-to-become-AMI’ using the file-directory structure we use to manage such instances.</p></li>
<li><p><strong><a href="#create-an-ami-and-make-it-public-in-the-aws-console">Create an AMI and make it Public in the AWS Console</a></strong></p></li>
<li><p><strong><a href="#delete-an-ami-in-the-aws-console">Delete an AMI in the AWS Console</a></strong><br>
We use the AWS Console to create an AMI, to make it public or private, and to delete it. Sections 2 and 3 will guide you to perform those tasks with the AWS Console. — In case you are wondering about <strong>scripting AMIs management</strong>, yes AMIs can also be managed (created, deleted, etc.) with the AWS CLI, and hence a set of scripts (like the Scripts that manage instances) could be developed to manage AMIs. We haven’t had the need to do so, however: the AMI tasks we need to perform are rather simple in the AWS Console and only rarely needed in the Cloud-SPAN project, so far.</p></li>
<li><p><strong><a href="#instances-management-for-courses-amis-and-tests">Instances management for courses, AMIs and tests</a></strong><br>
Section 4 introduces the file-directory structure we use to manage instances to-become-AMIs. This section describes other AMI management practices we follow.</p></li>
<li><p><strong><a href="#when-to-configure-an-instance-to-become-ami">When to configure an instance to become AMI</a></strong><br>
Based on our experience in configuring instances to-become-AMIs within the Cloud-SPAN project, this section presents our viewpoint as to when and how to create an AMI.</p></li>
<li><p><strong><a href="#configure-an-instance-to-become-ami">Configure an instance to become AMI</a></strong><br>
This section shows our approach to update both system software and end-user software using various scripts we have developed to automate some of the tasks involved.</p></li>
</ol>
</section>
<section id="create-an-instance-to-become-ami" class="level1">
<h1>1. Create an ‘instance-to-become-AMI’</h1>
<p>This section shows how to create an ‘instance-to-become-AMI’ using the file-directory structure that we use to manage such instances.</p>
<p>The file structure is similar to the one we use to manage <strong>courses</strong>, that is: we use a directory called <strong>amis</strong> that contains a directory for each AMI we create, and inside each such directory the <code>inputs</code> directory with the Scripts configuration files to create and manage an ‘instance-to-become-AMI’. And we handle our <strong>courses</strong> and <strong>amis</strong> directories at the same level as shown below:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">amis</span>            </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>   <span class="ex">ami01-theScripts-course</span>      <span class="co">### course/workshop name; you can use other name</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>      <span class="ex">inputs</span>                    <span class="co">### you **cannot** use other name</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>         <span class="ex">instancesNames.txt</span>     <span class="co">### you can use other name </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>         <span class="ex">resourcesIDs.txt</span>       <span class="co">### you **cannot** use other name</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>         <span class="ex">tags.txt</span>               <span class="co">### you **cannot** use other name</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>      <span class="ex">outputs</span>                   <span class="co">### created automatically by the Scripts - not to be changed</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>   <span class="ex">ami02-genomics-course</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>   <span class="ex">ami03-metagenomics-course</span>   </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="ex">courses</span>       </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>   <span class="ex">genomics01</span> </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>   <span class="ex">genomics02</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>   <span class="ex">metagenomics01</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s create the directory-file structure you need to create the ‘instance-to-become-AMI’. Type or copy-paste the commands in the code box below. For convenience, our full prompt (<code>csuser@cloud-admin-instance:~</code>) is only shown for the first command.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb2" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@cloud-admin-instance:~</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mkdir <span class="at">-p</span> amis/ami01-theScripts-course/inputs</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cp courses/instances-management/inputs/<span class="pp">*</span> amis/ami01-theScripts-course/inputs/</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls amis/ami01-theScripts-course/inputs/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb3" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">instancesNames.txt</span>  resourcesIDs.txt  tags.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You now need to edit the file <strong>instancesNames.txt</strong> with your text editor to:</p>
<ul>
<li>delete all the instances names</li>
<li>enter a new single instance name<br>
for example: <em>instance-to-become-AMI01</em></li>
<li>save the file</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
If you are attending a Cloud-SPAN workshop using a Cloud-SPAN AWS account:
</div>
</div>
<div class="callout-body-container callout-body">
<p>Please suffix your instance name with your name or surname to distinguish it from other participants’ instance in the AWS Console.</p>
</div>
</div>
<p>Then create the instance:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb4" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@cloud-admin-instance:~</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> csinstances_create.sh amis/ami01-theScripts-course/inputs/instancesNames.txt </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The instance should now be running.</p>
</section>
<section id="create-an-ami-and-make-it-public-in-the-aws-console" class="level1">
<h1>2. Create an AMI and make it public in the AWS Console</h1>
<p>Now we are going to use the AWS Console both to create an AMI from the instance you created above and to make the AMI <strong>public</strong>, that is, usable by other AWS users.</p>
<p>As mentioned in the introduction, you will normally create an AMI in the AWS Console after you have <strong>configured</strong> an AWS instance as required regarding software and data. We are <strong>skipping</strong> the configuration step in this section. You are not compelled to configure an instance before creating an AMI from it. You can create an AMI any time you see it necessary/useful, including learning how to do it.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
You can create an AMI any time you deem necessary/useful.
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is rather useful when the configuration of an ‘instance-to-become-AMI’ is long, .., complex. You can create various intermediate AMIs at different levels of progress and roll back to any of them if needed — kind of managing multiple <strong>commits</strong> with <code>git</code>. If you need to roll back to an intermediate AMI, say, AMI02, you will create an AWS instance from AMI02 and that instance will become your new ‘instance-to-become-AMI’.</p>
</div>
</div>
<section id="login-to-the-aws-console-with-your-iam-account-user" class="level2">
<h2 class="anchored" data-anchor-id="login-to-the-aws-console-with-your-iam-account-user">Login to the AWS Console with your IAM account user</h2>
<p>Once you are logged in to the AWS Console, <strong>go to</strong> the page “EC2 - Instances” as follows:</p>
<ul>
<li>type <strong>EC2</strong> in the AWS search box at the top.</li>
<li>in the page that appears, “EC2 Dashboard” (not shown), click on <strong>Instances</strong> on the left menu pane.</li>
</ul>
<p>You should now be presented with the “Instances” page, similar to the page below.</p>
</section>
<section id="stop-the-instance-if-it-is-running" class="level2">
<h2 class="anchored" data-anchor-id="stop-the-instance-if-it-is-running">Stop the instance if it is running</h2>
<p>Creating an AMI involves <strong>making a copy</strong> of the source <strong>instance</strong> <em>software environment</em> (operating system, end-user software applications and data). In order to ensure the <strong>consistency</strong> of the copy, we need to stop the instance before the copy starts.</p>
<p>On your “Instances” page:</p>
<ul>
<li>select your ‘instance-to-become-AMI’ if it is running: <strong>check</strong> the box to the left of the instance name.<br>
we have selected “cloud-admin-instance” in the page below.</li>
<li>click on the drop-down menu <strong>Instance state</strong> at the top.</li>
<li>click on <strong>Stop instance</strong>.</li>
<li>wait for the instance state to change to <strong>Stopped</strong>.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/03-amis-management/01-ami-management-tasks-stop-instance.png" class="img-fluid figure-img" alt="Screenshot of AWS Console EC2 Instances page in a browser showing the following items circled: the checkbox to the left of an instance name checked, the drop-down menu Instance state and the option Stop instance." width="900"></p>
<figcaption>.</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
You may need to <strong>reboot</strong> the instance first, and then <strong>stop</strong> it.
</div>
</div>
<div class="callout-body-container callout-body">
<p>You may have already seen a message like the one below after updating the operating system in your personal computer:</p>
<p>“<em>Your computer needs to restart for changes to take effect.</em>”</p>
<p>If you have updated the operating system in the ‘instance-to-become-AMI’ as part of the configuration you intend for the new AMI, then <strong>you need to reboot the instance</strong> first and then stop it before creating an AMI from it. If <strong>you don’t</strong>, if you create the AMI without rebooting the instance, then each of the instances that you create with that AMI will have to be rebooted after being launched. Hence you just delay doing it and will have it multiplied.</p>
<p>We always reboot an ‘instance-to-become-AMI’ even if we only update end-user software applications or data so that any state or data is flushed from main memory onto secondary storage (which is the software environment to copy). The page above shows the option to <strong>Reboot</strong> an instance.</p>
</div>
</div>
</section>
<section id="select-the-instance-and-the-options-to-create-an-image-ami-from-it" class="level2">
<h2 class="anchored" data-anchor-id="select-the-instance-and-the-options-to-create-an-image-ami-from-it">Select the instance and the options to create an image (AMI) from it</h2>
<p>Once your instance is stopped, do as follows (see page below):</p>
<ul>
<li>select your instance if it is not selected: <strong>check</strong> the box to the left of the instance name.</li>
<li>click on the drop-down menu <strong>Actions</strong> at the top</li>
<li>click on <strong>Image and templates</strong></li>
<li>click on <strong>Create image</strong>.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/03-amis-management/02-ami-management-tasks-create-ami-options.png" class="img-fluid figure-img" alt="Screenshot of AWS Console EC2 Instances page in a browser showing the following items circled: the checkbox to the left of an instance name checked, the  Actions drop-down menu at the top,  the option Image and templates, and the option Create image." width="900"></p>
<figcaption>.</figcaption>
</figure>
</div>
</section>
<section id="enter-a-name-and-other-info-for-the-ami-and-click-on-create-image" class="level2">
<h2 class="anchored" data-anchor-id="enter-a-name-and-other-info-for-the-ami-and-click-on-create-image">Enter a name and other info for the AMI and click on <strong>Create image</strong></h2>
<p>You will now be presented with the page below: “Create image”. Type a <strong>name</strong> and a <strong>description</strong> for your AMI in the first two highlighed fields from the top. The description field is optional; but it’s useful to write a brief description of the AMI configuration so you can easily recall what the AMI is about.</p>
<p>The highlighted option below, <strong>No reboot</strong> and its checkbox <strong>Enable</strong>, should be as shown: <strong>unchecked</strong>. Uncheck it if it is checked. By default, AWS <strong>shuts down</strong> and <strong>reboots</strong> the ‘instance-to-become-AMI’ <strong>if it is running</strong> in order to get a consistent state of the instance storage. If you check it, you <strong>Enable</strong> (both no shut down and) <strong>No reboot</strong>. And AWS <strong>cannot guarantee</strong> a consistent state for the AMI. This option is not applicable if you (reboot and) stop the instance as suggested.</p>
<p>The highlighted option below and to the right, <strong>Delete on termination</strong> and its checkbox <strong>Enable</strong>, should be as shown: <strong>checked</strong>. Check it if it is unchecked. This option means that, for all instances created from the AMI you are about to create, once the instances are <strong>terminated</strong>/deleted, their storage/volumes should be deleted. We want this behaviour — we don’t want to delete each such volume individually: <strong>the Scripts don’t handle deleting those volumes</strong>. On the other hand, you may find usefull to delete an instance but not its storage: you will no longer be able to stop, start and login to the instance, but you will be able to attach its storage to another (runnable) instance. We did something along these lines to reduce the size of the disk and file system of an AMI.</p>
<p>The value of the field <strong>Size</strong>, at the bottom of the page in the middle, is 30 GB, and is the size of the storage of the ‘instance-to-become-AMI’. The same size will be used for the storage of the AMI to be created unless you increase it. You <strong>cannot decrease</strong> it: it is assumed that the operating system inside is controlling all the storage (even if it is not) — decreasing it would corrupt the file system.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/03-amis-management/03-ami-management-tasks-enter-ami-details.png" class="img-fluid figure-img" alt="Screenshot of AWS Console Create image page in a browser showing the following items circled: the Image name box to enter an image name, the Image description - optional box to enter an image description, the No reboot option and its checkbox unchecked, the Delete on termination option and its checkbox checked" width="900"></p>
<figcaption>.</figcaption>
</figure>
</div>
<p>Scroll down the “Create image” page until you see the end of the page as shown below. The first highlighted option from the top, <strong>Tag image and snaphots together</strong>, should be <strong>checked</strong>. Check it if it is unchecked. Now click on <strong>Add new tag</strong> on the bottom left (we have already done so in the page below) so that two boxes will appear, titled <strong>Key</strong> and <strong>Value</strong> - <em>optional</em>. In the Key box, enter <strong>Name</strong> (literally), and in the Value box enter the name you entered for your AMI before, see the page below. The benefit of doing this is explained below. You can add more tags if needed.</p>
<p>Finally, click on <strong>Create image</strong> at the bottom right. You will be presented with the “Instances” page again, showing at the top a message like this one (our emphasis):</p>
<p>“Currently creating AMI ami-0f6c9742b2f6824bb from instance i-00c65a40a9d194cfc. Check that the AMI status is ‘Available’ <strong>before deleting the instance</strong> or carrying out other actions related to this AMI”.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/03-amis-management/04-ami-management-tasks-enter-ami-tags.png" class="img-fluid figure-img" alt="Screenshot of AWS Console Create image page, scrolled down to the end, in a browser showing the following items circled: the option Tag image and snapshots together selected, a Key box to enter a tag name, Value - optional box to enter a tag value, and the Create image button" width="900"></p>
<figcaption>.</figcaption>
</figure>
</div>
</section>
<section id="check-your-ami-and-make-it-public-or-private" class="level2">
<h2 class="anchored" data-anchor-id="check-your-ami-and-make-it-public-or-private">Check your AMI and make it public or private</h2>
<p>To check your AMI, go to the (EC2) “Amazon Machine Images (AMIs)” page: on the left menu pane, scroll down (or up) to find <strong>AMIs</strong> and click on it.</p>
<p>You will be presented with a page like the one below. The page below shows (in tabular form) the attributes/properties of two AMIs that we created for this section. The attribute <strong>Name</strong> (first column from left), corresponds to the value of the tag key that we suggested to add. The third attribute, <strong>AMI name</strong>, is the name of the first field in the page above where you entered the name for your AMI when your created it.</p>
<p>You can see in the page below that we didn’t add such a tag for the first AMI listed, so it has no value for <strong>Name</strong>, but we did add the tag for the second AMI using the same value for <strong>Name</strong> that we used for <strong>AMI name</strong>. The benefit of this tagging will be apparent when we delete the AMI below.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/03-amis-management/05-ami-management-tasks-amis-page.png" class="img-fluid figure-img" alt="Screenshot of AWS Console Amazon Machine Images (AMIs) page in a browser, showing a table listing AMIs properties and two AMI entries in the table circled" width="900"></p>
<figcaption>.</figcaption>
</figure>
</div>
<p>In the AMIs page shown above, there are quite a few more attributes for each AMI in that table on the right (scroll the table left to see other AMI attributes, there is a bar below the table to do so, not shown in the page). Other AMI attributes include:</p>
<ul>
<li><strong>Visibility</strong></li>
<li><strong>Platform</strong> (Linux, Windows, etc.)</li>
<li><strong>Creation date</strong></li>
<li>etc.</li>
</ul>
<p>Visibility is about whether an AMI is <strong>private</strong> or <strong>public</strong>. If you create an AMI you can keep it private for your own exclusive use or make it public so that other people (outside your AWS account) can find it and use it to create instances from it. Public visibility extends to the region where the AMI was created only.</p>
<p>To make an AMI public or private, do as follows in the AMIs page:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/03-amis-management/06-ami-management-tasks-ami-edit-option.png" class="img-fluid figure-img" alt="Screenshot of AWS Console Amazon Machine Images (AMIs) page in a browser, showing the following items circled: the checkbox to the left of an AMI name checked, the Actions drop-down menu at the top, and the option Edit AMI permissions (within the Actions menu)" width="900"></p>
<figcaption>.</figcaption>
</figure>
</div>
<ul>
<li>select the AMI: check the box to the left of the AMI Name</li>
<li>click on the drop-down menu <strong>Actions</strong> at the top right</li>
<li>click on <strong>Edit AMI permissions</strong> — in the page that appears, “Edit AMI permissions” (not shown):
<ul>
<li>select <strong>Public</strong> or <strong>Private</strong> under the heading “AMI Availability”, then scroll down and</li>
<li>click on <strong>Save changes</strong></li>
</ul></li>
</ul>
</section>
</section>
<section id="delete-an-ami-in-the-aws-console" class="level1">
<h1>3. Delete an AMI in the AWS Console</h1>
<p>Deleting an AMI is a two-fold task: <strong>deleting the AMI</strong> as such and <strong>deleting its storage</strong> — similar to deleting an instance but keeping its storage mentioned above. But there is no option in the AWS console for AMIs (as there is for instances) that you can check (turn on) so that deleting an AMI will involve deleting its storage as well. You need to delete the AMI first and then delete its storage. This behaviour gives you a second chance <strong>to recover an AMI</strong> in case you delete it by mistake.</p>
<section id="delete-the-ami-first" class="level2">
<h2 class="anchored" data-anchor-id="delete-the-ami-first">Delete the AMI first</h2>
<p>To delete an AMI, do as follows on the (EC2) AMIs page (see page below):</p>
<ul>
<li>select the AMI: <strong>check</strong> the box to the left of the AMI Name</li>
<li>click on the drop-down menu <strong>Actions</strong> at the top right</li>
<li>click on <strong>Deregister AMI</strong></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/03-amis-management/07-ami-management-tasks-ami-deregister-option.png" class="img-fluid figure-img" alt="Screenshot of AWS Console Amazon Machine Images (AMIs) page in a browser, showing the following items circled: the checkbox to the left of an AMI name checked, the Actions drop-down menu at the top, and the option Deregister AMI (within the Actions menu)" width="900"></p>
<figcaption>.</figcaption>
</figure>
</div>
<p>Once you click on <strong>Deregister</strong>, a window like the one below will pop up.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/03-amis-management/08-ami-management-tasks-ami-deregister-warning-message.png" class="img-fluid figure-img" alt="Screenshot of AWS Console Deregister AMI pop-up window in a browser, showing the drop-down option Delete associated snapshots and the button Deregister AMI circled" width="900"></p>
<figcaption>.</figcaption>
</figure>
</div>
<p>In the page above, we have clicked on <strong>Deleted associated snapshots</strong> (in the middle). Doing so displayed the message:</p>
<p>“<em>Snapshots are not automatically deleted when you deregister and AMI. <strong>After</strong> you deregister the AMI, you can delete the snapshots in the <strong>Snapshots Screen</strong>[link].</em>”</p>
<p>As the message states: you can delete the storage/<strong>snapshots</strong> of an AMI only <strong>after</strong> you delete/<strong>deregister</strong> the AMI. You have two options to do so. We will describe first the option we have been using.</p>
<p>In the option we use, in the popped up window in the page above:</p>
<ul>
<li>click on <strong>Deregister AMI</strong> (in orange) to confirm deletion of the AMI:<br>
the AMIs page will be displayed again with the message “Successfully deregistered ami-042b2f6824bbf6c97.” in green at the top.</li>
</ul>
<p>Once you click on <strong>Deregister AMI</strong>, the AMI as such will be deleted (you won’t be able to create instances from it). You now need to delete the snapshots.</p>
</section>
<section id="delete-the-storagesnapshots-of-the-ami-option-we-use" class="level2">
<h2 class="anchored" data-anchor-id="delete-the-storagesnapshots-of-the-ami-option-we-use">Delete the storage/snapshots of the AMI (option we use)</h2>
<p>To delete the snapshots of an AMI, go to the (EC2) “Snapshots” page: on the <strong>left</strong> menu pane, scroll down (or up) to find <strong>Snapshots</strong> and click on it. You will then be presented with a page like the one below.</p>
<p>Do as follows on this page:</p>
<ul>
<li>select the snapshot/s to delete: <strong>check</strong> the box to the left of the snapshot Name.</li>
<li>click on the drop-down menu <strong>Actions</strong> at the top right</li>
<li>click on <strong>Delete snapshot</strong></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/03-amis-management/10-ami-management-tasks-snapshots-page-delete-option.png" class="img-fluid figure-img" alt="Screenshot of AWS Console Snapshots page in a browser, showing the following items circled: two checkboxs to the left of two snapshots names, checked, the Actions drop-down menu at the top, and the option Delete snapshot (within the Actions menu" width="900"></p>
<figcaption>.</figcaption>
</figure>
</div>
<p>That’s it. You have deleted the AMI in its entirety.</p>
<p>In this option to delete the snapshots of an AMI, note that we rely on the tagging we suggested to add in the instructions to create an AMI. That is:</p>
<ul>
<li>selecting the option <strong>Tag image and snapshots together</strong> and</li>
<li>adding a Tag with the <em>Key</em> <strong>Name</strong> and <em>Value</em> <strong><em>your-AMI-name</em></strong></li>
</ul>
<p>In the page above, the snapshot with no <strong>Name</strong> (the second one of those checked) is the snapshot attached to the AMI for which we did not specify that tag. With no such tags, you will need to somehow ensure that you are deleting the right snapshot, by looking at the details of the target AMI to get the IDs of the attached snapshots.</p>
</section>
<section id="delete-the-storagesnapshots-of-the-ami-other-option" class="level2">
<h2 class="anchored" data-anchor-id="delete-the-storagesnapshots-of-the-ami-other-option">Delete the storage/snapshots of the AMI (other option)</h2>
<p>Alternatively, you can delete the snaphots of an AMI as follows. In the page with the window that pops up after you clicked on <strong>Deregister AMI</strong> for the first time (shown below again), do as follows:</p>
<ul>
<li>click on <strong>Snapshots screen</strong> (in blue) <strong>before</strong> clicking on <strong>Deregister AMI</strong>.<br>
This will open the “Snapshots” page in a new browser tab, <strong>listing only</strong> the snapshots attached to the AMI/s you previously selected to deregister — hence you don’t need the <strong>Names</strong> of the relevant AMI to identify the snapshots.</li>
<li>click on <strong>Deregister AMI</strong> — you need to deregister the AMI before deleting the snapshots.</li>
<li>in the “Snapshots” page in the new browser tab
<ul>
<li>select the snapshots to delete</li>
<li>click on <strong>Actions</strong> at the top of the page</li>
<li>click on <strong>Delete snaphot</strong></li>
</ul></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/03-amis-management/08-ami-management-tasks-ami-deregister-warning-message.png" class="img-fluid figure-img" alt="Screenshot of AWS Console Deregister AMI pop-up window in a browser (shown again), showing the drop-down option Delete associated snapshots and the button Deregister AMI circled" width="900"></p>
<figcaption>.</figcaption>
</figure>
</div>
</section>
</section>
<section id="instances-management-for-courses-amis-and-tests" class="level1">
<h1>4. Instances Management for Courses, AMIs and Tests</h1>
<p>Section 1 introduced the file-directory structure we use to manage instances for courses and for AMIs, in the directories <strong>courses</strong> and <strong>amis</strong>.</p>
<p>We also handle instances for <strong>tests</strong> similary, that is: using a directory called <strong>tests</strong> that contains a directory for each test we perform, and inside each such directory the <code>inputs</code> directory with the Scripts configuration files to create and manage the instance/s used in the test. A test may involve trying a new domain name configuration, trying the configurability of intance types (virtualised hardware platforms), for example, <code>t2.small</code> vs <code>t3.small</code>, etc. The results of a test may or may not be incorporated into an AMI.</p>
<section id="our-working-directory-to-run-the-scripts" class="level2">
<h2 class="anchored" data-anchor-id="our-working-directory-to-run-the-scripts">Our working directory to run the Scripts</h2>
<p>The <strong>tests</strong> directory is located at the same level as the directories <strong>courses</strong> and <strong>amis</strong>. Our actual working directory where we run the Scripts (in our Linux machine) looks like this:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb5" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jorge@wine:~/software/york/cloud-SPAN/aws-instances</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb6" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">amis</span>  courses  tests  the-Scripts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And we run the Scripts specifying:</p>
<ol type="1">
<li>either <code>amis</code> or <code>courses</code> or <code>tests</code>.</li>
<li>one or more <strong>intermediate</strong> directories (before the <code>inputs</code> directory where the configuration files <em>instancesNames.txt</em>, <code>resourcesIDs.txt</code> and <code>tags.txt</code> reside).</li>
<li>the <code>inputs</code> directory.</li>
<li>the target <em>instancesNames.txt</em> file.</li>
</ol>
<p>Examples:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb7" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jorge@wine:~/software/york/cloud-SPAN/aws-instances</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> csinstances_create.sh amis/ami09-metagenomics-instance/metagenomicsT3instance/inputs/instancesNames01.txt </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> csinstances_create.sh courses/genomics20221206-7/inputs/instancesNames.txt</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> csinstances_create.sh tests/t003-cloud-admin-course-instance-UoYacc20221107/inputs/instancesNames-cloud-admin-instance.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The file-directory structure is rather flexible. We are only bound to specify first (the type of the target instances through the name of the directory) <code>amis</code> or <code>courses</code> or <code>tests</code>, and down the path the <code>inputs</code> directory just before the target <em>instancesNames.txt</em> whose name we can choose according to need.</p>
<p>The path in the first example has two <strong>intermediate</strong> directories while the two other examples have only one (as in all the code examples we showed before). In the <strong>first example</strong>, we started the configuration of the meteganomics ‘instance-to-become-AMI’ using the AWS instance type <code>t2.medium</code> which we inherited from the Data Carpentries AMI. Instance type <code>t2</code> cannot scale as much as we needed to, while instance type <code>t3</code> can. So we changed to type <code>t3</code> which involve creating a new temporary AMI and we decided to handle it on a new intermediate directory called <code>metagenomicsT3instance</code> under <code>ami09-metagenomics-instance</code>. We could also have handled it as <code>ami09-metagenomics-T3instance</code> under <strong>amis</strong>.</p>
</section>
<section id="instances-names-we-use" class="level2">
<h2 class="anchored" data-anchor-id="instances-names-we-use">Instances names we use</h2>
<p>The actual names we use when creating instances are suffixed with the name of the AMI template from which the instances are created. You don’t need to follow this naming convention but it is helpful under some circumstances.</p>
<p>It was helpful for us in the beginning, when we had to add some functionality/configuration into a new AMI relatively frequently until our AMIs got “stable” — meanwhile we had instances running that were created from different AMI templates. Anyway, we needed displayed in the AWS Console the name of the source AMI of each instance. So instances names in our <em>instancesNames.txt</em> files have this form:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb8" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">instance306-srcCS-AMI09-MetaGen</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">cloud-admin-instance-srcCS-AMI08</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ex">metagenomics-instance001-srcCS-AMI09-MetaGen</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="ex">metagenomics-Joao-srcCS-AMI09-MetaGen</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The instance name proper, the one that is used for the instance domain name and hostname of each instance, is the substring from the beginning of each line up to before the substring <code>-src</code> (for source AMI name). After <code>src</code> you can add the name of your AMI. The Scripts extract the instance proper name to configure the instance domain name and host name within each instance. But use the whole name as the value for the instance tag <strong>Name</strong> which is displayed in the AWS Console, as shown below:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/03-amis-management/11-ami-management-tasks-AMI-suffix-for-instance-names.png" class="img-fluid figure-img" alt="Screenshot of AWS Console EC2 Instances page in a browser showing the state, Stopping, of three instances previously created and running, circled" width="900"></p>
<figcaption>.</figcaption>
</figure>
</div>
<p>We can handle the name of the source AMI as part of the instance name but then it will appear in both the instance domain name and the host domain name and this would be distracting to end users.</p>
<p>As <strong>mentioned above</strong>, you don’t need to suffix your instances names but obviously <strong>you should not use</strong> the substring <code>-src</code> anywhere in an instance name unless you intend to add the source AMI name as we do. You can also edit the Scripts to get rid of that suffix handling.</p>
<p>The list of instances names in the output box above is <strong>not</strong> meant to be the contents of an actual “instancesNames.txt” file that can be used to create/manage instances with the Scripts. The Scripts cannot create instances using two or more AMI templates — but only one.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise: How would you handle a Code Retreat that requires instances from two or more AMI templates?
</div>
</div>
<div class="callout-body-container callout-body">
<p>We currently manage three AMIs. One AMI for the Cloud-SPAN Prenomics and Genomics courses. Two AMIs for two versions of the Metagenomics course that differ in the ’omics data that is analysed. When we run each course we only need to create instances from one AMI template. But we also run Code Retreats in person with students of the three courses and we launch instances of type Genomics and Metagenomics.</p>
<p>How would you manage the instances for such a code retreat within the <strong>courses</strong> directory?</p>
</div>
</div>
</section>
</section>
<section id="when-to-configure-an-instance-to-become-ami" class="level1">
<h1>5. When to configure an ‘instance-to-become-AMI’</h1>
<p>This section presents some of our experince in <strong>configuring</strong> ’instance-to-become-AMI’s — the second step of the three main steps to create an AMI mentioned earlier:</p>
<ol type="1">
<li>creating an instance (Section 1)</li>
<li>configuring the instance as required regarding software and data, and</li>
<li>requesting AWS to create an AMI from the instance (Section 2)</li>
</ol>
<p>We use in this section the term “<em>creating an AMI</em>” to mean <strong>both</strong> “<em>configuring an ‘instance-to-become-AMI’</em>” <strong>and</strong> “<em>creating an AMI from that instance in the AWS Console</em>”.</p>
<section id="requirements-for-which-we-have-created-a-new-ami" class="level2">
<h2 class="anchored" data-anchor-id="requirements-for-which-we-have-created-a-new-ami">Requirements for which we have created a new AMI</h2>
<ul>
<li>updating software or data</li>
<li>reducing the storage size</li>
<li>increasing the storage size</li>
<li>changing AWS configuration</li>
</ul>
</section>
<section id="updating-software-or-data" class="level2">
<h2 class="anchored" data-anchor-id="updating-software-or-data">Updating software or data</h2>
<p>Updating software or data or both is the obvious reason to create a new AMI — it literally means any change in software or data, including:</p>
<ul>
<li>updating or upgrading the operating system</li>
<li>updating any other software:
<ul>
<li>end-user software applications to be used in a course</li>
<li>admin software (scripts) that <strong>you</strong> (as instances manager) need installed in each instance, for example, the Scripts that activate the <strong>csuser</strong> account in each instance, as outlined in the previous episode.</li>
</ul></li>
<li>updating data for a course</li>
</ul>
<p>It is not convenient and we find it unmanageable to create a new AMI every time any item in that list changes. The items that do <strong>require creating</strong> a new AMI <strong>straight away</strong> are <strong>updating data</strong> for a course and sometimes <strong>updating admin scripts</strong> that you need installed in each instance (to be created from the AMI). In our experience all other items can wait, should be assessed, and when possible combined into a new AMI.</p>
<section id="updating-data" class="level3">
<h3 class="anchored" data-anchor-id="updating-data">Updating data</h3>
<p>Updating data requires a new AMI because the data to be updated/added is the subject of (will be processed and analysed in) a course, or you may need to delete some data because it is too big, no longer needed, or you need space in the AMI for something else.</p>
<p>But wait, would it not be better to update the data on each instance (created from a currently used AMI) using some new scripts? And thus avoid creating a new AMI.</p>
<p>If the data is relatively big, it is much better to update the data only once, in the new AMI, rather than mutilple times in each of the instances because the entire process of creating and preparing the instances will take much longer. Also, the new scripts to update the data may be complex and <strong>ad hoc</strong> for each data update, at least in the beginning — until you identify some pattern that enables you to configure the scripts and data transfers in a generic way.</p>
<p>If the data is relatively small, the scripts point regarding complexity may still apply. It will be more complex to design the new scripts to update data in each instance than just updating the data in the new AMI only once.</p>
<p>If you decide to design new scripts to update data in multiple instances (as opposed to creating a new AMI), you <strong>should not invoke</strong> the new scripts within the Scripts. Run the Scripts first to create the instances, and then run the new scripts that update data.</p>
</section>
<section id="updating-admin-scripts" class="level3">
<h3 class="anchored" data-anchor-id="updating-admin-scripts">Updating admin scripts</h3>
<p>Updating admin scripts that you need installed in each instance may, or may not, require creating a new AMI straight away.</p>
<section id="scenario-that-required-creating-a-new-ami-straight-away" class="level4">
<h4 class="anchored" data-anchor-id="scenario-that-required-creating-a-new-ami-straight-away"><em>Scenario that <strong>required</strong> creating a new AMI straight away</em></h4>
<p>The first AMI we created was a copy of the Genomics Data Carpentry AMI. Instances created from the Data Carpentry AMI are also accessed with <code>ssh</code> but using an IP address and a password for the <code>dcuser</code>, which password is the same for all instances. For the Cloud-SPAN instances, we decided to use domain names (instead of IP addresses) and no password for the Cloud-SPAN <code>csuser</code> but an encrypted login key file for each instance. This required, among other things, to create and upload into the Cloud-SPAN AMI a few scripts into the <code>ubuntu</code> user account, in the <code>/home/ubuntu/bin</code> directory. These scripts make the <code>ubuntu</code> user share, with the <code>csuser</code>, the <strong>public key</strong> part of the login key created to access an instance (<em>injected</em> by AWS in <code>/home/ubuntu/.ssh/authorized_keys</code>), so that both users can use the same login key file created for each instance. Each instance created from the first Cloud-SPAN AMI has those scripts which are invoked by the script <code>aws_instances_configure.sh</code> as part of the configuring of each instance.</p>
</section>
</section>
</section>
<section id="you-can-only-use-the-scripts-with-cloud-span-amis" class="level2">
<h2 class="anchored" data-anchor-id="you-can-only-use-the-scripts-with-cloud-span-amis">You can only use the Scripts with Cloud-SPAN AMIs:</h2>
<p>Because of that “login key” and “domain name” <strong>configuration</strong> to access Cloud-SPAN instances, the Scripts can only be used with a Cloud-SPAN AMI as the template from which to create instances.<br>
If you want to use the Scripts and that configuration is OK with you, you can still create your own AMI by configuring end-user software applications and data.<br>
If you want to use the Scripts <strong>but change</strong> that configuration (for example, you want to use IP addresses or not using a login key for the csuser, etc.), you will need to change both the AMI configuration and change the script <code>aws_instances_configure.sh</code> accordingly. {.callout}</p>
<section id="scenario-that-did-not-require-creating-a-new-ami-straight-away" class="level4">
<h4 class="anchored" data-anchor-id="scenario-that-did-not-require-creating-a-new-ami-straight-away"><em>Scenario that <strong>did not require</strong> creating a new AMI straight away</em></h4>
<p>The instances for the Cloud-SPAN Metagenomics courses have each 240GB of secondary storage. The <em>input</em> data that is analysed during the course is about 17GB, but the output data produced from various analyses grows over 100GB. Before the analyses, the input data, the operating system and the metagenomics software applications require less than 50 GB.</p>
<p>Hence, we could have created an AMI of about 50GB and, on creating each instance for the course, <strong>increase</strong> the storage size of each instance to 240GB after the configuration step of each instance by <code>aws_instances_configure.sh</code>. Instead we created the Metagenomics AMIs of size 240GB.</p>
<p>The main reason for that decision was that we ran out of time to design and test the scripts to increase storage. It was safer to have the AMI with 240GB ready and hence the instances also ready once created.</p>
</section>
<section id="updating-the-operating-system-and-end-user-software" class="level3">
<h3 class="anchored" data-anchor-id="updating-the-operating-system-and-end-user-software">Updating the operating system and end-user software</h3>
<p>We have only upgraded the Linux operating system only once. The Data Carpentries AMI from which we created the first Cloud-SPAN AMI was configured with Linux Ubuntu 16.04. The Cloud-SPAN Genomics and Metagenomics AMIs are version 20.04. We don’t see the need to upgrade them to the stable version 22.04 yet.</p>
<p>Likewise we have only updated the end-user software applications in each AMI only once, when we upgraded the Linux operating system from the Data Carpentry version.</p>
<p><strong>There is no need</strong> to update the system or end-user software unless changes to the corresponding courses justify updating the software, something like: somebody has used a more recent version of a software application and has changed the course materials with more accurate results or another way of using the application, etc.</p>
<p><strong>Whenever possible</strong>, install end-user software locally in the <code>csuser</code> account, either in <code>/home/csuser/bin</code> or other local directory. You will have more control as to what to delete in order to configure and create a new AMI.</p>
</section>
</section>
<section id="reducing-storage-size" class="level2">
<h2 class="anchored" data-anchor-id="reducing-storage-size">Reducing storage size</h2>
<p>Reducing storage size <strong>is complex</strong>, and we cannot see a way to automate it yet. We have done it a few times and hopefully won’t do it again in the context of the Cloud-SPAN project — you may not either.</p>
<p>We decided to reduce the size of the Cloud-SPAN AMI for the Prenomics and Genomics courses for two reasons. Those courses don’t require instances bigger than 30GB, and 30GB is the instance size limit in the AWS Free Tier. Thus, Cloud-SPAN students can create their own Genomics instance without paying for one year as described in the Cloud-SPAN course <a href="https://cloud-span.github.io/create-aws-instance-0-overview/">Create Your Own AWS Instance</a>.</p>
<p>As mentioned earlier, the first AMI we created was a copy of the Data Carpentries AMI, which was 120GB. We reduced it to 30GB following the instructions in <a href="https://ehikioya.com/shrink-amazon-ebs-volumes/">How To Shrink Amazon EBS Volumes (Root Or Non-Root)</a> — this site has unfortunately been unavailable some times since we used it — google its title for some options.</p>
<p>We followed those instructions for storage volumes called <code>/dev/xvda</code> and <code>/dev/xvda1</code> which are used in instances of type <code>t2</code>. Cloud-SPAN AMIs are now type <code>t3</code> whose storage volumes are called <code>/dev/nvme0n1 1</code> and <code>/dev/nvme0n1p1</code>.</p>
<p>Hopefully you won’t need to reduce storage below 30GB.</p>
</section>
<section id="increasing-storage-size" class="level2">
<h2 class="anchored" data-anchor-id="increasing-storage-size">Increasing storage size</h2>
<p>Increasing storage size is rather simple and efficient in AWS.</p>
<p>We had to increase storage size for the Cloud-SPAN Metagenomics course instances, up to 240GB, for the reasons already mentioned above. Starting with the Cloud-SPAN AMI for the Genomics course (30GB), we created an instance into which we uploaded a script (into the <code>ubuntu</code> account <code>~/bin</code> directory) that increases storage size, and then created a new AMI. All the instances created from this AMI can run that script to increase the storage size dynamically, that is, without having to log out from the instance. The script is called <code>aws_storageEBS_increase.sh</code>. Its output when run with no parameters is shown below:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb9" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@cloud-admin-instance.cloud-span.aws.york.ac.uk:~</span> $ aws_storageEBS_increase.sh </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb10" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">aws_storageEBS_increase.sh</span> increases the size of the instance disk <span class="er">(</span><span class="ex">EBS</span> storage and the file system<span class="kw">)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">up</span> to the given number of GigaBytes <span class="er">(</span><span class="ex">GB</span><span class="kw">)</span> <span class="cf">if</span> <span class="ex">such</span> number is larger than the current size of the disk.</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="ex">usage:</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">aws_storageEBS_increase.sh</span> newSizeOfDiskInGBs</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Example:</span>       aws_storageEBS_increase.sh 120 </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-</span> increases the size of the disk and file system to be of 120 GB. </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-</span> the current disk size must be smaller than 120 GB</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-</span> note that the file system size may be shown as slightly smaller than disk space:</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">try</span> command: <span class="st">"df -h ."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Back to the development of the Cloud-SPAN Metagenomics AMI, after we created the AMI with the script <code>aws_storageEBS_increase.sh</code> inside, we created an instance, logged into the instance, ran that script to increase the size up to 240GB, configured the metagenomics software and data, and then created the Metagenomics AMI.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise: How would you increase the size of Metagenomics instances dynamically?
</div>
</div>
<div class="callout-body-container callout-body">
<p>That means, how would you?</p>
<ul>
<li>create Metagenomics instances using an AMI 50GB big, and then</li>
<li>increase the size of each instance to 240GB running the script <code>aws_storageEBS_increase.sh</code> in each instance after the instance is created.</li>
</ul>
</div>
</div>
<section id="you-will-hopefully-only-need-to-increase-storage-size-and-not-decrease-it" class="level3">
<h3 class="anchored" data-anchor-id="you-will-hopefully-only-need-to-increase-storage-size-and-not-decrease-it">You will hopefully only need to increase storage size (and not decrease it)</h3>
<p>The size of the Cloud-SPAN Genomics AMI and instances is 30GB. Small enough to be in the AWS Free Tier. Hopefully you will only need to increase its size as outlined above and not to decrease it.</p>
<p>That is, should you need to create a new AMI, you should start with the Cloud-SPAN Genomics AMI, the one you used to create instances with the Scripts in the previous episode, as you will have the option to increase its size easily. However, all depends on your needs, see the last section “Put it all together: …”.</p>
</section>
</section>
<section id="changing-aws-configuration" class="level2">
<h2 class="anchored" data-anchor-id="changing-aws-configuration">Changing AWS configuration</h2>
<p>The Cloud-SPAN Metagenomics AMI not only required more storage than the Genomics AMI but also <strong>more main memory and more processors</strong> which, you will remember, are aspects of the (virtualised) “hardware platform” (not of the software enviroment wich comprises the storage).</p>
<p>We were using “hardware platforms” of type <code>t2</code> (following the Data Carpentries use): <code>t2.small</code>, <code>t2.medium</code> <code>t2.large</code>, etc. For the Metagenomics AMI, at some point we needed to use a larger instance type, <code>r5.4xlarge</code>, but we couldn’t. We got a message saying that type <code>t2</code> was incompatible with the type of internet access required by type <code>r5.4xlarge</code>, something called Elastic Network Adapter (ENA).</p>
<p>Type <code>t3</code> instances are ENA compatible, have similar sizes to type <code>t2</code> (small, medium, etc.), and can use type <code>r5.4xlarge</code> and others. So we change to type <code>t3</code>, meaning that the Cloud-SPAN Genomics and Metagenomics AMIs are type <code>t3</code> and hence, instances created from them are type <code>t3</code> as well.</p>
<p>You can create <code>t2</code> instances from a <code>t3</code> AMI, as follows: in the <code>resourcesIDs.txt</code> file you would use <code>t2.small</code> (or other <code>t2</code> type) as the instance type but use a type <code>t3</code> AMI template such as the Cloud-SPAN AMI you used in the previous episode. The opposite doesn’t hold: you cannot create <code>t3</code> instances from a <code>t2</code> AMI — you will be able to create instances but <strong>you won’t be able to login</strong>.</p>
<p>Again: should you need to create a new AMI, you should start with the Cloud-SPAN Genomics AMI, the one you used to create instances with the Scripts in the previous episode. It will enable you to increase the storage size of offspring instances dynamically, and being <code>t3</code> type you can run offspring instances on more instance types.</p>
<p>By the way, you can change the instance type of an instance in the AWS Console as follows. Go to the <strong>EC2 - Instances</strong> page and select the instance, check the <strong>checkbox</strong> to the left of the instance name, then:</p>
<ul>
<li>stop the instance: click on <strong>Instance state</strong> at the top and then on <strong>Stop instance</strong></li>
<li>wait for the instance state to change to <strong>Stopped</strong></li>
<li>change the instance type: click on <strong>Actions</strong> at the top, then on <strong>Instance settings</strong>, and then on <strong>Change instance type</strong>. A new page will appear where you will be able to change the instance type — save the changes</li>
<li>restart the instance.</li>
</ul>
</section>
</section>
<section id="configure-an-instance-to-become-ami" class="level1">
<h1>6. Configure an instance to become AMI</h1>
<p>THIS section presents our approach to configure an instance to become AMI including:</p>
<p>6.1. Updating system software<br>
6.2. Changing the end-user username<br>
6.3. Updating end-user software applications<br>
6.4. Increasing storage size<br>
6.5. Before creating your AMI: last trimmings and deleting all login keys</p>
<p>Our approach uses a few scripts that we developed to automate some of the tasks of installing and updating software. The scripts organisation is such that steps <strong>6.1, 6.2</strong> and <strong>6.3</strong> must be performed <strong>in that order</strong>, but you can omit step <strong>6.2</strong> if you don’t need to change the Cloud-SPAN <code>csuser</code> to a username of your choice. Step <strong>6.4</strong>, increasing storage size, is performed by simply running the Bash script <code>aws_storageEBS_increase.sh</code> (EBS: Elastic Block Storage), either before or after or in-between the other steps — but you must wait 24 hours since the last run of the script to run it again.</p>
<p>Steps 6.1 to 6.5 are presented using an instance (to become AMI) created from the Cloud-SPAN Genomics AMI which is relatively small: 30 GigaBytes (GB). If you use this AMI as starting point to configure <strong>your own AMIs</strong>, you are more likely to only need to increase storage size — which is good, as reducing storage size is rather complex. <strong>At the end of those steps</strong> you will have a new Genomics AMI with (1) an updated Ubuntu Linux, (2) your new end-user username (instead of the Cloud-SPAN <code>csuser</code>), (3) updated end-user software applications (newer versions of the Genomics applications already installed), and (4) increased secondary storage.</p>
<p>As you are likely to face configuring an ‘instance-to-become-AMI’ that requires <strong>other</strong> (end-user) <strong>software applications</strong>, we will discuss how to update our scripts so that you can automatically install other software applications or delete others in configuring your own AMI. Please click on the bar below for some background to our approach.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Background to our approach to configuring instances-to-become-AMIs.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The Cloud-SPAN project currently manages the Genomics AMI and two Metagenomics AMIs to create instances for four different workshops. Click on the bar below to see the workshops, AMIs, and instance types used in each workshop.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Workshops, AMIs and instance types used
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Workshop</th>
<th>Cloud-SPAN AMI</th>
<th>Intance type — costs as at May 2023</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://cloud-span.github.io/prenomics00-intro/">Prenomics</a></td>
<td>Genomics AMI: 30 GB secondary storage — AWS Free tier is 30 GB-month for 1 year</td>
<td><strong>t3.small</strong>: US $0.0208/hour, 2 processors, 2GB main memory</td>
</tr>
<tr class="even">
<td><a href="https://cloud-span.github.io/00genomics/">Genomics</a></td>
<td>Genomics AMI</td>
<td><strong>t3.small</strong></td>
</tr>
<tr class="odd">
<td><a href="https://cloud-span.github.io/metagenomics00-overview/">Metagenomics</a></td>
<td>Metagenomics AMI with Benchmarking data: 240 GB secondary storage</td>
<td><strong>t3.2xlarge</strong>: US $0.3648/hour, 8 processors, 32 GB main memory</td>
</tr>
<tr class="even">
<td><a href="https://cloud-span.github.io/nerc-metagenomics00-overview/">Metagenomics for Environmental Scientists</a></td>
<td>Metagenomics AMI with Environmental data: 240 GB secondary storage</td>
<td><strong>t3.2xlarge</strong></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We have created about 10 versions of the <strong>Genomics AMI</strong>: updating software, increasing storage size, reducing storage size, etc. The first version was created from the <a href="https://datacarpentry.org/genomics-workshop/index.html#option-a-recommended-using-the-lessons-with-amazon-web-services-aws">Data Carpentry Genomics AMI</a>, updating Linux Ubuntu from version 16.04 to 20.04, and eventually reducing secondary storage from 120 GB to 30 GB.</p>
<p>All Genomics AMIs except the last one were created manually, typing all of the commands needed to update software, etc. We currently manage 3 Genomics AMIs whose configuration is as shown in the bar below.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Genomics AMIs software configuration
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The three Cloud-SPAN Genomics AMIs are all of size 30 GB and configured with the same ’omics data. Their software configuration is shown in the table below. We currently use <code>CS-AMI08b</code> as the template to create instaces for the Prenomics and Genomics workshops.</p>
<p>The difference between <code>CS-AMI08a</code> and <code>CS-AMI08b</code> is that the latter has the Scripts installed, the <code>emacs</code> configuration is visually more user-frienly, and the terminal prompt uses two lines showing the dollar sign in a new line on its own. <code>CS-AMI08c</code> was created to try out the two scripts that update system software and end-user software applications. How to use these scripts is shown later in this section.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 28%">
<col style="width: 24%">
<col style="width: 18%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><code>CS-AMI08a</code> <code>CS-AMI08b</code></th>
<th><code>CS-AMI08c</code></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>SOFTWARE</td>
<td>VERSION</td>
<td>VERSION</td>
<td>DESCRIPTION</td>
</tr>
<tr class="even">
<td>Linux Ubuntu</td>
<td>20.04.4 LTS</td>
<td>20.04.6 LTS</td>
<td></td>
</tr>
<tr class="odd">
<td>bcftools</td>
<td>1.14-3</td>
<td>1.19-18-ge344ee2c</td>
<td>Utilities for variant calling and manipulating VCFs and BCFs.</td>
</tr>
<tr class="even">
<td>bwa</td>
<td>0.7.17-r1188</td>
<td>0.7.17-r1188</td>
<td>Mapping DNA sequences against reference genome.</td>
</tr>
<tr class="odd">
<td>cutadapt</td>
<td>3.5</td>
<td>4.6</td>
<td>Similar to bcftools</td>
</tr>
<tr class="even">
<td>fastqc</td>
<td>0.11.9</td>
<td>0.12.1</td>
<td>Quality control tool for high throughput sequence data.</td>
</tr>
<tr class="odd">
<td>samtools</td>
<td>1.13</td>
<td>1.19-3-g62195d3</td>
<td>Visualization and interactive exploration of large genomics datasets.</td>
</tr>
<tr class="even">
<td>trimmomatic</td>
<td>0.39</td>
<td>0.39</td>
<td>A flexible read trimming tool for Illumina NGS data.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The two <strong>Metagenomics AMIs</strong> have the same software configuration but different data. The first Metagenomics AMI we created is configured with benchmarking data. We first tried to create it manually but, after two attempts, we saw the need to devise some scripts to automate the installing of both system software and end-user software applications. The second Metagenomics AMI is configured with environmental data. It was created from the first Metagenomics AMI: we made a copy of the first one and then and expert in Metagenomics change the data. The end-user software applications of both Metagenomics AMIs include about 25 applications that you are listed in the bar below.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Metagenomics AMIs software configuration
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Both Cloud-SPAN Metagenomics AMIs are of size 240 GB and configured with Linux Ubuntu 20.04.5 and the ’omics software analysis tools below, but are configured with different data.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 34%">
<col style="width: 30%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th>SOFTWARE</th>
<th>VERSION</th>
<th>DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>bwa</td>
<td>0.7.17-r1188</td>
<td>mapping DNA sequences against reference genome.</td>
</tr>
<tr class="even">
<td>checkm</td>
<td>1.2.1</td>
<td>set of tools for assessing the quality of genomes recovered from isolates, single cells, or metagenomes.</td>
</tr>
<tr class="odd">
<td>fastqc</td>
<td>0.11.9</td>
<td>quality control tool for high throughput sequence data.</td>
</tr>
<tr class="even">
<td>flye</td>
<td>2.9.1-b1780</td>
<td>assembler for single molecule sequencing reads, such as those produced by PacBio and Oxford Nanopore Technologies</td>
</tr>
<tr class="odd">
<td>kraken</td>
<td>2.1.2</td>
<td>a system for assigning taxonomic labels to short DNA sequences, usually obtained through metagenomic studies</td>
</tr>
<tr class="even">
<td>kraken-biom</td>
<td>1.0.1</td>
<td>creates BIOM-format tables</td>
</tr>
<tr class="odd">
<td>medaka</td>
<td>1.7.2</td>
<td>a tool to create a consensus sequence from nanopore sequencing data</td>
</tr>
<tr class="even">
<td>metabat2</td>
<td>2:2.15</td>
<td>binning tool to reconstruct single genomes from metagenome assemblies</td>
</tr>
<tr class="odd">
<td>metaquast</td>
<td>5.2.0</td>
<td>evaluates and compares metagenome assemblies based on alignments to close references</td>
</tr>
<tr class="even">
<td>nanoplot</td>
<td>1.40.2</td>
<td>plotting tool for long read sequencing data and alignments</td>
</tr>
<tr class="odd">
<td>pilon</td>
<td>1.24</td>
<td>integrated software tool for comprehensive microbial genome assembly improvement and variant detection</td>
</tr>
<tr class="even">
<td>prokka</td>
<td>1.14.5</td>
<td>software tool to annotate bacterial, archaeal and viral genomes quickly and produce standards-compliant output files</td>
</tr>
<tr class="odd">
<td>samtools</td>
<td>1.16.1-33</td>
<td>Visualization and interactive exploration of large genomics datasets</td>
</tr>
<tr class="even">
<td>seqkit</td>
<td>2.3.0</td>
<td>a cross-platform and ultrafast toolkit for FASTA/Q file manipulation</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Manually creating the first Metagenomics AMI was rather <strong>cumbersome</strong> because many of the applications to install required that some system libraries were first installed, or the applications had to be the latest version, or had to be installed in the end-user account (<code>csuser</code>) and not at system level, etc. Some applications required that other applications were first installed.</p>
<p>The <strong>requirement that some system libraries were first installed</strong>, meant that we first updated the system and then install the libraries with the <code>ubuntu</code> user (account), which has admin privileges, and then install the relevant application in the <code>csuser</code> account (it is rather convenient to install applications locally in the <code>csuser</code> account as you have full control as to where to install them and hence to remove them). So we were switching between these user accounts for each application that required system libraries installed, entering again all the commans for the applications that had already been successfully installed and then start trying to install the next application. Just unmanageable!</p>
<p>Thus we thought of two scripts to automate the installing. One script, run by the <code>ubuntu</code> user, would update the system first, then install all the system libraries required by the applications so far successfully installed, and finally update the system again. The other script, run by the <code>csuser</code>, would install all the applications so far successfully installed, etc. Once we had run the scripts, we would attempt to install the next application, updating the scripts accordingly, sometimes creating an intermediate AMI before continuing installing applications so we could roll back if we encounter difficult problems.</p>
<p>These are the scripts we have created in the order we created them:</p>
<ul>
<li><code>softwareInstall_metagen_ubuntu1v.sh</code></li>
<li><code>softwareInstall_metagen_csuser1v.sh</code></li>
<li><code>softwareInstall_metagen_ubuntu2v.s</code></li>
<li><code>softwareInstall_metagen_csuser2v.sh</code></li>
<li><code>softwareInstall_genomics_ubuntusr.sh</code></li>
<li><code>softwareInstall_genomics_csuser.sh</code></li>
</ul>
<p>You are to run these scripts in pairs, on an ‘instance-to-become-AMI’ created from the Genomics AMI CS-AMI08b, where all those scripts are installed along with the Scripts you used in the last episode to create and manage instances.</p>
<p>Only the last two scripts, <code>softwareInstall_genomics_ubuntusr.sh</code> and <code>softwareInstall_genomics_csuser.sh</code>, once you run them as described later in this section, will get you a new Genomics AMI with the latest versions of the Genomics applications installed.</p>
<p>The scripts <code>softwareInstall_metagen*.sh</code>, both versions <code>1v</code> and <code>2v</code>, will run successfully but <strong>will not get you</strong> a Metagenomics AMI <strong>with the proper configuration</strong> because such configuration involved a few experts in Metagenomics whose work is not incorporated in the scripts. The first Metagenomics AMI was created as follows. Once we successfully ran the first versions <code>1v</code> of the scripts, we handed in an instance to the experts in Metagenomics who designed and were in charge of delivering the corresponding course. They configured some applications further to use some specific databases which they also installed. The instance size was increased up to 500 GB, among other tuning and network configuration. Once the experts were happy with the instance configuration, the instance was given back to us with the requirements that the AMI should be of size 240 GB and some applications should be removed as they were no longer needed — they were only needed to generate some data. The <code>2v</code> versions of the scripts do not install these applications. After we handed in a new instance with the “final” configuration, while running some applications, it was realised that more changes were needed. These were the last changes. We then created the first Metagenomics AMI, and from this the second Metagenomics AMI whose data was also configured by another expert in Metagenomics.</p>
</div>
</div>
</div>
<section id="create-and-login-to-your-instance-to-become-ami-that-you-will-configure" class="level3">
<h3 class="anchored" data-anchor-id="create-and-login-to-your-instance-to-become-ami-that-you-will-configure">Create and login to your ‘instance-to-become-AMI’ that you will configure</h3>
<p>To create your ‘instance-to-become-AMI’, first <strong>create the file-directory structure</strong> as you did above in Section 1, that is: within the <strong>amis</strong> directory, create a new ami directory, and inside the <strong>inputs</strong> directory with the Scripts configuration files — you can use the commands below (where our new ami directory is <strong>ami02-myFirstAMIConfig</strong> and you are assumed to be in your home directory <code>~</code> — you can choose another name but you won’t be able to copy-paste the code below):</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb11" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@cloud-span-admin-instance:~</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mkdir <span class="at">-p</span> amis/ami02-myFirstAMIConfig/inputs</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cp courses/instances-management/inputs/<span class="pp">*</span> amis/ami02-myFirstAMIConfig/inputs/</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls amis/ami02-myFirstAMIConfig/inputs</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ex">instancesNames.txt</span>  resourcesIDs.txt  tags.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now you need to <strong>edit</strong> the file <strong>instancesNames.txt</strong> to have only the name of your ‘instance-to-become-AMI’. The name of our instance is: <em>instanceToBecomeAMI02-Jorge-srcCS-AMI08b</em>.</p>
<p>If you are attending a workshop <strong>using a Cloud-SPAN AWS account</strong>, please use a similar name but change “Jorge” for your name or surname so your instance can be distinguished from other participants’ instance in our AWS Console.</p>
<p><strong>Create your ‘instance-to-become-AMI’</strong>:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb12" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@cloud-span-admin-instance:~</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> csinstances_create.sh amis/ami02-myFirstAMIConfig/inputs/instancesNames.txt </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wait a 2-3 minutes .. then:</p>
<p><strong>Login to your ‘instance-to-become-AMI’</strong> using the Cloud-SPAN script <code>lginstance.sh</code> as shown in the code below, passing as parameters (1) the path of the login key file of your instance and (2) <code>ubuntu</code> as the username to login:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb13" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@cloud-span-admin-instance:~</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> lginstance.sh amis/ami02-myFirstAMIConfig/outputs/login-keys/login-key-instanceToBecomeAMI02-Jorge.pem ubuntu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
How <code>lginstance.sh</code> works:
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>lginstance.sh</code> was installed along with the Scripts on your computer — it is already installed on your AWS instance if you are attending a workshop using a Cloud-SPAN AWS account. <strong>Run</strong> <code>lginstance.sh</code> with no parameters to see its usage message.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb14" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> lginstance.sh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb15" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">lginstance.sh</span> logs you in to an <span class="er">(</span><span class="ex">AWS</span><span class="kw">)</span> <span class="ex">instance</span> using ssh.</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="ex">usage:</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">lginstance.sh</span>  login-key-instanceName.pem  csuser/ubuntu/yourusername</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> login-key-instanceName.pem is the name <span class="er">(</span><span class="ex">path</span><span class="kw">)</span> <span class="ex">of</span> the file containing the RSA login key</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="ex">to</span> access the instance.</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> the name of the instance to log you in is extracted from the name of the .pem file provided.</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> the domain name is extracted from the inputs/resourcesIDs.txt file.</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> Examples:</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="ex">lginstance.sh</span> courses/genomics01/outputs/login-keys/login-key-instance017.pem  csuser</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="ex">lginstance.sh</span> courses/genomics01/outputs/login-keys/login-key-instance017.pem  ubuntu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use the <code>Tab</code> key to complete <code>lginstance.sh</code> <strong>and</strong> the file path of the login key — <strong>but</strong> you need to type the <strong>username</strong> in full.</p>
<p>For the command below you only need to type: “lg<code>Tab</code>a<code>Tab``Tab</code>2<code>Tab</code>o<code>Tab</code>l<code>Tab</code>/<code>Tab</code>ubuntu<code>Enter</code>”:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb16" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> lginstance.sh amis/ami02-myFirstRealAMI/outputs/login-keys/login-key-instanceToBecomeAMI02-Jorge.pem ubuntu</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">lgTab</span>         aTabTab  2Tab             oTab    lTab      /Tab                                       ubuntuEnter</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Once you are logged in, you will see the Cloud-SPAN welcome message and your terminal prompt will have changed to something like this:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb17" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The prompt of the <code>ubuntu</code> user is configured to show the entire instance domain name, while the prompt of the <code>csuser</code> to show only the instance name.</p>
<p>If you are attending a workshop <strong>using a Cloud-SPAN AWS account</strong> and an AWS instance, then you just have used the program <code>ssh</code> twice in a chain: to login from your personal computer to your workshop-assigned instance, and from the latter to your ‘instance-to-become-AMI’.</p>
</section>
<section id="updating-system-software" class="level2">
<h2 class="anchored" data-anchor-id="updating-system-software">6.1 Updating system software</h2>
<p>The Linux version installed in the ‘instance-to-become-AMI’ that you are about to configure is <strong>Ubuntu 20.04.4 LTS</strong>. LTS stands for Long Term Support version. “<em>Updating system software</em>” for an LTS version can mean either <strong>updating</strong> the LTS version with bugs and security patches (that address errors or security vulnerabilities), or <strong>updating</strong> the LTS version to the next LTS version if available, or <strong>both</strong>. We will use the term “<em>updating system software</em>” for the first meaning, and the term “<em>updating to the next LTS</em>” for the second meaning.</p>
<p>We are going to do the following:</p>
<ul>
<li><strong>updating to the next LTS</strong> typing each of the commands typically used to update any Ubuntu version to the next LTS, see the bar “Ubuntu LTS versions” below</li>
<li><strong>updating system software</strong> running our script <code>softwareInstall_genomics_ubuntusr.sh</code>, which performs typical “updating system software” <strong>in addition to</strong> installing the <strong>system libraries required</strong> by the Genomics end-user software applications already installed in the ‘instance-to-become-AMI’. Updating system software (with <code>softwareInstall_genomics_ubuntusr.sh</code>) can be performed without updating to the next LTS — we have tried this out only with the Genomics AMI.</li>
<li>discussing the way to <strong>installing and removing end-user software applications - first part</strong>, which must be performed with the <code>ubuntu</code> user — a <strong>second part</strong>, which must be performed with the <code>csuser</code> or the new user you create (in step 6.2), is discussed in step 6.3 “Updating end-user software applications”.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ubuntu LTS versions
</div>
</div>
<div class="callout-body-container callout-body">
<p>LTS versions provide users with software stability for a relatively long period. LTS versions are released every two years on April and receive support through security and bugs patches for up to five years or more — you may be interested in the following:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Ubuntu_version_history">Ubuntu version history</a></li>
<li><a href="https://en.wikipedia.org/wiki/Long-term_support">Long-term support</a></li>
<li><a href="https://ubuntu.com/about/release-cycle">The Ubuntu lifecycle and release cadence</a></li>
</ul>
<p>Updating LTS versions is explained in <a href="https://www.digitalocean.com/community/tutorials/how-to-upgrade-to-ubuntu-22-04-jammy-jellyfish">How To Upgrade to Ubuntu 22.04 Jammy Jellyfish</a></p>
</div>
</div>
<section id="updating-to-the-next-lts" class="level3">
<h3 class="anchored" data-anchor-id="updating-to-the-next-lts">Updating to the next LTS</h3>
<p>You are logged in as the <code>ubuntu</code> user on your ‘instance-to-become-AMI’. You will enter the following commands one by one: - <code>sudo apt-get update</code> - <code>apt-get upgrade -y</code> - <code>sudo apt-get dist-upgrade</code> - <code>sudo apt autoremove</code> - <code>sudo do-release-upgrade</code></p>
<p>Some of these commands print a lot of output as they run. We will only show the most relevant output within a drop-down bar labelled: “Output — command”. We have added comments to some output and commands, like this one: <code>### comment on output/command</code>. You still can copy-paste the commands as the comments will be ignored by the shell.</p>
<p><strong>The first command</strong>, <code>sudo apt-get update</code>, updates the list of installed packages with new updates for each package if any. Enter the command and wait until the prompt appears again to enter the next command.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb18" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo apt-get update                 <span class="co">### updates packages list of installed packages</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Output - sudo apt-get-update
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb19" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo apt-get update                 <span class="co">### updates packages list of installed packages</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Hit:1</span> http://eu-west-1.ec2.archive.ubuntu.com/ubuntu focal InRelease</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Hit:2</span> http://eu-west-1.ec2.archive.ubuntu.com/ubuntu focal-updates InRelease</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Hit:3</span> http://eu-west-1.ec2.archive.ubuntu.com/ubuntu focal-backports InRelease</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Get:4</span> https://esm.ubuntu.com/infra/ubuntu focal-infra-security InRelease [7,450 B]</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Get:5</span> https://esm.ubuntu.com/infra/ubuntu focal-infra-updates InRelease [7,449 B]</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Get:6</span> http://security.ubuntu.com/ubuntu focal-security InRelease [114 kB]</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Fetched</span> 129 kB in 3s <span class="er">(</span><span class="ex">44.4</span> kB/s<span class="kw">)</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Reading</span> package lists... Done</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p><strong>The second command</strong>, <code>sudo apt-get upgrade -y</code>, applies the updates: upgrades the packages. The option <code>-y</code> stands for yes to any question regarding applying the udpates, so you don’t have to enter <code>y</code> and Enter to each question; the upgrade just runs to the end. This command may take over 5 minutes to complete.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb20" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo apt-get upgrade <span class="at">-y</span>             <span class="co">### applies updates: upgrades the installed packages</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Output - sudo apt-get-update -y
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb21" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo apt-get upgrade <span class="at">-y</span>            <span class="co">### applies updates: upgrades the installed packages</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Reading</span> package lists... Done</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Building</span> dependency tree</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Reading</span> state information... Done</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Calculating</span> upgrade... Done</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="ex">..</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> following packages have been kept back:</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="ex">fwupd</span> libfwupd2 libfwupdplugin5 linux-generic linux-headers-generic linux-headers-virtual linux-image-generic</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="ex">linux-image-virtual</span> linux-virtual python3-software-properties software-properties-common software-properties-gtk</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="ex">ubuntu-advantage-tools</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> following packages will be upgraded:</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="ex">accountsservice</span> amd64-microcode apache2-bin apparmor apport apport-gtk apt apt-transport-https apt-utils</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span>                                                     <span class="co">### loads of output</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Processing</span> triggers for libgdk-pixbuf2.0-0:amd64 <span class="er">(</span><span class="ex">2.40.0+dfsg-3ubuntu0.4</span><span class="kw">)</span> <span class="ex">...</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="ex">Processing</span> triggers for dbus <span class="er">(</span><span class="ex">1.12.16-2ubuntu2.3</span><span class="kw">)</span> <span class="ex">...</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="ex">Processing</span> triggers for initramfs-tools <span class="er">(</span><span class="ex">0.136ubuntu6.7</span><span class="kw">)</span> <span class="ex">...</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="ex">update-initramfs:</span> Generating /boot/initrd.img-5.4.0-109-generic</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="ex">Processing</span> triggers for libc-bin <span class="er">(</span><span class="ex">2.31-0ubuntu9.14</span><span class="kw">)</span> <span class="ex">...</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p><strong>The third command</strong>, <code>sudo apt-get dist-upgrade</code>, performs “any additional upgrades that involve changing dependencies, adding or removing new packages as necessary. This will handle a set of upgrades which may have been held back by the previous apt upgrade step”.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb22" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo apt-get dist-upgrade</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Output - sudo apt-get-dist-update
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb23" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo apt-get dist-upgrade</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Reading</span> package lists... Done</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> following packages were automatically installed and are no longer required:</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">gir1.2-goa-1.0</span> libxmlb1</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Use</span> <span class="st">'sudo apt autoremove'</span> to remove them.                          <span class="co">### this is the reason for the fourth command</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Ubuntu</span> comes with ABSOLUTELY NO WARRANTY, to the extent permitted by</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="ex">applicable</span> law.</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> following NEW packages will be installed:</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="ex">libxmlb2</span> linux-headers-5.4.0-169 linux-headers-5.4.0-169-generic linux-image-5.4.0-169-generic</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> following packages will be upgraded:</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="ex">fwupd</span> libfwupd2 libfwupdplugin5 linux-generic linux-headers-generic linux-headers-virtual linux-image-generic</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="ex">linux-image-virtual</span> linux-virtual python3-software-properties software-properties-common software-properties-gtk</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="ex">ubuntu-advantage-tools</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="ex">13</span> upgraded, 8 newly installed, 0 to remove and 0 not upgraded.</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span> standard security updates</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="ex">Need</span> to get 80.2 MB of archives.</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="ex">After</span> this operation, 379 MB of additional disk space will be used.</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="ex">Do</span> you want to continue<span class="pp">?</span> <span class="pp">[</span><span class="ss">Y/n</span><span class="pp">]</span>                                      <span class="co">### type y and press Enter</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="ex">Get:1</span> http://eu-west-1.ec2.archive.ubuntu.com/ubuntu focal-updates/main amd64 ubuntu-advantage-tools amd64 30~20.04 [203 kB]</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="ex">Found</span> memtest86+ image: /boot/memtest86+.elf</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="ex">Found</span> memtest86+ image: /boot/memtest86+.bin</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p><strong>The fourth command</strong>, <code>sudo apt autoremove</code>, removes packages no longer used.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb24" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo apt autoremove</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Output - sudo aptautoremove
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb25" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo apt autoremove</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Reading</span> package lists... Done</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="ex">..</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> following packages will be REMOVED:</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">gir1.2-goa-1.0</span> libxmlb1 linux-headers-5.4.0-104 linux-headers-5.4.0-104-generic linux-image-5.4.0-104-generic</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">linux-modules-5.4.0-104-generic</span> linux-modules-extra-5.4.0-104-generic</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span> upgraded, 0 newly installed, 7 to remove and 0 not upgraded.</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="ex">After</span> this operation, 380 MB disk space will be freed.</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Do</span> you want to continue<span class="pp">?</span> <span class="pp">[</span><span class="ss">Y/n</span><span class="pp">]</span>                                            <span class="co">### type y and press Enter</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">Reading</span> database ... 267814 files and directories currently installed.<span class="kw">)</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="ex">Removing</span> gir1.2-goa-1.0:amd64 <span class="er">(</span><span class="ex">3.36.1-0ubuntu1</span><span class="kw">)</span> <span class="ex">...</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="ex">Removing</span> libxmlb1:amd64 <span class="er">(</span><span class="ex">0.1.15-2ubuntu1~20.04.1</span><span class="kw">)</span> <span class="ex">...</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Progress:</span> [ 67%] <span class="pp">[</span><span class="ss">###############################################################................................</span><span class="pp">]</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="ex">Removing</span> linux-modules-5.4.0-104-generic <span class="er">(</span><span class="ex">5.4.0-104.118</span><span class="kw">)</span> <span class="ex">...</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="ex">Processing</span> triggers for libc-bin <span class="er">(</span><span class="ex">2.31-0ubuntu9.14</span><span class="kw">)</span> <span class="ex">...</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p><strong>The fifth command</strong>, <code>sudo do-release-upgrade</code>, carries out the actual update to the next LTS release (version). <strong>But before</strong> entering the command, you need to reboot the system as otherwise you will receive the message: “<em>You have not rebooted after updating a package which requires a reboot. Please reboot before upgrading.</em>”</p>
<p>To reboot the system, enter the command <code>sudo shutdown --reboot now</code>, see the bar below. After 2 minutes login again with <code>lginstance.sh ... ubuntu</code> (press the UP arrow key to recall the command from the terminal history).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reboot the system and ignore the “ERROR: cloud not login …”
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb26" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo shutdown <span class="at">--reboot</span> now</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once you have entered the shutdown command you are going to see output below. Ignore the ERROR message. It pops up when the <code>ssh</code> connection is aborted out of shooting down the system as opposed to ending the connection normally — <code>lginstance.sh</code> checks that a connection ends normally and if it doesn’t, displays the error below and its usage message.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb27" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> Connection to instancetobecomeami02-jorge.cloud-span.aws.york.ac.uk closed by remote host.</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Connection</span> to instancetobecomeami02-jorge.cloud-span.aws.york.ac.uk closed.</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="ex">ERROR:</span> could not login, check the username ubuntu is correct <span class="at">-</span> try with  <span class="st">"ubuntu"</span> <span class="er">(</span><span class="ex">with</span> no quotes<span class="kw">)</span><span class="bu">.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="ex">----------------------------------------------</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="ex">lginstance.sh</span> logs you in to an <span class="er">(</span><span class="ex">AWS</span><span class="kw">)</span> <span class="ex">instance</span> using ssh.</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="ex">usage:</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">lginstance.sh</span>  login-key-instanceName.pem  csuser/ubuntu/yourusername</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> login-key-instanceName.pem is the name <span class="er">(</span><span class="ex">path</span><span class="kw">)</span> <span class="ex">of</span> the file containing the RSA login key</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="ex">to</span> access the instance.</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> the name of the instance to log you in is extracted from the name of the .pem file provided.</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> the domain name is extracted from the inputs/resourcesIDs.txt file.</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> Examples:</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="ex">lginstance.sh</span> courses/genomics01/outputs/login-keys/login-key-instance017.pem  csuser</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  <span class="ex">lginstance.sh</span> courses/genomics01/outputs/login-keys/login-key-instance017.pem  ubuntu</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@cloud-span-admin-instance:~</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>The command <code>sudo do-release-upgrade</code> will take about 1 hour to upgrade the system, and throughout <strong>you will see a few questions for which you need to</strong> type <code>y</code> and press <code>Enter</code> or just press <code>Enter</code> for the upgrade to continue, see our comments (### …) inside the bar “Output — sudo do-release-upgrade” below. The last question is for the system to be restarted (rebooted), see our last comments inside the bar. Please enter the command:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb28" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo do-release-upgrade</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Output - sudo do-release-upgrade
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb29" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Checking</span> for a new Ubuntu release</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span>                                                 <span class="co">### the screen will be cleared and started new </span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Reading</span> cache</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Checking</span> package manager</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Continue</span> running under SSH<span class="pp">?</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="ex">This</span> session appears to be running under ssh. It is not recommended</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="ex">to</span> perform a upgrade over ssh currently because in case of failure it</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="ex">is</span> harder to recover.</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="ex">If</span> you continue, an additional ssh daemon will be started at port</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="st">'1022'</span><span class="ex">.</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Do</span> you want to continue<span class="pp">?</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="ex">Continue</span> <span class="pp">[</span><span class="ss">yN</span><span class="pp">]</span>y                                      <span class="co">### type y and press Enter</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="ex">/etc/ssh/sshd_config</span> line 16: Deprecated option UsePrivilegeSeparation</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="ex">Starting</span> additional sshd</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="ex">To</span> make recovery in case of failure easier, an additional sshd will</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="ex">be</span> started on port <span class="st">'1022'</span>. If anything goes wrong with the running</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> you can still connect to the additional one.</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="ex">To</span> continue please press <span class="pp">[</span><span class="ss">ENTER</span><span class="pp">]</span>                    <span class="co">### press Enter</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="ex">Reading</span> package lists... Done</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a><span class="ex">Do</span> you want to start the upgrade<span class="pp">?</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a><span class="ex">18</span> installed packages are no longer supported by Canonical. You can</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a><span class="ex">still</span> get support from the community.</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a><span class="ex">26</span> packages are going to be removed. 307 new packages are going to be</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a><span class="ex">installed.</span> 1987 packages are going to be upgraded.</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a><span class="ex">You</span> have to download a total of 1,951 M. This download will take</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a><span class="ex">about</span> 4 minutes with your connection.</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a><span class="ex">Installing</span> the upgrade can take several hours. Once the download has</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a><span class="ex">finished,</span> the process cannot be canceled.</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a> <span class="ex">Continue</span> <span class="pp">[</span><span class="ss">yN</span><span class="pp">]</span>  Details <span class="pp">[</span><span class="ss">d</span><span class="pp">]</span>                         <span class="co">### type y and press Enter</span></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span>                                                 <span class="co">### loads of text output will follow</span></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>                <span class="co">### and then 3 or 4 screenshots like the one below will be displayed</span></span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>                <span class="co">### just press Enter to agree with the option shown - do not change anything</span></span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>                <span class="co">### once you press Enter to each screenshot, a lot of tex output will follow</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/03-amis-management/12-ubuntu-release-updagre-screen-option01-msql.png" class="img-fluid figure-img" alt="Screenshot of ubuntu release upgrading option to accept" width="600"></p>
<figcaption>.</figcaption>
</figure>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb30" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Remove</span> obsolete packages<span class="pp">?</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="ex">180</span> packages are going to be removed.</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Removing</span> the packages can take several hours.</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Continue</span> <span class="pp">[</span><span class="ss">yN</span><span class="pp">]</span>  Details <span class="pp">[</span><span class="ss">d</span><span class="pp">]</span>                        <span class="co">### type y and press Enter</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="ex">..</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="ex">System</span> upgrade is complete.</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Restart</span> required</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="ex">To</span> finish the upgrade, a restart is required.</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="ex">If</span> you select <span class="st">'y'</span> the system will be restarted.</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Continue</span> <span class="pp">[</span><span class="ss">yN</span><span class="pp">]</span>                                     <span class="co">### type y and press Enter - you will be logged out </span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>                                                    <span class="co">### as when you rebooted the system</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>                                                    <span class="co">### wait 2 minutes and login again with "lginstance.sh ... ubuntu"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Once the system is restarted (1-2 minutes), login again with the command <code>lginstance.sh .. ubuntu</code>. When the Cloud-SPAN message appears, scroll up the screen with your mouse to see the new LTS version installed <strong>Ubuntu 22.04.3 LTS</strong>, see the output below. If the screen does not scroll up (it happens sometimes after rebooting the system), logout, open a new terminal, and login again.</p>
<p>The output below also shows two messages about updates: - “0 updates can be applied immediately” - “14 additional security updates can be applied with ESM Apps.”</p>
<p>The number of “additional security updates” you see may be different, as it depends on when you update the system. Cloud-SPAN is not interested in the “additional security updates ..” as it seems these updates need to be paid for. Follow the link below the second message if you are interested.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb31" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Welcome</span> to Ubuntu 22.04.3 LTS <span class="er">(</span><span class="ex">GNU/Linux</span> 5.15.0-91-generic x86_64<span class="kw">)</span>           <span class="co">### new version</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Expanded</span> Security Maintenance for Applications is not enabled.</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span> updates can be applied immediately.                                        <span class="co">### no updates</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="ex">14</span> additional security updates can be applied with ESM Apps.                 <span class="co">### other updates?</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Learn</span> more about enabling ESM Apps service at https://ubuntu.com/esm</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">W</span> E L C O M E    T O    T H E</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>     <span class="ex">____</span> _                 _         ______ _____   _    __   _</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">/</span> ___<span class="kw">|</span> <span class="kw">|</span> <span class="ex">___</span>  _   _  __<span class="kw">|</span> <span class="kw">|</span>       <span class="ex">/</span> ____ <span class="kw">|</span>  <span class="ex">_</span>  <span class="dt">\ </span>/ <span class="dt">\ </span> <span class="kw">|</span>  <span class="ex">\ </span><span class="kw">|</span> <span class="kw">|</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>   <span class="kw">|</span> <span class="kw">|</span>   <span class="kw">|</span> <span class="kw">|</span><span class="ex">/</span> _ <span class="dt">\|</span> <span class="kw">|</span> <span class="kw">|</span> <span class="kw">|</span><span class="ex">/</span> _<span class="kw">`</span> <span class="kw">|</span>  <span class="ex">___</span>  <span class="dt">\_</span>__  <span class="dt">\|</span> <span class="kw">|</span><span class="ex">_</span><span class="er">)</span> <span class="st">'/ _ \ | \ \| |</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="st">   | |___| | (_) | |_| | (_| | |___| ____)  |  __ / ___ \| |\ | |</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="st">    \____|_|\___/ \___/ \__,_|       \_____/|_|  /_/   \_|_| \__|</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="updating-system-software-1" class="level3">
<h3 class="anchored" data-anchor-id="updating-system-software-1">Updating system software</h3>
<p>Updating system software is carried out by running the script <code>softwareInstall_genomics_ubuntusr.sh</code>, which also installs the system libraries required by the Genomics end-user software applications installed in the ‘instance-to-become-AMI’.</p>
<p>You are logged in as the <code>ubuntu</code> user on your ‘instance-to-become-AMI’. Run <code>softwareInstall_genomics_ubuntusr.sh</code> as shown below:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb32" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> softwareInstall_genomics_ubuntusr.sh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb33" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">softwareInstall_genomics_ubuntusr.sh</span> upgrades and configures the Ubuntu system.</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="ex">This</span> script must be run before running the script that installs the genomics software analysis</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="ex">tools</span> <span class="er">(</span><span class="ex">softwareInstall_genomics_csuser.sh</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">the</span> csuser account.</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Do</span> you want to continue <span class="er">(</span><span class="ex">y/n</span><span class="kw">)</span><span class="ex">?:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The message in the output above will be explained shortly.</p>
<p>You only need to type <code>y</code> for the script to start running. See the output of the script in the bar below where our comments (###) highlight the main commands issued by the script.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Output — softwareInstall_genomics_ubuntusr.sh
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb34" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Do</span> you want to continue <span class="er">(</span><span class="ex">y/n</span><span class="kw">)</span><span class="ex">?:</span> y</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Creating</span> directory logs</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">y</span><span class="kw">)</span><span class="bu">:</span> Configuring and upgrading system. Please wait:</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Saving</span> installation logs to file:</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="ex">logs/genomics_sftwre_install_ubuntuuser.sh20240119.154518.txt</span>          <span class="co">### logs file, see with less -R filename</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Hit:1</span> http://eu-west-1.ec2.archive.ubuntu.com/ubuntu jammy InRelease</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Get:2</span> http://eu-west-1.ec2.archive.ubuntu.com/ubuntu jammy-updates InRelease [119 kB]</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Get:8</span> https://esm.ubuntu.com/infra/ubuntu jammy-infra-updates InRelease [7,449 B]</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="ex">Fetched</span> 2,558 kB in 1s <span class="er">(</span><span class="ex">2,470</span> kB/s<span class="kw">)</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="ex">Reading</span> package lists...</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get upgrade                                                   <span class="co">### install library</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Reading</span> package lists...</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="ex">Calculating</span> upgrade...</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span> upgraded, 0 newly installed, 0 to remove and 0 not upgraded.</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get install libssl-dev                                        <span class="co">### install library</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="ex">Reading</span> package lists...</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="ex">Suggested</span> packages:</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="ex">libssl-doc</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> following NEW packages will be installed:</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>  <span class="ex">libssl-dev</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span> upgraded, 1 newly installed, 0 to remove and 0 not upgraded.</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a><span class="ex">Need</span> to get 2,373 kB of archives.</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a><span class="ex">After</span> this operation, 12.4 MB of additional disk space will be used.</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="ex">Get:1</span> http://eu-west-1.ec2.archive.ubuntu.com/ubuntu jammy-updates/main amd64 libssl-dev amd64 3.0.2-0ubuntu1.12 [2,373 kB]</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="ex">Fetched</span> 2,373 kB in 0s <span class="er">(</span><span class="ex">34.4</span> MB/s<span class="kw">)</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get install libncurses5-dev                                   <span class="co">### install library</span></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a><span class="ex">Reading</span> package lists...</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> following additional packages will be installed:</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get install <span class="at">-y</span> autoconf automake make gcc perl zlib1g-dev libbz2-dev liblzma-dev libcurl4-gnutls-dev libssl-dev libperl-dev libgsl0-dev                                                    <span class="co">### install library</span></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a><span class="ex">Reading</span> package lists...</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a><span class="ex">Use</span> <span class="st">'sudo apt autoremove'</span> to remove it.                                <span class="co">### sudo apt autoremove</span></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> following additional packages will be installed:</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>  <span class="ex">autotools-dev</span> libgsl27 libgslcblas0 m4</span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a><span class="ex">Suggested</span> packages:</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get install python3-pip                                       <span class="co">### install library</span></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a><span class="ex">Reading</span> package lists...</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> following package was automatically installed and is no longer required:</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>  <span class="ex">libcurl3-nss</span></span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a><span class="ex">Use</span> <span class="st">'sudo apt autoremove'</span> to remove it.                                <span class="co">### sudo apt autoremove</span></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> following additional packages will be installed:</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get install docker.io                                         <span class="co">### install library</span></span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a><span class="ex">Use</span> <span class="st">'sudo apt autoremove'</span> to remove it.                                <span class="co">### sudo apt autoremove </span></span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> following additional packages will be installed:</span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> groupadd docker                                                   <span class="co">### install library</span></span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a><span class="ex">groupadd:</span> group <span class="st">'docker'</span> already exists</span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> usermod <span class="at">-aG</span> docker csuser                                         <span class="co">### install library</span></span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get update                                                    <span class="co">### </span></span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get upgrade                                                   <span class="co">###</span></span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> following package was automatically installed and is no longer required:</span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a>  <span class="ex">libcurl3-nss</span></span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a><span class="ex">Use</span> <span class="st">'sudo apt autoremove'</span> to remove it.                                <span class="co">### sudo apt autoremove  is needed</span></span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span> upgraded, 0 newly installed, 0 to remove and 0 not upgraded.</span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a><span class="ex">---------------------</span></span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a><span class="ex">DONE</span> system-wide setting and upgrade for csuser to install genomics software.</span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a><span class="ex">CHECK</span> the log file logs/genomics_sftwre_install_ubuntuuser.sh20240119.154518.txt.</span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a><span class="ex">You</span> need to reboot the system <span class="er">(</span><span class="fu">sudo</span> shutdown <span class="at">--reboot</span> now<span class="kw">)</span><span class="ex">,</span> login again, and</span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a><span class="ex">check</span> the Ubuntu system message above the Cloud-SPAN message. If the system message says that</span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a><span class="ex">some</span> <span class="st">"updates can be applied immediately"</span>, run this command:</span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get <span class="at">--with-new-pkgs</span> upgrade <span class="at">--yes</span>                             <span class="co">### may also be needed</span></span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true" tabindex="-1"></a><span class="ex">You</span> may need to reboot, login again  and run the above command a few times until the system</span>
<span id="cb34-78"><a href="#cb34-78" aria-hidden="true" tabindex="-1"></a><span class="ex">message</span> reads <span class="st">"0 updates can be applied immediately"</span> <span class="at">-</span> you may want to make a not the command</span>
<span id="cb34-79"><a href="#cb34-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-80"><a href="#cb34-80" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb34-81"><a href="#cb34-81" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>At the end, the output of the script suggests that we run: - <code>sudo apt autoremove</code> and - <code>sudo apt-get --with-new-pkgs upgrade --yes</code> if, after rebooting the system, you find that the system welcome message says that some (1 or more) “updates can be applied immediately”, and that we reboot the system and run that command again until that message reads “0 updates can be applied immediately”.</p>
<p>Let’s run <code>sudo apt autoremove</code> first (before rebooting the system):</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb35" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo apt autoremove</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb36" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Do</span> you want to continue<span class="pp">?</span> <span class="pp">[</span><span class="ss">Y/n</span><span class="pp">]</span> y</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">Reading</span> database ... 223713 files and directories currently installed.<span class="kw">)</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Removing</span> libcurl3-nss:amd64 <span class="er">(</span><span class="ex">7.81.0-1ubuntu1.15</span><span class="kw">)</span> <span class="ex">...</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Processing</span> triggers for libc-bin <span class="er">(</span><span class="ex">2.35-0ubuntu3.5</span><span class="kw">)</span> <span class="ex">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s now reboot the system (and ignore the message “ERROR: could not ..” as before):</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb37" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo shutdown <span class="at">--reboot</span> now</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb38" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> Connection to instancetobecomeami02-jorge.cloud-span.aws.york.ac.uk closed by remote host.</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Connection</span> to instancetobecomeami02-jorge.cloud-span.aws.york.ac.uk closed.</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="ex">ERROR:</span> could not login, check the username ubuntu is correct <span class="at">-</span> try with  <span class="st">"ubuntu"</span> <span class="er">(</span><span class="ex">with</span> no quotes<span class="kw">)</span><span class="bu">.</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Login again with <code>lginstance.sh ... ubuntu</code> after 2 minutes or so, scroll up the screen with the mouse right button and check whether the system welcome message says that some (1 or more) “updates can be applied immediately”. If that is the case, (1) run the command <code>sudo apt-get --with-new-pkgs upgrade --yes</code>, (2) reboot the system, (3) login again, and (4) check that message again. Repeat those four steps until that message reads “0 updates can be applied immediately”.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb39" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Welcome</span> to Ubuntu 22.04.3 LTS <span class="er">(</span><span class="ex">GNU/Linux</span> 5.15.0-91-generic x86_64<span class="kw">)</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Expanded</span> Security Maintenance for Applications is not enabled.</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span> updates can be applied immediately.      <span class="co">### should be zero otherwise run: sudo apt-get --with-new-pkgs upgrade --yes</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="ex">17</span> additional security updates can be applied with ESM Apps.</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">W</span> E L C O M E    T O    T H E</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>     <span class="ex">____</span> _                 _         ______ _____   _    __   _</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">/</span> ___<span class="kw">|</span> <span class="kw">|</span> <span class="ex">___</span>  _   _  __<span class="kw">|</span> <span class="kw">|</span>       <span class="ex">/</span> ____ <span class="kw">|</span>  <span class="ex">_</span>  <span class="dt">\ </span>/ <span class="dt">\ </span> <span class="kw">|</span>  <span class="ex">\ </span><span class="kw">|</span> <span class="kw">|</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>   <span class="kw">|</span> <span class="kw">|</span>   <span class="kw">|</span> <span class="kw">|</span><span class="ex">/</span> _ <span class="dt">\|</span> <span class="kw">|</span> <span class="kw">|</span> <span class="kw">|</span><span class="ex">/</span> _<span class="kw">`</span> <span class="kw">|</span>  <span class="ex">___</span>  <span class="dt">\_</span>__  <span class="dt">\|</span> <span class="kw">|</span><span class="ex">_</span><span class="er">)</span> <span class="st">'/ _ \ | \ \| |</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="st">   | |___| | (_) | |_| | (_| | |___| ____)  |  __ / ___ \| |\ | |</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="st">    \____|_|\___/ \___/ \__,_|       \_____/|_|  /_/   \_|_| \__|</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="installing-other-applications-and-removing-applications-first-part" class="level3">
<h3 class="anchored" data-anchor-id="installing-other-applications-and-removing-applications-first-part">Installing other applications and removing applications — first part</h3>
<p>Recall that the script <code>softwareInstall_genomics_ubuntusr.sh</code> (run in the previous section) carries out both updating system software and <strong>installing the system libraries required by the Genomics software applications</strong> already installed in your ‘instance-to-become-AMI’.</p>
<p>As such, if you are to install other (not yet installed Genomics or other kind of) applications that require installing system libraries under our approach, <strong>you will need to modify</strong> that script, adding to it the corresponding <code>sudo</code> commands that install the required system libraries. Doing so as in the example below corresponds to the <strong>first part</strong> of installing other applications (alluded in the heading above). The <strong>second part</strong> corresponds to modifying the script <code>softwareInstall_genomics_csuser.sh</code>, adding to it the commands that install the “other applications” in the <code>csuser</code> account as described in step 6.3. <a href="#63-updating-end-user-software-applications">Updating end-user software applications</a>.</p>
<section id="modifying-softwareinstall_genomics_ubuntusr.sh-to-install-other-system-libraries" class="level4">
<h4 class="anchored" data-anchor-id="modifying-softwareinstall_genomics_ubuntusr.sh-to-install-other-system-libraries">Modifying <code>softwareInstall_genomics_ubuntusr.sh</code> to install other system libraries</h4>
<p>The script <code>softwareInstall_genomics_ubuntusr.sh</code> has these three main sections: - at the top, the “about” message and the option to cancel or let the script run the update - in the middle, the <code>sudo</code> commands that install the required system libraries - at the end, the message on “what to do next”: rebooting the system, etc.</p>
<p>You will add in the middle section the <code>sudo</code> commands to install the system libraries required by the “other applications” you want to install.</p>
<p>For example, let’s suppose that the Genomics application <code>bcftools</code> is not yet installed in the ‘instance-to-become-AMI’ that you are configuring and that you need to install it as described in the <a href="http://samtools.github.io/bcftools/howtos/install.html">bcftools install page</a>. This page (visited on 22 Jan 2024) has two sections: “For the impatient” and <a href="https://raw.githubusercontent.com/samtools/bcftools/develop/INSTALL">“Detailed instructions”</a>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>bcftools</code> — “For the impatient” install instructions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb40" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone <span class="at">--recurse-submodules</span> https://github.com/samtools/htslib.git</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/samtools/bcftools.git</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> bcftools</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># The following is optional:</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a> <span class="co">#   autoheader &amp;&amp; autoconf &amp;&amp; ./configure --enable-libgsl --enable-perl-filters</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>We obviously tried first the instructions for the impatient but as these failed, we proceeded to follow the detailed instructions for Debian/Ubuntu (there are detailed instructions for other versions of Linux, for MacOs and for Windows). The detailed instructions for Debian/Ubuntu are these:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb41" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">sudo</span> apt-get update        <span class="co"># Ensure the package list is up to date</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">sudo</span> apt-get install autoconf automake make gcc perl zlib1g-dev libbz2-dev liblzma-dev libcurl4-gnutls-dev libssl-dev libperl-dev libgsl0-dev</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Eventually, the instructions for the impatient were placed in the script <code>softwareInstall_genomics_csuser.sh</code> (see step 6.3. <a href="#63-updating-end-user-software-applications">Updating end-user software applications</a>.), and the detailed instructions (the two <code>sudo apt-get ..</code> commands above) in the script <code>softwareInstall_genomics_ubuntusr.sh</code>, as shown in the bar below (comments in CAPITALS are not part of the script, please read them):</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>softwareInstall_genomics_ubuntusr.sh</code> — bcftools system libraries install
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<pre><code>#!/usr/bin/env bash
# system-wide configuration and upgrade needed for csuser to install genomics software.
source colour_utils_functions.sh     # to add colour to some messages and more   ### FUNCTION message IS IN THIS FILE 
...
message "\n$(colour lb $(basename $0)) upgrades and configures the Ubuntu system. 
This script must be run before running the script that installs the $(colour lb genomics) software analysis
tools (softwareInstall_genomics_csuser.sh) in the csuser account." 
read -n 1 -p "Do you want to continue (y/n)?: " option                           ### CONTINUE OPTION
...                                                         
logfile=logs/genomics_sftwre_install_ubuntuuser.sh`date '+%Y%m%d.%H%M%S'`.txt    ### LOG FILE NAME
message "\n($option): Configuring and upgrading system. Please wait:" $logfile
...
sudo apt-get update -y | tee -a $logfile                                         ### FIRST SYSTEM update AND upgrade   
message "$(colour lg "sudo apt-get upgrade")" $logfile                           ### AND AGAIN AT THE END. SO YOUR SUDO
sudo apt-get upgrade -y | tee -a $logfile                                        ### COMMANDS MUST BE IN-BETWEEN THESE
...                                                                              ### UPDATES AND UPGRADES
message "$(colour lg "sudo apt-get install libncurses5-dev")" $logfile           ### INSTALLING OTHER SYSTEM LIBRARIES
sudo apt-get install -y libncurses5-dev | tee -a $logfile                        
               ########### BCFTOOLS SUDO COMMANS TO INSTALL REQUIRED SYSTEM LIBRARIES
message "$(colour lg "sudo apt-get install -y autoconf automake make gcc perl zlib1g-dev libbz2-dev liblzma-dev libcurl4-gnutls-dev libssl-dev libperl-dev libgsl0-dev")" $logfile
sudo apt-get install -y autoconf automake make gcc perl zlib1g-dev libbz2-dev liblzma-dev libcurl4-gnutls-dev libssl-dev libperl-dev libgsl0-dev | tee -a $logfile
               ########### END OF BCFTOOLS SUDO COMMANS TO INSTALL REQUIRED SYSTEM LIBRARIES
message "$(colour lg "sudo apt-get install python3-pip")" $logfile               ### INSTALLING OTHER SYSTEM LIBRARIES
sudo apt install -y python3-pip | tee -a $logfile
... 
message "$(colour lg "sudo apt-get update")" $logfile                             ### FINAL SYSTEM update AND upgrade 
sudo apt-get update -y  | tee -a $logfile                                         ### 
message "$(colour lg "sudo apt-get upgrade")" $logfile                            ###
sudo apt-get upgrade -y | tee -a $logfile       
#------------------------ DONE
message "$(colour lg "---------------------")
$(colour lg "DONE system-wide setting and upgrade") for csuser to install genomics software.
CHECK the log file $(colour lb "$logfile").
..
You may need to reboot, login again  and run the above command a few times until the system
message reads \"0 updates can be applied immediately\" - you may want to make a not the command\n"  $logfile</code></pre>
</div>
</div>
</div>
<p>You will notice that, in adding the <code>sudo</code> commands that install the required system libraries by <code>bcftools</code> (or by any other application for that matter), we also added the following code: - <code>message "$(colour lg "sudo apt-get -y install LIBRARY-NAMES")" $logfile</code> so that the command is written to the log file. - the <code>-y</code> option between <code>sudo apt-get intall</code> and the name of the libraries to install, so that the script will run without stopping to ask anything. - the code <code>| tee -a $logfile</code> at the end (of the library names) so that the output of the <code>sudo</code> command is printed to the screen but also appended to the log file by the <code>tee</code> program.</p>
<p>You will also notice that the first sudo command required by <code>bcftools</code>, namely, <code>sudo apt-get update</code>, is run twice, at the beginning and at the end of the script for all the system libraries installed.</p>
</section>
<section id="modifying-softwareinstall_genomics_ubuntusr.sh-to-remove-system-libraries" class="level4">
<h4 class="anchored" data-anchor-id="modifying-softwareinstall_genomics_ubuntusr.sh-to-remove-system-libraries">Modifying <code>softwareInstall_genomics_ubuntusr.sh</code> to remove system libraries</h4>
<p>We have not removed any system library explicitly but have stopped installing some libraries by commenting the commands that install them.</p>
<p>If you would like to remove some system libraries, place the relevant commands in between the two system update-upgrades (at the beginning and at the end) of the script.</p>
</section>
<section id="should-you-modify-softwareinstall_genomics_ubuntusr.sh-before-running-it" class="level4">
<h4 class="anchored" data-anchor-id="should-you-modify-softwareinstall_genomics_ubuntusr.sh-before-running-it">Should you modify <code>softwareInstall_genomics_ubuntusr.sh</code> before running it?</h4>
<p>Yes, you should add as many of the commands that install the libraries required by the applications you want installed in your ‘instance-to-become-AMI’.</p>
<p>However, don’t expect that a single run of the script will suffice. Once you modify and run the script, you will then have to modify and run the script that installs the applications in the <code>csuser</code> account and then check that the applications run. They may or may not run, as they may depend on other applications being present. For instance, <code>bcftools</code> and <code>samtools</code> both require that you also install <code>htslib</code> — but we realised this after installing <code>bcftools</code>.</p>
<p>Thus, more likely you will be iterating modifying and running <code>softwareInstall_genomics_ubuntusr.sh</code> and <code>softwareInstall_genomics_csuser.sh</code>, and testing that all applications run. These scripts just help this iterating being more efficient and documented — add plenty of comments.</p>
</section>
</section>
</section>
<section id="changing-the-end-user-username" class="level2">
<h2 class="anchored" data-anchor-id="changing-the-end-user-username">6.2 Changing the end-user username</h2>
<p>If you are to change the Cloud-SPAN <code>csuser</code> to a username of your liking, <strong>you first need to perform</strong> updating system software — updating to the next LTS is not necessary but would be convenient.</p>
<p>If you plan <strong>to install</strong> other applications not yet installed in the Genomics AMI, or <strong>to remove</strong> some or all of the applications in the Genomics AMI, or both, <strong>first change</strong> the end-user username (after updating system software) and then update the Genomics applications as described in step 6.3 <a href="#63-updating-end-user-software-applications">Updating end-user software applications</a>. This will give you and stable instance with your new username. Then install and/or remove applications through <em>updating system software</em> and <em>updating end-user software applications</em>, that is, through modifying and running the scripts <code>softwareInstall_genomics_ubuntusr.sh</code> and <code>softwareInstall_genomics_csuser.sh</code>. In so doing, you may need to increase the storage as described in step 6.4 <a href="#64-increasing-storage-size">Increasing storage size</a>, but it is straightforward.</p>
<section id="create-your-new-end-user-username" class="level3">
<h3 class="anchored" data-anchor-id="create-your-new-end-user-username">Create your new end-user username</h3>
<p>Login as the <code>ubuntu</code> user to your ‘instance-to-become-AMI’ (use <code>lginstance .. ubuntu</code>) and enter the command below (we are using <code>nwuser</code> as our new username — choose yours). The option <code>--disabled-password</code> means that the new username will not be required a password but a login key to login to an instance created from the AMI you are configuring.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb43" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo adduser <span class="at">--disabled-password</span> nwuser</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You will be asked to enter a <strong>Full Name</strong>, <strong>Room Number</strong>, etc. Type what you like and press <code>Enter</code> until the prompt appears again:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb44" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Adding</span> user <span class="kw">`</span><span class="ex">nwuser</span><span class="st">' ...</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="st">Adding new group `nwuser'</span> <span class="er">(</span><span class="ex">1004</span><span class="kw">)</span> <span class="ex">...</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Adding</span> new user <span class="kw">`</span>nwuser<span class="st">' (1002) with group `nwuser'</span> ...</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Creating</span> home directory <span class="kw">`</span><span class="ex">/home/nwuser</span><span class="st">' ...</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="st">Copying files from `/etc/skel'</span> ...</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Changing</span> the user information for nwuser</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Enter</span> the new value, or press ENTER for the default</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Full</span> Name []: New User</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Room</span> Number []:</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Work</span> Phone []:</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Home</span> Phone []:</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Other</span> []:</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="ex">Is</span> the information correct<span class="pp">?</span> <span class="pp">[</span><span class="ss">Y/n</span><span class="pp">]</span> Y</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Move all the files in the Cloud-SPAN <code>csuser</code> home directory to the home directory of your new username</strong> with the <code>sudo mv ..</code> command below:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb45" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo mv <span class="at">-f</span> /home/csuser/<span class="dt">{.</span><span class="op">,</span><span class="dt">}</span><span class="pp">*</span> /home/nwuser</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You will see the output below. Ignore it, the files have been moved. The purpose of moving the files is to have your new user configured as the <code>csuser</code> is, which includes its login key so that the new user can login, but there are other configurations files that we don’t want to setup from scratch. Also, it is not convenient to copy the files with <code>cp</code> as it will take much longer and we are going to delete the <code>csuser</code> anyway.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb46" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mv:</span> cannot move <span class="st">'/home/csuser/.'</span> to <span class="st">'/home/nwuser/.'</span>: Device or resource busy</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="ex">mv:</span> <span class="st">'/home/csuser/..'</span> and <span class="st">'/home/nwuser/..'</span> are the same file</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Change the ownership of all the files</strong> in the new user home directory and list the files with <code>ls -al</code> to check the new user is the owner:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb47" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo chown <span class="at">-R</span> nwuser:nwuser /home/nwuser</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls <span class="at">-al</span> ../nwuser/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output should look like this one:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb48" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="ex">total</span> 164</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="ex">drwxr-xr-x</span> 23 nwuser nwuser 4096 Jan 23 15:35 .</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="ex">drwxr-xr-x</span>  6 root   root   4096 Jan 23 15:21 ..</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="ex">drwxrwxr-x</span>  5 nwuser nwuser 4096 Mar 18  2022 .backup</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="ex">-rw-------</span>  1 nwuser nwuser 6910 Jan 20 16:46 .bash_history</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="ex">-rw-r--r--</span>  1 nwuser nwuser  220 Jul 29  2015 .bash_logout</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="ex">-rw-r--r--</span>  1 nwuser nwuser 4074 Jan  9 12:09 .bashrc</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="ex">drwxrwxr-x</span>  2 nwuser nwuser 4096 Mar  1  2022 bin</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="ex">drwxrwxr-x</span>  2 nwuser nwuser 4096 Oct 26  2021 .conda</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Delete the</strong> <code>csuser</code>:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb49" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:/home</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo deluser <span class="at">--remove-home</span> csuser</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb50" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Looking</span> for files to backup/remove ...</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Removing</span> files ...</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Removing</span> user <span class="kw">`</span><span class="ex">csuser</span><span class="st">' ...</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="st">Warning: group `csuser'</span> has no more members.</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Done.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="change-csuser-for-your-new-username-everywhere-in-the-script-binusersauthorizedkeys-activate.sh" class="level3">
<h3 class="anchored" data-anchor-id="change-csuser-for-your-new-username-everywhere-in-the-script-binusersauthorizedkeys-activate.sh">Change <code>csuser</code> for your new username everywhere in the script ~/bin/usersAuthorizedKeys-activate.sh</h3>
<p>You are logged in as the <code>ubuntu</code> user and that script is in your home (<code>~</code>) bin directory. You have the <code>nano</code> and <code>emacs</code> text editors to do that change. These are the lines in that file where you need to change <code>csuser</code> for your new username:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb51" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> Copying .ssh/authorized_keys to user csuser</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> cp ~/.ssh/authorized_keys ~/../csuser/.ssh</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chown <span class="at">-R</span> csuser:csuser ~/../csuser/.ssh/authorized_keys</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once your ‘instance-to-become-AMI’ does become an AMI, and instances are created from it, the Script <code>aws_instances_configure.sh</code> will configure access to each instance by remotely invoking in each instance the script <code>/home/ubuntu/bin/usersAccessKeys-setup-MAIN.sh</code>. This script in turn invokes the script that you have just modified which, as you can see by the modified code lines, will then copy the instance authorised keys to your new username so that it can be logged in with the same key used with the <code>ubuntu</code> user.</p>
</section>
</section>
<section id="edit-or-delete-the-message-of-the-day-file" class="level2">
<h2 class="anchored" data-anchor-id="edit-or-delete-the-message-of-the-day-file">Edit or delete the “message of the day” file</h2>
<p>If you want to edit or delete the Cloud-SPAN welcome message shown below, you need to edit or delete the file <code>/etc/motd</code>. It is write protected so you need to run <code>nano</code> or <code>emacs</code> as sudo: <code>sudo emacs /etc/motd</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-22-contents" aria-controls="callout-22" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The Cloud-SPAN welcome message:
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-22" class="callout-22-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<pre><code>    _____________________________

   W E L C O M E    T O    T H E


    ____ _                 _         ______ _____   _    __   _
   / ___| | ___  _   _  __| |       / ____ |  _  \ / \  |  \ | |
  | |   | |/ _ \| | | |/ _` |  ___  \___  \| |_) '/ _ \ | \ \| |
  | |___| | (_) | |_| | (_| | |___| ____)  |  __ / ___ \| |\ | |
   \____|_|\___/ \___/ \__,_|       \_____/|_|  /_/   \_|_| \__|



   G E N O M I C S     C O U R S E     E N V I R O N M E N T
   _____________________________________________________________

   Scroll up with the mouse for information before this welcome

   Type "csguide" (and the Enter (↵) key) for some guidance
   _____________________________________________________________</code></pre>
</div>
</div>
</div>
<section id="login-to-your-new-username" class="level3">
<h3 class="anchored" data-anchor-id="login-to-your-new-username">Login to your new username</h3>
<p>You can now logout (from the <code>ubuntu</code> user) and login to your new username thus:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb53" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@cloud-span-admin-instance:~</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> lginstance.sh amis/ami02-myFirstAMIConfig/outputs/login-keys/login-key-instanceToBecomeAMI02-Jorge.pem nwuser</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="updating-end-user-software-applications" class="level2">
<h2 class="anchored" data-anchor-id="updating-end-user-software-applications">6.3 Updating end-user software applications</h2>
<p>Updating end-user software applications is carried out by running the script <code>softwareInstall_genomics_csuser.sh</code> as the <code>csuser</code> (or as the new user you may have created). The script should be run only after updating system software by running the script <code>softwareInstall_genomics_ubuntusr.sh</code> as the <code>ubuntu</code> user.</p>
<p>We have changed <code>csuser</code> to <code>nwuser</code>, logged in thus <code>lginstance.sh .. nwuser</code>, and are about to update end-user software applications.</p>
<p>We will first delete the file and directory shown below as they are of no use and <strong>were created out</strong> of changing the username (the file examples.destop) and updating to the next LTS (the directory snap).</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb54" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nwuser@instanceToBecomeAMI02-Jorge:~</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="ex">bin</span>  examples.desktop  shell_data  snap  software</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> rm <span class="at">-r</span> examples.desktop snap/</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="ex">bin</span>  shell_data  software</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="install-genomics-applications-or-print-versions-installed" class="level3">
<h3 class="anchored" data-anchor-id="install-genomics-applications-or-print-versions-installed">Install Genomics applications or print versions installed</h3>
<p>The script <code>softwareInstall_genomics_csuser.sh</code> can be run with one of two options that are displayed when the script is run on its own (with no parameters):</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb55" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nwuser@instanceToBecomeAMI02-Jorge:~</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> softwareInstall_genomics_csuser.sh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb56" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="ex">softwareInstall_genomics_csuser.sh</span> installs all genomics software analysis tools.</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="ex">This</span> script should be run before creating a genomics AMI, and after running the script that</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="ex">updates</span> the Ubuntu system, softwrInstall_genomics_ubuntusr.sh, in the ubuntu account.</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">usage:</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>             <span class="ex">softwareInstall_genomics_csuser.sh</span> <span class="pp">[</span><span class="ss">go</span><span class="pp">][</span><span class="ss">versions</span><span class="pp">]</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>             <span class="ex">-</span> use option go to install all applications <span class="at">-</span> you will have the option to cancel.</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>             <span class="ex">-</span> use option versions to see the versions installed.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The option <code>go</code> installs the applications while the option <code>versions</code> runs all the applications installed to print their versions. The option <code>versions</code> <strong>will only work</strong> if you have logged in as <code>csuser</code> — it <strong>will not work</strong> if you have logged in with your new user name. This is because installing the applications configures some files, to locate the applications, using the username running the installing. Hence, as the applications in your ‘instance-to-become-AMI’ were installed using the <code>csuser</code>, they will not be found if run with another username. See the output of the script run with the <code>versions</code> option on the instance we have changed the username (<code>nwuser</code>) and on an instance where <code>csuser</code> has not been changed.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb57" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nwuser@instanceToBecomeAMI02-Jorge:~</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> softwareInstall_genomics_csuser.sh versions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-23-contents" aria-controls="callout-23" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Output (<code>nwuser</code>) — <code>softwareInstall_genomics_csuser.sh versions</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-23" class="callout-23-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<pre><code>Versions of genomics software tools installed:
/home/nwuser/.local/bincsaws/softwareInstall_genomics_csuser.sh: line 233: conda: command not found
/home/nwuser/.local/bincsaws/softwareInstall_genomics_csuser.sh: line 234: python: command not found
/home/nwuser/.local/bincsaws/softwareInstall_genomics_csuser.sh: line 235: fastqc: command not found
/home/nwuser/.local/bincsaws/softwareInstall_genomics_csuser.sh: /home/nwuser/.local/bin/cutadapt: /home/csuser/.miniconda3/bin/python3: bad interpreter: No such file or directory
cutadapt
/home/nwuser/.local/bincsaws/softwareInstall_genomics_csuser.sh: line 237: bwa: command not found
/home/nwuser/.local/bincsaws/softwareInstall_genomics_csuser.sh: line 239: samtools: command not found
/home/nwuser/.local/bincsaws/softwareInstall_genomics_csuser.sh: line 241: bcftools: command not found
vcfutils.pl   (prints no version - is installed by bcftools)
/home/nwuser/.local/bincsaws/softwareInstall_genomics_csuser.sh: line 244: trimmomatic: command not found
trimmomatic
nwuser@instanceToBecomeAMI02-Jorge:~</code></pre>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-24-contents" aria-controls="callout-24" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Output (<code>csuser</code>) — <code>softwareInstall_genomics_csuser.sh versions</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-24" class="callout-24-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<pre><code>Versions of genomics software tools installed:
conda 4.10.3
Python 3.9.5
FastQC v0.11.9
cutadapt 3.5

Program: bwa (alignment via Burrows-Wheeler transformation)
Version: 0.7.17-r1188

samtools 1.13
Using htslib 1.13

bcftools 1.14-3-g756e636
Using htslib 1.14-1-g7060387

vcfutils.pl   (prints no version - is installed by bcftools)
trimmomatic 0.39</code></pre>
</div>
</div>
</div>
</section>
<section id="installing-the-genomics-applications" class="level3">
<h3 class="anchored" data-anchor-id="installing-the-genomics-applications">Installing the Genomics applications</h3>
<p>The script <code>softwareInstall_genomics_csuser.sh</code> installs the latest applications from scratch for any user: <code>csuser</code> or your new username — it does not try to only update the applications for <code>csuser</code>. The applications are installed in the directories <code>~/software</code> and <code>~/.miniconda3</code>, and before the installation begins, all files in those directories are deleted.</p>
<p>The script runs in two steps. <strong>Step 1</strong> configures the software package manager <code>conda</code> and installs a few applications that do not require <code>conda</code> to be installed.</p>
<p><strong>Step 2</strong> installs the applications that require <code>conda</code> but, <strong>before running step 2</strong>, you must <strong>logout</strong> and <strong>login</strong> again for the <code>conda</code> configuration made in step 1 to take place. If after step 2 some applications cannot be found, you mostly likely forgot to logout and login in before — happened to us.</p>
<p>You run both steps in exactly the same way:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb60" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nwuser@instanceToBecomeAMI02-Jorge:~</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> softwareInstall_genomics_csuser.sh go</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-25-contents" aria-controls="callout-25" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Output (<code>nwuser</code>) — <code>softwareInstall_genomics_csuser.sh go</code> ### step 1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-25" class="callout-25-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<pre><code>softwareInstall_genomics_csuser.sh is about to INSTALL genomics software, step 1 (of 2)

Do you want to continue (y/n)?: y                            ### press y
Creating directory .genomics_sftw_logs

Running step 1 (of 2) of genomics software installation

Cleaning directory ~/software (rm -fr ~/software/*)
removing (current) conda
cd
rm -rf ~/.miniconda3
rm -rf ~/.conda ~/.continuum
installing conda
...                                                           ### LOADS OF OUTPUT
Completed step 1 (of 2) of genomics software install.

Please logout and login again, and then run this script again (as below) to complete step 2:

     softwareInstall_genomics_csuser.sh go</code></pre>
</div>
</div>
</div>
<p><strong>Logout</strong> and <strong>login</strong>, and then run the script again the same way: <code>softwareInstall_genomics_csuser.sh go</code> and check the output at the end.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-26-contents" aria-controls="callout-26" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Output (<code>nwuser</code>) — <code>softwareInstall_genomics_csuser.sh go</code> ### step 2
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-26" class="callout-26-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<pre><code>softwareInstall_genomics_csuser.sh is about to INSTALL genomics software, step 2 (of 2)

Do you want to continue (y/n)?:                                 ### press y 
...                                                             ### some output
Completed step 2 (of 2) of genomics software install.

Please logout and login again for environment changes to take effect.

The installation logs of steps 1 and 2 are in this file:
/home/nwuser/.genomics_sftw_logs/genomics_sftwre_install.sh20240108.160203.txt</code></pre>
</div>
</div>
</div>
<p><strong>Logout</strong> and <strong>login</strong> (!), and now run the script with the <code>versions</code> option to check the versions installed: <code>softwareInstall_genomics_csuser.sh  versions</code>:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-27-contents" aria-controls="callout-27" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Output (<code>nwuser</code>) — <code>softwareInstall_genomics_csuser.sh  versions</code> ### vers installed
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-27" class="callout-27-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<pre><code>$ softwareInstall_genomics_csuser.sh versions
Versions of genomics software tools installed:
conda 23.11.0
Python 3.11.7
FastQC v0.12.1
cutadapt 4.6

Program: bwa (alignment via Burrows-Wheeler transformation)
Version: 0.7.17-r1188

samtools 1.19-3-g62195d3
Using htslib 1.19-3-g67f3ab0f

bcftools 1.19-16-g25dc6e2a
Using htslib 1.19-3-g67f3ab0f

vcfutils.pl   (prints no version - is installed by bcftools)
trimmomatic 0.39</code></pre>
</div>
</div>
</div>
</section>
<section id="installing-other-applications-and-removing-applications-second-part" class="level3">
<h3 class="anchored" data-anchor-id="installing-other-applications-and-removing-applications-second-part">Installing other applications and removing applications — second part</h3>
<p>Recall that if you are to install other (not yet installed) applications that require installing system libraries you need to: - add the <code>sudo</code> commands that install the system libraries to the script <code>softwareInstall_genomics_ubuntusr.sh</code> (<strong>first part</strong>) and also - add the commands that install the applications to the script <code>softwareInstall_genomics_csuser.sh</code> (<strong>second part</strong>)</p>
<p>Clearly, if the other applications you are to install do not require system libraries, then you don’t need to go through the first part, but you still need to go through the second part, as described below.</p>
<section id="modifying-softwareinstall_genomics_csuser.sh-to-install-other-applications" class="level4">
<h4 class="anchored" data-anchor-id="modifying-softwareinstall_genomics_csuser.sh-to-install-other-applications">Modifying <code>softwareInstall_genomics_csuser.sh</code> to install other applications</h4>
<p>The script <code>softwareInstall_genomics_csuser.sh</code> has two main sections:</p>
<ul>
<li>at the beginning, a number of functions that each installs an application and possibly other related application/s, and the function <code>print_all_versions()</code> that runs all the installed applications to print their version.</li>
<li>at the end, a kind of main function that:
<ul>
<li>displays the usage message</li>
<li>processes the entered option: <code>go</code> or <code>versions</code></li>
<li>runs the <code>versions</code> option, invoking <code>print_all_versions()</code></li>
<li>runs the <code>go</code> option, Step 1 or 2, calling the relevant functions that install the application in each step.</li>
</ul></li>
</ul>
<p>The organisation into functions facilitates trying out different options in installing applications, as you only need to comment or uncomment a function invocation in the main function to deactivate or activate installing an application. The script <code>softwareInstall_genomics_csuser.sh</code> is relatively small, as it only installs 9 applications, of which only 3 are somewhat complex to install. But the organisation into functions was first designed to configure the Cloud-SPAN Metagenomics AMI, which required installing over 25 applications.</p>
<p>To modify the script in order to install other applications, for each application you need to:</p>
<ul>
<li>design and add the function that installs the application (<code>go</code> option)</li>
<li>add the invocation of the function in the main function in Step 1 or Step 2 (<code>go</code> option)</li>
<li>add to <code>print_all_versions()</code> the invocation of the application to print its version (<code>versions</code> option)</li>
</ul>
<p>For example, let’s suppose again that the Genomics application <code>bcftools</code> is not yet installed in the ‘instance-to-become-AMI’ that you are configuring and that you need to install it as described in the <a href="http://samtools.github.io/bcftools/howtos/install.html">bcftools install page</a> which, you will recall has two sections:</p>
<ul>
<li>“For the impatient” and</li>
<li><a href="https://raw.githubusercontent.com/samtools/bcftools/develop/INSTALL">“Detailed instructions”</a></li>
</ul>
<p>You may also recall that we mentioned that “Eventually, the instructions for the impatient were placed in the script <code>softwareInstall_genomics_csuser.sh</code> (see step 6.3. …)”, etc. So the following describes somewhat what we did and why to modify the script to install <code>bcftools</code>.</p>
<p>The code in the three bars below show (<strong>1</strong>) the commands “For the impatient” to install <code>bcftools</code> (shown before but repeated here for convenience), (<strong>2</strong>) our function <code>install_bcftools()</code> containing those commands and a few more that install <code>bcftools</code> locally and write the commands used and their outputs to a log file (using the <code>message</code> function), and (<strong>3</strong>) the invocation of <code>install_bcftools()</code> by the main function; check our comments in CAPITALS.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-28-contents" aria-controls="callout-28" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>bcftools</code> — “For the impatient” (FTI) install instructions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-28" class="callout-28-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb64" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone <span class="at">--recurse-submodules</span> https://github.com/samtools/htslib.git</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/samtools/bcftools.git</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> bcftools</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># The following is optional:</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a> <span class="co">#   autoheader &amp;&amp; autoconf &amp;&amp; ./configure --enable-libgsl --enable-perl-filters</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Note the following differences between the instructions “For the impatient” (FTI) and their coding in our function <code>install_bcftools()</code>. The first FTI command, <code>git clone --recurse-submodules https://github.com/samtools/htslib.git</code>, <strong>is not</strong> used by our function <code>install_bcftools()</code>. This is because <code>htslib</code> is installed before <code>bcftools</code> and thus is already available when <code>bcftools</code> is being installed. We installed <code>htslib</code> separately because it is also needed by <code>samtools</code> and we seem to remember that <code>htslib</code> could not be found if it was installed inside <code>bcftools</code> through that first command.</p>
<p>The optional, fourth FTI command, <code>authoheader &amp;&amp; autoconf &amp;&amp; ./configure ..</code>, is three commands in one and is run by <code>install_bcftools()</code>, but we had to put the three commands in between parentheses <code>()</code> for the output of the three commands to be properly printed to the screen and written to the log file.</p>
<p>The third of those three commands, <code>./configure</code>, is missing the second option <code>--enable-perl-filters</code> in <code>install_bcftools()</code>. We eliminated it because the installation failed every time we used it, and the three commands were optional anyway.</p>
<p>The point is: installing other applications will sometimes go nicely smoothly, but sometimes you will have to improvise. The scripts only help in trying different things more efficiently. There are plenty of comments in the scripts including the links to the instructions to install each application.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-29-contents" aria-controls="callout-29" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>install_bcftools()</code> function in <code>softwareInstall_genomics_csuser.sh</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-29" class="callout-29-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb65" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> install_bcftools()</span> <span class="kw">{</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    <span class="ex">message</span> <span class="st">"installing </span><span class="kw">`</span><span class="ex">colour</span> lb bcftools<span class="kw">`</span><span class="st">"</span> <span class="va">$1</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">message</span> <span class="st">"cd ~/software"</span> <span class="va">$1</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">cd</span> ~/software                                                    <span class="co">### INSTALL IN ~/software</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">message</span> <span class="st">"git clone https://github.com/samtools/bcftools.git"</span> <span class="va">$1</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">git</span> clone https://github.com/samtools/bcftools.git               <span class="co">### SECOND FTI COMMAND</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">message</span> <span class="st">"cd bcftools/"</span> <span class="va">$1</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">cd</span> bcftools/                                                     <span class="co">### THIRD FTI COMMAND</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">message</span> <span class="st">"( autoheader &amp;&amp; autoconf &amp;&amp; ./configure --enable-libgsl ) # no --enable-perl-filters, let Annabel and Sarah F. know"</span> <span class="va">$1</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>                                                                      <span class="co">### OPTIONAL FOURTH FTI COMMAND</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">(</span> <span class="fu">autoheader</span> <span class="kw">&amp;&amp;</span> <span class="fu">autoconf</span> <span class="kw">&amp;&amp;</span> <span class="ex">./configure</span> <span class="at">--enable-libgsl</span> <span class="kw">)</span> <span class="ex">2</span><span class="kw">&amp;</span><span class="ex">1</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$1</span> </span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">message</span> <span class="st">"make"</span> <span class="va">$1</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">make</span>  2<span class="kw">&amp;</span><span class="ex">1</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$1</span>                                           <span class="co">### FIFTH FTI COMMAND</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make local install</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>    <span class="ex">message</span> <span class="st">"cd ~/bin"</span> <span class="va">$1</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">cd</span> ~/bin</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>    <span class="ex">message</span> <span class="st">"ln -sf ~/software/bcftools/bcftools        # local install ONLY"</span> <span class="va">$1</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ln</span> <span class="at">-sf</span> ~/software/bcftools/bcftools             <span class="co"># local install ONLY</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>    <span class="ex">message</span> <span class="st">"ln -sf ~/software/bcftools/misc/vcfutils.pl # local install ONLY"</span> <span class="va">$1</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ln</span> <span class="at">-sf</span> ~/software/bcftools/misc/vcfutils.pl         <span class="co"># local install ONLY</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>    <span class="ex">message</span> <span class="st">"cd"</span> <span class="va">$1</span></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">cd</span></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>    <span class="ex">message</span> <span class="st">"vcfutils.pl    (likely not to print a version)"</span> <span class="va">$1</span></span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>    <span class="ex">vcfutils.pl</span> 2<span class="kw">&amp;</span><span class="ex">1</span> <span class="kw">|</span> <span class="fu">tee</span> <span class="at">-a</span> <span class="va">$1</span></span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>In the bar below, the invocation of <code>install_bcftools()</code> by the main function was placed in Step 1 (of 2) because <code>bcftools</code> is installed through its own installation script which is run with the <code>make</code> program. The other applications installed in Step 1, <code>conda</code>, <code>htslib</code>, and <code>samtools</code>, are installed likewise with their own installation scripts.</p>
<p>The applications installed in Step 2 need <code>conda</code> or <code>pip</code> to be installed. <code>conda</code> and <code>pip</code> are software package managers. <code>conda</code> is installed locally in the end-user directory <code>~/.miniconda3</code> and it also installs <code>pip</code>, but we also installed first some libraries at <strong>system level</strong> with the command <code>sudo apt-get install python3-pip</code> in the script <code>softwareInstall_genomics_ubuntusr.sh</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-30-contents" aria-controls="callout-30" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
invocation of <code>install_bcftools()</code> by the main function in <code>softw..csuser.sh</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-30" class="callout-30-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb66" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co">### carry out step 1 or 2 of genomics software install</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-f</span> ~/.genomics_sftw_logs/continue_install <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span>           <span class="co">### STEP 1</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 1 as the file ../continue_install (which signals step 2) does not exist</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">logfile</span><span class="op">=</span>~/.genomics_sftw_logs/genomics_sftwre_install.sh<span class="kw">`</span><span class="fu">date</span> <span class="st">'+%Y%m%d.%H%M%S'</span><span class="kw">`</span>.txt </span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">message</span> <span class="st">"\nRunning step 1 (of 2) of genomics software installation"</span> <span class="va">$logfile</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">message</span> <span class="st">"\nCleaning directory ~/software (rm -fr ~/software/*)"</span> <span class="va">$logfile</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="at">-fr</span> ~/software/<span class="pp">*</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">install_conda</span> <span class="va">$logfile</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">install_htslib</span> <span class="va">$logfile</span>         <span class="co">### kind of library needed by samtools and other programs</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">install_samtools</span> <span class="va">$logfile</span>       </span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">install_bcftools</span> <span class="va">$logfile</span>                                      <span class="co">### INVOCATION OF BCFTOOLS</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># vcfutils.pl is installed by bcftools</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="va">$logfile</span> .genomics_sftw_logs/continue_install</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">message</span> <span class="st">"\n</span><span class="va">$(</span><span class="ex">colour</span> lb <span class="st">"Completed step 1"</span><span class="va">)</span><span class="st"> (of 2) of genomics software install.\n</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="st">Please logout and login again, and then run this script again (as below) to complete step 2:\n</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="st">     </span><span class="va">$(</span><span class="ex">colour</span> lb <span class="va">$(</span><span class="fu">basename</span> <span class="va">$0))</span><span class="st"> go\n"</span> <span class="va">$logfile</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exit</span> 0</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>                                                               <span class="co">### STEP 1</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 2 as the file ../continue_install (which signals step 2) exists</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>    <span class="va">logfile</span><span class="op">=</span><span class="kw">`</span><span class="fu">cat</span> ~/.genomics_sftw_logs/continue_install<span class="kw">`</span>  <span class="co">### continue using previous logfile</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>    <span class="ex">message</span> <span class="st">"\nRunning step 2 (of 2) of genomics software install"</span> <span class="va">$logfile</span></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>    <span class="ex">install_python</span> <span class="va">$logfile</span>      <span class="co">### the miniconda version is usually more recent than the ubuntu system one</span></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>    <span class="ex">install_fastqc</span> <span class="va">$logfile</span>      </span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>    <span class="ex">install_cutadapt</span> <span class="va">$logfile</span>       </span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>    <span class="ex">install_bwa</span> <span class="va">$logfile</span>             </span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>    <span class="ex">install_trimmomatic</span> <span class="va">$logfile</span>            </span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>    <span class="ex">message</span> <span class="st">"\n</span><span class="va">$(</span><span class="ex">colour</span> lb <span class="st">"Completed step 2"</span><span class="va">)</span><span class="st"> (of 2) of genomics software install.\n</span></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a><span class="st">Please logout and login again for environment changes to take effect.\n</span></span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a><span class="st">The installation logs of steps 1 and 2 are in this file:</span></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a><span class="va">$logfile</span><span class="st">\n"</span> <span class="va">$logfile</span></span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> .genomics_sftw_logs/continue_install</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">### $(basename $0) versions         </span><span class="al">###</span><span class="co"> logout and login again is needed otherwise it may print errors.</span></span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exit</span> 0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Thus, if the other applications you are to install <strong>do not require</strong> a package manager to install them, you invoke the functions that install each application in Step 1.</p>
<p>If the other applications you are to install <strong>do require</strong> a package manager to install them, you invoke the functions that install the package managers in Step 1 (if they are other than <code>conda</code> and <code>pip</code>), and the functions that install each application in Step 2.</p>
<p><strong>To remove applications</strong>, you only need to comment the invocation of the functions that install the applications you want removed.</p>
<p>Finally, check also the following scripts, which have plenty of examples as to how to install some applications and the system libraries they require: - <code>softwareInstall_metagen_ubuntu1v.sh</code> - <code>softwareInstall_metagen_csuser1v.sh</code> - <code>softwareInstall_metagen_ubuntu2v.sh</code> - <code>softwareInstall_metagen_csuser2v.sh</code></p>
<p>These scripts were used to create the first Metagenomics AMI configuring (starting with) an ‘instance-to-become-AMI’ created from the 30GB Genomics AMI. <strong>However</strong>, remember that running these scripts <strong>will not give</strong> you a properly configured Metagenomics AMI because, as mentioned in the <a href="#background-to-our-approach-to-configuring-instances-to-become-amis"><strong>Background to our approach to configuring instances-to-become-AMIs</strong></a>, some Metagenomics experts configured some databases and applications both in between and after running the two versions of the scripts.</p>
</section>
</section>
</section>
<section id="increasing-storage-size-1" class="level2">
<h2 class="anchored" data-anchor-id="increasing-storage-size-1">6.4 Increasing storage size</h2>
<p>Increasing storage size is carried out by running the script <code>aws_storageEBS_increase.sh</code> as the <code>ubuntu</code> user <strong>in the instance whose storage you want to increase</strong> — yes, while the instance is running. <strong>Before running</strong> the script, you need both to <strong>install</strong> and to <strong>configure</strong> the <code>aws</code> CLI in the instance with programmatic access credentials, that is: (1) an <em>access key ID</em> and (2) a <em>secret access key</em> — which you will remember are generated with your AWS IAM user account in the AWS Console.</p>
<p>You <strong>don’t need</strong> to create new credentials to increase the storage of your ‘instance-to-become-AMI’ (though you can if you want to). We are going to use the same credentials we have been using to create instances in this and the last episode. We are going to <strong>copy</strong> such credentials to our ‘instance-to-become-AMI’, <strong>increase</strong> the storage, and then <strong>delete</strong> the credentials. We want to delete the credentials because we don’t want them to be in each instance created from the AMI that your ‘instance-to-become-AMI’ will be. You could invalidate the credentials in the AWS Console instead, or both. It’s up to you. We are going to delete them as mentioned.</p>
<p>We are going to perform the following: - delete current <code>aws</code> CLI — an old version installed at system level - install latest <code>aws</code> CLI — locally in the <code>ubuntu</code> user - configure <code>aws</code> CLI — copying the credentials you have been using - increase storage — running <code>aws_storageEBS_increase.sh</code></p>
<section id="delete-the-current-aws-cli-installed-at-system-level" class="level3">
<h3 class="anchored" data-anchor-id="delete-the-current-aws-cli-installed-at-system-level">Delete the current <code>aws</code> CLI installed at system level</h3>
<p>Login to your ‘instance-to-become-AMI’ as the <code>ubuntu</code> user (<code>lginstance.sh .. ubuntu</code>) and enter the commands below to delete the old version of the <code>aws</code> CLI.</p>
<p>For clarity and convenience we will be showing the prompt only before the first command and below each command its output:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb67" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> which aws</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="ex">/usr/local/bin/aws</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls <span class="at">-l</span> /usr/local/bin/aws<span class="pp">*</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="ex">lrwxrwxrwx</span> 1 root root 37 May  8  2022 /usr/local/bin/aws <span class="at">-</span>/usr/local/aws-cli/v2/current/bin/aws</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="ex">lrwxrwxrwx</span> 1 root root 47 May  8  2022 /usr/local/bin/aws_completer <span class="at">-</span>/usr/local/aws-cli/v2/current/bin/aws_completer</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls <span class="at">-a</span> /usr/local/aws-cli</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="bu">.</span>  ..  v2 </span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo rm <span class="at">-rf</span> /usr/local/bin/aws /usr/local/bin/aws_completer /usr/local/aws-cli      <span class="co">### no output: deleted</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> which aws</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span>                        <span class="co">### no path: aws no longer found</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>First, the <code>which</code> command gives us the path of the <code>aws</code> CLI. With that path, <code>ls -l ../aws*</code> tells whether <code>aws</code> is a link and whether there are other AWS programs installed. There are two AWS programs installed which are both links: <code>aws</code> and <code>aws_completer</code>. Both links point to the actual programs which are stored in the directory: <code>/usr/local/aws-cli</code></p>
<p>With <code>ls -a /usr/local/aws-cli</code> we check whether there is anything else stored in that directory: only version <code>v2</code> is therein. With <code>sudo rm ..</code> we then delete the directory and the links to the programs we found earlier. <strong>To prevent mistakes</strong>, we copy-pasted the paths of the directory and the links to the <code>sudo rm ..</code> command.</p>
</section>
<section id="install-the-latest-aws-cli-locally-in-the-ubuntu-account" class="level3">
<h3 class="anchored" data-anchor-id="install-the-latest-aws-cli-locally-in-the-ubuntu-account">Install the latest <code>aws</code> CLI locally in the <code>ubuntu</code> account</h3>
<p>Enter the following command to install the latest version of the <code>aws</code> CLI and press <code>y</code> to continue:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb68" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws_cli_install_update_linux.sh</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="ex">aws_cli_install_update_linux.sh</span>  installs or updates the AWS CLI and the AWS completer locally.</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Do</span> you want to continue <span class="er">(</span><span class="ex">y/n</span><span class="kw">)</span><span class="ex">?:</span>                             <span class="co">### press y to continue</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span>                                                         <span class="co">### quite some output</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span>    <span class="co">### install finished</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> which aws                                                 <span class="co">### where was installed</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/ubuntu/.local/bincsaws/aws</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls <span class="at">-l</span> .local/bincsaws/                                    <span class="co">###</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="ex">total</span> 256</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="ex">lrwxrwxrwx</span> 1 ubuntu ubuntu    56 Jan 26 11:23 aws <span class="at">-</span>/home/ubuntu/.local/bincsaws/aws-cli2/v2/current/bin/aws</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="ex">drwxrwxr-x</span> 3 ubuntu ubuntu  4096 Jan 26 11:23 aws-cli2</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a><span class="ex">-rwxrwxr-x</span> 1 ubuntu ubuntu  1536 Jan  9 16:23 aws_cli_install_update_linux.sh</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="ex">lrwxrwxrwx</span> 1 ubuntu ubuntu    66 Jan 26 11:23 aws_completer <span class="at">-</span>/home/ubuntu/.local/bincsaws/aws-cli2/v2/current/bin/aws_completer</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span> </span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls .aws</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a><span class="ex">ls:</span> cannot access <span class="st">'.aws'</span>: No such file or directory</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>aws</code> CLI is installed along with the Scripts, in the directory <code>~/.local/bincsaws/</code>.</p>
<p>The last command <code>ls .aws</code> is to show that the directory <code>~/.aws</code> does not exist and thus the <code>aws</code> CLI is not configured. It can run but any commands issued to access AWS resources will fail.</p>
<p>We need to <strong>logout</strong> and <strong>login</strong> again for the installation configuration to take place (see the last line of the file <code>~/.bashrc</code> which was added to activate the <code>aws_completer</code>).</p>
<p>We also need to logout to copy the credentials which are in the <code>~/.aws</code> directory in the machine where we created the ‘instance-to-become-AMI’.</p>
</section>
<section id="configure-the-aws-cli-copy-the-aws-credentials-you-have-been-using-to-your-instance-to-become-ami" class="level3">
<h3 class="anchored" data-anchor-id="configure-the-aws-cli-copy-the-aws-credentials-you-have-been-using-to-your-instance-to-become-ami">Configure the <code>aws</code> CLI: copy the AWS credentials you have been using to your ‘instance-to-become-AMI’</h3>
<p>You have logged out of your ‘instance-to-become-AMI’; <em>you are now in the machine where you created that instance</em> — our prompt has changed to <code>csuser@cloud-span-admin-instance:~</code> in the code below.</p>
<p>The command <code>ls -a .aws</code> (while in our home directory) shows that the directory <code>~/.aws</code> exists and has two files: <code>config</code> and <code>credentials</code>.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb69" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@cloud-span-admin-instance:~</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls <span class="at">-a</span> .aws</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="ex">config</span>  credentials</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="copy-the-.aws-directory-to-your-instance-to-become-ami" class="level4">
<h4 class="anchored" data-anchor-id="copy-the-.aws-directory-to-your-instance-to-become-ami"><strong>Copy the <code>.aws</code> directory to your ‘instance-to-become-AMI’</strong></h4>
<p>Enter the command <code>cptoInstance.sh</code> as shown below to copy the <code>.aws</code> directory to your ‘instance-to-become-AMI’, passing as parameters (1) the <code>-u</code> option, (2) the path of the login key file of your ‘instance-to-become-AMI’ and (3) the name of the directory to copy, <code>.ami</code>.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb70" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="ex">csuser@cloud-span-admin-instance:~</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cptoInstance.sh <span class="at">-u</span> amis/ami02-myFirstAMIConfig/outputs/login-keys/login-key-instanceToBecomeAMI02-Jorge.pem .aws</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="ex">credentials</span>                                                           100%  116   231.4KB/s   00:00</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="ex">config</span>                                                                100%   43    92.6KB/s   00:00</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>cptoinstance.sh</code> works similarly to <code>lginstance.sh</code> in that you need to specify the login key of the instance to which you want to copy a file or directory. The <code>-u</code> option means to copy to the <code>ubuntu</code> account as opposed to the <code>csuser</code> account which is the default.</p>
<p>You also have available the script <code>cpfromInstance.sh</code> which works similarly but copying from an instance to the machine where you issue the command.</p>
<p>For this course, we only modified <code>lginstance.sh</code> to work with any username — it used to work only for the usernames <code>ubuntu</code> and <code>csuser</code>. That is, if you changed the end-user username, you need to modify <code>cptoInstance.sh</code> and <code>cpfromInstance.sh</code> to work with your new username.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-31-contents" aria-controls="callout-31" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
How <code>cptoInstance.sh</code> works:
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-31" class="callout-31-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><code>cptoInstance.sh</code> was installed along with the Scripts on your computer — it is already installed on your AWS instance if you are attending a workshop using a Cloud-SPAN AWS account. <strong>Run</strong> <code>cptoInstance.sh</code> with no parameters to see its usage message.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb71" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cptoInstance.sh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb72" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="ex">cptoInstance.sh</span> copies a local file/directory to the csuser account of an AWS instance.</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="ex">usage:</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">cptoInstance.sh</span> <span class="pp">[-</span><span class="ss">l</span><span class="pp">][-</span><span class="ss">u</span><span class="pp">][-</span><span class="ss">v</span><span class="pp">]</span> login-key-instanceName.pem  localFile/DirName  <span class="pp">[</span><span class="ss">remoteFile/DirName</span><span class="pp">]</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> NB: copying an individual file or link overwrites remote ones if they exist<span class="kw">;</span> <span class="ex">remote</span> directories are</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  <span class="ex">not</span> overwritten if they exist but the copy is suffixed thus: remoteDirName-CopyYYYYMMDD.HHMMSS.</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> use <span class="at">-l</span> to copy links within directories as links <span class="er">(</span><span class="ex">otherwise</span> files pointed to by links are copied<span class="kw">)</span><span class="bu">.</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> use <span class="at">-u</span> to copy to the <span class="st">'ubuntu'</span> account instead <span class="er">(</span><span class="ex">of</span> the <span class="st">'csuser'</span> account<span class="kw">)</span><span class="bu">.</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> use <span class="at">-v</span> <span class="er">(</span><span class="ex">verbose</span><span class="kw">)</span> <span class="ex">to</span> see what<span class="st">'s going on and the copy command used.</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="st">- login-key-instanceName.pem is the name (path) of the file containing the RSA login key to access</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="st">  the instance. The name of the instance to copy to is extracted from this name.</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="st">- if remoteFile/DirName is not specified, the copy will be named as the localFile/DirName and copied</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="st">  at the home directory in the instance.</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="st">- Examples:</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="st">  cptoInstance.sh gc_data/outputs/login-keys/login-key-instance017.pem  data/shell_data</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="st">  - copies (file/dir) data/shell_data to instance017.cloud-span.aws.york.ac.uk:/home/csuser/shell_data</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a><span class="st">  cptoInstance.sh -u gc_data/outputs/login-keys/login-key-instance017.pem  shell_data  shell_data2</span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a><span class="st">  - copies  data/shell_data to instance017.cloud-span.aws.york.ac.uk:/home/ubuntu/shell_data2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Don’t forget</strong> to use the <code>Tab</code> key to complete <code>cptoInstance.sh</code> <strong>and</strong> the file paths of the login key and the file/dir to copy.</p>
</div>
</div>
</div>
</section>
</section>
<section id="increase-the-storage-of-your-instance-to-become-ami" class="level3">
<h3 class="anchored" data-anchor-id="increase-the-storage-of-your-instance-to-become-ami">Increase the storage of your ‘instance-to-become-AMI’</h3>
<p>Login to your ‘instance-to-become-AMI’ as the <code>ubuntu</code> user (<code>lginstance.sh .. ubuntu</code>).</p>
<p>Enter the following commands to check:</p>
<ul>
<li>the credentials have been copied</li>
<li>how to run the script <code>aws_storageEBS_increase.sh</code> and</li>
<li>the current size of the instance storage</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb73" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls .aws                                        <span class="co">### we have the credentials</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="ex">config</span>  credentials</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws_storageEBS_increase.sh                     <span class="co">### with no parameters the usage message is printed</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="ex">aws_storageEBS_increase.sh</span> increases the size of the instance disk <span class="er">(</span><span class="ex">EBS</span> storage<span class="kw">)</span> <span class="ex">and</span> the file system</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="ex">up</span> to the given number of GigaBytes <span class="er">(</span><span class="ex">GB</span><span class="kw">)</span> <span class="cf">if</span> <span class="ex">such</span> number is larger than the current size of the disk.</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="ex">usage:</span>     aws_storageEBS_increase.sh  newSizeOfDiskInGBs</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Example:</span>       aws_storageEBS_increase.sh 120</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a> <span class="ex">-</span> increases the size of the disk and file system to be of 120 GB.</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a> <span class="ex">-</span> the current disk size must be smaller than 120 GB.</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a> <span class="ex">-</span> note that the file system size may be shown as slightly smaller than disk space:</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>   <span class="ex">try</span> command: <span class="st">"df -h ."</span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> df <span class="at">-h</span> .                                        <span class="co">### print file system disk space usage in GB</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a><span class="ex">Filesystem</span>      Size  Used Avail Use% Mounted on</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/nvme0n1p1</span>   30G   21G  7.5G  74% /</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We need to run <code>aws_storageEBS_increase.sh</code> specifying the size in GBs that we want the storage and file system to be. The last command <code>df -h .</code> prints the current size of the storage which is 30 GBs.</p>
<p>We are going to increase the storage by 5 GB only. So we need to run the script specifying 35 GB:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb74" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws_storageEBS_increase.sh 35</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Disk</span> current size is 30 and is going to be increased to 35.</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Do</span> you want to continue <span class="er">(</span><span class="ex">y/n</span><span class="kw">)</span><span class="ex">?:</span> y                                   <span class="co">### press y to continue</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Increasing</span> disk size from 30 to 35 GBs. Please wait:</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="ex">aws</span> ec2 modify-volume <span class="at">--size</span> 35 <span class="at">--volume-id</span> vol-0481c9665b82e23ad logs/aws_storage_increase.sh20240126.160253.txt 2<span class="kw">&amp;</span><span class="ex">1</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Success</span> extending disk size but must wait for optimisation phase:</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="ex">not</span> yet, status: modifying</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Status:</span> optimizing is enough, proceeding ..</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Checking</span> new size with command <span class="st">"/dev/nvme0n1"</span>:</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="ex">newDiskSize</span> 35</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="ex">Increasing</span> partition and file system:</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="ex">CHANGED:</span> partition=1 start=2048 old: size=62912479 end=62914527 new: size=73398239 end=73400287</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="ex">resize2fs</span> 1.46.5 <span class="er">(</span><span class="ex">30-Dec-2021</span><span class="kw">)</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Filesystem</span> at /dev/nvme0n1p1 is mounted on /<span class="kw">;</span> <span class="ex">on-line</span> resizing required</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a><span class="ex">old_desc_blocks</span> = 2, new_desc_blocks = 3</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> filesystem on /dev/nvme0n1p1 is now 9174779 <span class="er">(</span><span class="ex">4k</span><span class="kw">)</span> <span class="ex">blocks</span> long.</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a><span class="ex">Filesystem</span>      Size  Used Avail Use% Mounted on</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/nvme0n1p1</span>   35G   21G   13G  63% /</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The script <code>aws_storageEBS_increase.sh</code> runs the command <code>df -h .</code> at the end to show the new size of the storage and file system.</p>
<section id="try-to-increase-the-storage-again" class="level4">
<h4 class="anchored" data-anchor-id="try-to-increase-the-storage-again">Try to increase the storage again</h4>
<p>If you try to increase the storage again shortly after you have increased it, the script will fail as in the example below where we tried to increase the storage to be 40 GB:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb75" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws_storageEBS_increase.sh 40</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Disk</span> current size is 35 and is going to be increased to 40.</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Do</span> you want to continue <span class="er">(</span><span class="ex">y/n</span><span class="kw">)</span><span class="ex">?:</span> y</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Increasing</span> disk size from 35 to 40 GBs. Please wait:</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="ex">aws</span> ec2 modify-volume <span class="at">--size</span> 40 <span class="at">--volume-id</span> vol-0481c9665b82e23ad logs/aws_storage_increase.sh20240126.164447.txt 2<span class="kw">&amp;</span><span class="ex">1</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Error</span> extending disk size, please check the log file logs/aws_storage_increase.sh20240126.164447.txt for details.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the log file specified in the last line of your output. You will find a message like the following (among other information), stating that you need to wait some time to increase the storage again:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Output</strong></pre>
</div>
<div class="sourceCode" id="cb76" data-filename="Output"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="ex">An</span> error occurred <span class="er">(</span><span class="ex">VolumeModificationRateExceeded</span><span class="kw">)</span> <span class="ex">when</span> calling the ModifyVolume operation: You<span class="st">'ve reached the maximum modification rate per volume limit. Wait at least 6 hours between modifications per EBS volume.</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="st">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="try-to-run-the-script-after-deleting-the-aws-credentials" class="level4">
<h4 class="anchored" data-anchor-id="try-to-run-the-script-after-deleting-the-aws-credentials"><strong>Try to run the script after deleting the AWS credentials</strong></h4>
<p>If you try to increase the storage after deleting the AWS credentials, the script will fail thus:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb77" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> rm <span class="at">-fr</span> .aws                                <span class="co">### delete the credentials</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws_storageEBS_increase.sh 40              <span class="co">### try to increase storage</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Unable</span> to locate credentials. You can configure credentials by running <span class="st">"aws configure"</span>.</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/ubuntu/.local/bincsaws/aws_storageEBS_increase.sh:</span> line 88: [: <span class="at">-ge:</span> unary operator expected</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Disk</span> current size is  and is going to be increased to 40.</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Do</span> you want to continue <span class="er">(</span><span class="ex">y/n</span><span class="kw">)</span><span class="ex">?:</span> y</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Increasing</span> disk size from  to 40 GBs. Please wait:</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="ex">aws</span> ec2 modify-volume <span class="at">--size</span> 40 <span class="at">--volume-id</span>  logs/aws_storage_increase.sh20240126.180719.txt 2<span class="kw">&amp;</span><span class="ex">1</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Error</span> extending disk size, please check the log file logs/aws_storage_increase.sh20240126.180719.txt for details.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first line of the output above, “Unable to locate credentials. You can configure credentials .. [etc.]”, corresponds to the first <code>aws</code> (CLI) command in the script which is in charge of recovering the volume-id of the storage so that the second <code>aws</code> command in the script, <code>aws ec2 modify-volume --size 40 --volume-id</code> (shown in the output above), can request the storage increase. As shown by the output, the first <code>aws</code> command failed for lack of credentials, but the script continued and eventually failed in the second <code>aws</code> command for a syntax error. Check your log file, and the script <code>aws_storageEBS_increase.sh</code> in your text editor, particularly the first and second invocations to <code>aws</code>. The script is “working”, but should have aborted execution when the first <code>aws</code> command failed.</p>
<p>Can you fix the script before creating your AMI?</p>
</section>
</section>
</section>
<section id="before-creating-your-ami-last-trimmings-and-deleting-all-login-keys" class="level2">
<h2 class="anchored" data-anchor-id="before-creating-your-ami-last-trimmings-and-deleting-all-login-keys">6.5 Before creating your AMI: last trimmings and deleting all login keys</h2>
<p>You have configured your ‘instance-to-become-AMI’ with regard to: - system software (patches, libraries and possibly a new LTS version of Ubuntu Linux) - possibly changed the end-user username - end-user software, possibly adding other applications and deleting others - increased storage size</p>
<p>You may have had to iterate through those steps a few times to get to the configuration you needed for your AMI. For instance, given that reducing storage size is difficult, you may have had to increase storage gradually, creating intermediate AMIs to roll back, if needed.</p>
<p><strong>The last tasks to carry out are these</strong>:</p>
<ul>
<li>performing <strong>minor trimmings</strong> you want in each instance created from your AMI</li>
<li><strong>rebooting your instance</strong> to become AMI and login again as the <code>ubuntu</code> user — this is to ensure all changes take effect</li>
<li><strong>deleting the login keys</strong> you have been using to login to your ‘instance-to-become-AMI’ so that they are not present in each instance created from your AMI. It is a recommended best practice to delete all previously used keys just before creating an AMI for <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/building-shared-amis.html?icmpid=docs_ec2_console#remove-ssh-host-key-pairs">improving security and reducing the likelihood of “man-in-the-middle” attacks</a>.</li>
<li><strong>stopping your ‘instance-to-become-AMI’</strong> with <code>sudo shootdown now</code> — <em>you will not be able to login again to your ‘instance-to-become-AMI’</em>, as you will have deleted all login keys.</li>
<li><strong>creating your AMI in the AWS Console</strong> as you did in Section 2 (Create an AMI and make it Public in the AWS Console).</li>
<li><strong>testing your AMI</strong> — creating an instance from your new AMI and login to the instance as you did in the previous episode <a href="./02-instances-management-tasks/">Instances Management Tasks Using the Scripts</a>. Recall that we manage the instances we create in three directories: <code>amis</code>, <code>courses</code>, <code>tests</code>. So you may want to use the <code>tests</code> directory to create the instance from your new AMI, for example: <code>tests/t001-test-instance-ami02/inputs</code>. The point of such a name is to “link” the elements involved: it is a test instance (not a course nor an AMI instance), created from the second AMI you created (in this course).</li>
</ul>
<section id="minor-trimmings-you-may-want-in-each-instance-created-from-your-ami" class="level3">
<h3 class="anchored" data-anchor-id="minor-trimmings-you-may-want-in-each-instance-created-from-your-ami">Minor trimmings you may want in each instance created from your AMI</h3>
<p>You may want some data or a few admin scripts installed in each instance created from your AMI, just as we installed all the Scripts in the Genomics AMI in the directory <code>~/.local/bincsaws</code>, of both the <code>ubuntu</code> user and the <code>csuser</code>.</p>
<p>You can use the scripts <code>cptoInstance.sh</code> and <code>cpfromInstance.sh</code> to copy files between your admin computer and your ‘instance-to-become-AMI’ you are configuring. Alternatively, you can use GitHub to place whatever you want in your ‘instance-to-become-AMI’, and then git-clone it into your instance, see the section <a href="../../docs/lesson01-setting-work-envs/02-configure-account.html">Configure Your Terminal Environment</a>, which shows how we installed the Scripts in the instance that became the Genomics AMI.</p>
<p>You may also want to trim the prompt, the colours of the prompt, or the colours used to display directory names, link files, etc. The configuration files you need to trim are <code>~/.bashrc</code> and <code>~/.dircolors</code>.</p>
<p>These are the lines in <code>~/.bashrc</code> of the <code>csuser</code> and <code>ubuntu</code> user you need to modify to trim the prompt and its colours:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb78" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">### csuser (nwuser)</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">PS1</span><span class="op">=</span><span class="st">'${debian_chroot:+($debian_chroot)}\[\033[00;37m\]\u\[\033[00;33m\]@\[\033[00;32m\]\h\[\033[00m\]:\[\033[00;36m\]\w\[\033[00m\] \n\$ '</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co">### ubuntu user</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">PS1</span><span class="op">=</span><span class="st">'${debian_chroot:+($debian_chroot)}\[\033[00;37m\]\u\[\033[00;33m\]@\[\033[00;32m\]\H\[\033[00m\]:\[\033[00;36m\]\w\[\033[00m\] \n\$ '</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The strange strings are colour codes (you need to google to change them). The prompt elements are (<strong>1</strong>) the username <code>\u\</code>, (<strong>2</strong>) the at <code>@</code> symbol, (<strong>3</strong>) the host name <code>\h\</code> in <code>csuser</code> and full host name <code>\H\</code> in the <code>ubuntu</code> user, (<strong>4</strong>) a semi-colon <code>:</code>, (<strong>5</strong>) the working directory <code>\w\</code>, and (<strong>6</strong>) the dollar sign <code>\$</code> at the end.</p>
<p>The newline <code>\n</code> character just before the dollar sign, <code>\n\$</code>, is what makes the dollar sign appear on its own in a new line. If you delete the newline, then you will have a single line prompt and will enter commands in the same line.</p>
<p>If you move the newline after the dollar sign like so <code>\$\n</code>, you will have a two line prompt: the first line ending with the dollar sign, and the second line clean waiting for you to type your command — this simplifies copy-pasting commands as you don’t have to get rid of the dollar sign.</p>
<p>To change the colours used in displaying file and directory names, open the file <code>~/.dircolors</code> and search for the string <code>DIR</code>, then play with different colour combinations for different types of files.</p>
<p>If you change <code>~/.bashrc</code> or <code>~/.dircolors</code>, you need to logout and login again for the changes to take effect. Changes will only apply to the username you logged in to make the changes.</p>
</section>
<section id="rebooting-your-instance-for-any-changes-to-take-effect" class="level3">
<h3 class="anchored" data-anchor-id="rebooting-your-instance-for-any-changes-to-take-effect">Rebooting your instance for any changes to take effect</h3>
<p>You are now done with changes. Please reboot the system as shown below and login again in 2-3 minutes as the <code>ubuntu</code> user (<code>lginstance.sh .. ubuntu</code>), as you need sudo privileges for the next task: deleting all login keys.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb79" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo shutdown <span class="at">--reboot</span> now</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You may have already seen a message like the one below after updating the operating system in your personal computer: “Your computer needs to restart for changes to take effect.”</p>
</section>
<section id="deleting-all-login-keys" class="level3">
<h3 class="anchored" data-anchor-id="deleting-all-login-keys">Deleting all login keys</h3>
<p>You are logged in as the <code>ubuntu</code> user. Please enter the commands below to delete all the loging keys (details in <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/building-shared-amis.html?icmpid=docs_ec2_console#remove-ssh-host-key-pairs">remove-ssh-host-key-pairs</a>):</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code</strong></pre>
</div>
<div class="sourceCode" id="cb80" data-filename="Code"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@instanceToBecomeAMI02-Jorge.cloud-span.aws.york.ac.uk:~</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls /etc/ssh/<span class="pp">*</span>_key /etc/ssh/<span class="pp">*</span>_key.pub                                 <span class="co">### what are we deleting?</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="ex">/etc/ssh/ssh_host_dsa_key</span>      /etc/ssh/ssh_host_ecdsa_key.pub    /etc/ssh/ssh_host_rsa_key</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="ex">/etc/ssh/ssh_host_dsa_key.pub</span>  /etc/ssh/ssh_host_ed25519_key      /etc/ssh/ssh_host_rsa_key.pub</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="ex">/etc/ssh/ssh_host_ecdsa_key</span>    /etc/ssh/ssh_host_ed25519_key.pub</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo shred <span class="at">-u</span> /etc/ssh/<span class="pp">*</span>_key /etc/ssh/<span class="pp">*</span>_key.pub                      <span class="co">### silent, no output</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls /etc/ssh/<span class="pp">*</span>_key /etc/ssh/<span class="pp">*</span>_key.pub                                 <span class="co">### check no more keys</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="ex">ls:</span> cannot access <span class="st">'/etc/ssh/*_key'</span>: No such file or directory</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="ex">ls:</span> cannot access <span class="st">'/etc/ssh/*_key.pub'</span>: No such file or directory</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cat .ssh/authorized_keys                                           <span class="co">### delete key we've been using</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Ctrl-d</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Entering the last command, <code>cat .ssh/authorized_keys</code>, and then typing the keys <code>Ctrl</code> and <code>d</code> simultaneously to exit the <code>cat</code> command, has the effect of emptying out the file <code>.ssh/authorized_keys</code>, thus deleting the login key we have been using to login to our ‘instance-to-become-AMI’.</p>
<p>Once an instance is launched from your new AMI, the AWS will append to that file the login key created for the instance, and then, the script <code>aws_instances_configure.sh</code> will invoke the script <code>/home/ubunutu/usersAccessKeys-setup-MAIN.sh</code> in the instance to copy that file into the equivalent one in the <code>csuser</code> (or your new user account) to enable it to login.</p>
<p>You now need to:</p>
<ul>
<li>shootdown your instance, entering this command: <code>sudo shootdown now</code> — you will be logged and won’t be able to login again.</li>
<li>go to the AWS Console and create an AMI out of your instance as suggested above within the <code>tests</code> directory, etc.</li>
<li>create an instance with your new AMI and login to your instance and check the configuration you did: username, storage size, prompt, scripts, etc. You have created instances before, so do similarly, and remember to change the ami-id in the file <code>resourcesIDs.txt</code> with the ami-id of your instance.</li>
</ul>
<p>That’s all from us regarding AMIs management. Get in touch if you need to.</p>


</section>
</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/Cloud-SPAN\.github\.io\/cloud-admin-guide-v2q\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="../../docs/lesson02-managing-aws-instances/02-instances-management.html" class="pagination-link" aria-label="Instances Management Tasks Using the Scripts">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Instances Management Tasks Using the Scripts</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../docs/lesson02-managing-aws-instances/04-scripts-design.html" class="pagination-link" aria-label="The Scripts Design">
        <span class="nav-page-text">The Scripts Design</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2021–24 by <a href="https://cloud-span.york.ac.uk/">Cloud-SPAN</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/Cloud-SPAN/nerc-metagenomics-v2q/edit/main/docs/lesson02-managing-aws-instances/03-ami-management.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/Cloud-SPAN/nerc-metagenomics-v2q/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/SpanCloud">
      <i class="bi bi-twitter" role="img" aria-label="Quarto Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Cloud-SPAN/cloud-admin-guide-v2q">
      <i class="bi bi-github" role="img" aria-label="Quarto GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>